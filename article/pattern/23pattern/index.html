<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="iGDu0e88zUCIa6OhhkXgxyKDioORMrt1KC_43F_VRcg" />
    <meta name="baidu-site-verification" content="A2ImdbykAi" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keyword" content="">
    <link rel="shortcut icon" href="/img/meditation.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
        23种设计模式详解以及Java代码实现 - LiaoCan | Blog
        
    </title>

    <link rel="canonical" href="https://liaocan.top/article/pattern/23pattern/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/beantech.min.css">


    <link rel="stylesheet" href="/css/donate.css">

    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>

    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</head>

<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- Modified by Yu-Hsuan Yen -->
<!-- Post Header -->
<style type="text/css">
    header.intro-header {
        background-image: url('/img/article_header/guangzhou5.jpg')
                /*post*/
                
    }

    
</style>

<header class="intro-header">
    <!-- Signature -->
    <div id="signature">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <div class="post-heading">
                        <div class="tags">
                            
                            <a class="tag" href="/tags/#设计模式" title="设计模式">
                                设计模式</a>
                            
                        </div>
                        <h1>
                            23种设计模式详解以及Java代码实现
                        </h1>
                        <!-- <h2 class="subheading"></h2> -->
                        <!--文章访问量统计-->
                        
                        <span id="busuanzi_container_page_pv">本文已被阅读过<span id="busuanzi_value_page_pv"></span>次</span>
                        
                        <!--文章访问量统计--> <span class="meta">
                            Posted by
                            Liao Can on
                            2017-07-13
                        </span>
                    </div>
                    


                </div>
            </div>
        </div>
    </div>
</header>
	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Liao Can</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    
                    
                        <li>
                            <a href="/about/" >About</a>
                        </li>
                    
                        <li>
                            <a href="/archive/" >Archives</a>
                        </li>
                    
                        <li>
                            <a href="/tags/" >Tags</a>
                        </li>
                    


                    <!-- 

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                     -->
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Modify by Yu-Hsuan Yen -->

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

            <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <blockquote>
<p>设计模式是在软件开发中，经过验证的，用于解决在特定环境下、重复出现的、特定问题的解决方案。</p>
</blockquote>
<h1 id="创建型">创建型</h1>
<blockquote>
<p>创建型模式是抽象对象实例化的过程，用于帮助创建对象的实例。</p>
</blockquote>
<h2 id="工厂模式">工厂模式</h2>
<h3 id="简单工厂">简单工厂</h3>
<h4 id="描述">描述</h4>
<p>定义：提供一个创建对象实例的功能，而无须关心其具体实现。被创建实例的类型可以是接口、抽象类，也可以是具体的类。简单工厂方法的功能是选择合适的实现类并创建。本质是选择实现。简单工厂也称为静态工厂，可以把简单工厂类实现成一个工具类，直接提供静态创建对象的方法。<br>
简单工厂也称为万能工厂，一个简单工厂理论上可以构造任何对象，因此又称为万能工厂。可配置的简单工厂，使用反射加上配置文件，实现添加新的实现类后，无须修改代码，即可把新的实现类加入应用中进行使用。</p>
<h4 id="结构">结构</h4>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Api</td>
<td>定义客户所需要的功能接口</td>
</tr>
<tr>
<td>Impl</td>
<td>Api的实现类，可能有多个</td>
</tr>
<tr>
<td>Factory</td>
<td>工厂，选择合适的实现类来创建Api接口对象</td>
</tr>
<tr>
<td>Client</td>
<td>客户端，通过Factory获取Api接口对象，面向Api接口编程</td>
</tr>
</tbody>
</table>
<h4 id="命名">命名</h4>
<blockquote>
<ul>
<li>类名为“模块名称+Factory”，如：用户模块的工厂命名为UserFactory。</li>
<li>方法名称为“get+接口名称”或“create+接口名称”。</li>
</ul>
</blockquote>
<h4 id="优缺点">优缺点</h4>
<p>优点</p>
<ol>
<li>帮助封装</li>
<li>解耦</li>
</ol>
<p>缺点</p>
<ol>
<li>可能增加客户端的复杂度</li>
<li>不方便扩展子工厂</li>
</ol>
<h4 id="使用场景">使用场景</h4>
<p>1.完全封装隔离具体实现，使外部接口只能通过接口操作封装体。<br>
2.将对外创建对象的职责集中管理和控制。</p>
<h4 id="示例">示例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：静态工厂</span></span><br><span class="line"><span class="comment">//Client角色</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户端类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 用户不需知道具体的实现（隔离封装、面向接口编程）</span></span><br><span class="line">		Api api = Factory.createApi();</span><br><span class="line">		api.hello(<span class="string">"man"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Factory角色</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单工厂类</span></span><br><span class="line"><span class="comment"> * 范围：独立的组件或独立的模块级别</span></span><br><span class="line"><span class="comment"> * 类名：“模块名称+Factory”</span></span><br><span class="line"><span class="comment"> * 方法名：“get+接口名称”或“create+接口名称”</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Factory</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Api <span class="title">createApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 主要实现选择合适的实现类创建实例对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> Impl1();</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Api <span class="title">createApi</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123; <span class="comment">// 缺点，暴露参数的含义</span></span><br><span class="line">		<span class="comment">// 主要实现选择合适的实现类创建实例对象</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 根据type进行选择，1和2应为常量</span></span><br><span class="line">		Api api = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span> (type==<span class="number">1</span>) &#123;</span><br><span class="line">			api = <span class="keyword">new</span> Impl1();</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (type==<span class="number">2</span>) &#123;</span><br><span class="line">			api = <span class="keyword">new</span> Impl2();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 参数来源</span></span><br><span class="line">		<span class="comment">// 1：client</span></span><br><span class="line">		<span class="comment">// 2：配置文件</span></span><br><span class="line">		<span class="comment">// 3：系统自身，比如运行期间的某个值</span></span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> api;</span><br><span class="line">	&#125; </span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Api角色</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">hello</span><span class="params">(String name)</span></span>;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Impl角色Impl1</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Impl1</span> <span class="keyword">implements</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"hello "</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Impl角色Impl2</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Impl2</span> <span class="keyword">implements</span> <span class="title">Api</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"hello "</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂方法">工厂方法</h3>
<h4 id="描述">描述</h4>
<p>定义：定义一个用于创建对象的接口，让子类决定实例化哪一个类。工厂方法模式的本质是延迟到子类来选择实现。</p>
<h4 id="结构">结构</h4>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Product</td>
<td>定义工厂方法所创建的对象的接口，即实际需要使用的对象的接口</td>
</tr>
<tr>
<td>ConcreteProduct</td>
<td>Product接口的实现类</td>
</tr>
<tr>
<td>Creator</td>
<td>抽象的创建器类，声明工厂方法</td>
</tr>
<tr>
<td>ConcreteCreator</td>
<td>具体的创建器类，覆盖实现Creator定义的工厂方法，返回具体的Product实例</td>
</tr>
</tbody>
</table>
<blockquote>
<p>可以使用工厂方法模式连接平行的类层次。</p>
</blockquote>
<h4 id="优缺点">优缺点</h4>
<p>优点</p>
<ol>
<li>可以在不知具体实现的情况下编程</li>
<li>更容易扩展对象的新版本</li>
<li>连接平行的类层次</li>
</ol>
<p>缺点</p>
<ol>
<li>具体产品对象和工厂方法耦合</li>
</ol>
<h4 id="使用场景">使用场景</h4>
<ol>
<li>明确接口但不知具体的实现时，可以使用工厂方法对象将创建Product对象的工作延迟到子类实现</li>
<li>一个类本身期望由其子类创建所需对象</li>
</ol>
<h4 id="示例">示例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导出数据</span></span><br><span class="line"><span class="comment">//示例：导出数据到各种文件，如：数据库备份文件和TXT文件</span></span><br><span class="line"><span class="comment">//Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">/*//创建需要使用的Creator对象</span></span><br><span class="line"><span class="comment">		ExportOperate operate = new ExportDBOperate();</span></span><br><span class="line"><span class="comment">		//调用输出数据的功能方法</span></span><br><span class="line"><span class="comment">		operate.export("测试数据");*/</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 当有默认实现时</span></span><br><span class="line">		ExportOperate operate = <span class="keyword">new</span> ExportOperate();</span><br><span class="line">		operate.export(<span class="string">"测试数据"</span>);</span><br><span class="line">		operate = <span class="keyword">new</span> ExportDBOperate();</span><br><span class="line">		operate.export(<span class="string">"测试数据"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Creator角色，导出的操作类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现导出数据的业务功能对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="comment">/*abstract*/</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportOperate</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 导出文件</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data 需要保存的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 是否成功导出文件</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">export</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		<span class="comment">//使用工厂方法</span></span><br><span class="line">		ExportFileApi api = factoryMethod();</span><br><span class="line">		<span class="keyword">return</span> api.export(data);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 工厂方法，创建导出的文件对象的接口对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 导出的文件对象的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="comment">//protected abstract ExportFileApi factoryMethod();</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> ExportFileApi <span class="title">factoryMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ExportTxtFile();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ConcreteCreator角色，导出到数据库备份文件的类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的创建器实现对象，实现创建导出成数据库备份文件形式的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportDBOperate</span> <span class="keyword">extends</span> <span class="title">ExportOperate</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> ExportFileApi <span class="title">factoryMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建导出成数据库备份文件形式的对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ExportDB();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ConcreteCreator角色，导出到TXT文件的类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的创建器实现对象，实现创建导出成文本文件格式的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportTxtFileOperate</span> <span class="keyword">extends</span> <span class="title">ExportOperate</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> ExportFileApi <span class="title">factoryMethod</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建导出成文本文件格式的对象</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ExportTxtFile();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Product角色，导出数据到文件的接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导出的文件对象的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ExportFileApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 导出内容成为文件</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data 示意：需要保存的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 是否导出成功</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">export</span><span class="params">(String data)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ConcreteProduct角色，导出数据到数据库备份文件的类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导出成数据库备份文件形式的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportDB</span> <span class="keyword">implements</span> <span class="title">ExportFileApi</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">export</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//简单示意一下，这里需要操作数据库和文件</span></span><br><span class="line">		System.out.println(<span class="string">"导出数据"</span>+data+<span class="string">"到数据库备份文件"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ConcreteProduct角色，导出数据到TXT文件的类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 导出成文本文件格式的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportTxtFile</span> <span class="keyword">implements</span> <span class="title">ExportFileApi</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">export</span><span class="params">(String data)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//简单示意一下，这里需要操作文件</span></span><br><span class="line">		System.out.println(<span class="string">"导出数据"</span>+data+<span class="string">"到文本文件"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="抽象工厂">抽象工厂</h3>
<h4 id="描述">描述</h4>
<p>定义：提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。本质是选择产品簇的实现。</p>
<h4 id="结构">结构</h4>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AbstractFactory</td>
<td>抽象工厂，定义创建一系列产品对象的操作接口</td>
</tr>
<tr>
<td>ConcreteFactory</td>
<td>具体工厂，实现抽象工厂定义的方法，具体实现一系列产品对象的创建</td>
</tr>
<tr>
<td>AbstractProduct</td>
<td>定义一类产品对象的接口</td>
</tr>
<tr>
<td>ConcreteProduct</td>
<td>具体的产品实现对象</td>
</tr>
<tr>
<td>Client</td>
<td>客户端</td>
</tr>
</tbody>
</table>
<h4 id="优缺点">优缺点</h4>
<p>优点</p>
<ol>
<li>分离接口和实现</li>
<li>容易切换产品簇</li>
</ol>
<p>缺点</p>
<ol>
<li>不容易扩展新的产品</li>
<li>容易造成类层次复杂</li>
</ol>
<h4 id="使用场景">使用场景</h4>
<ol>
<li>一个系统只知道产品的接口而不关心实现时</li>
<li>需要动态切换产品簇时</li>
<li>需要强调一系列相关产品的接口，以便联合使用它们时</li>
</ol>
<h4 id="示例">示例</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：组装电脑</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建装机工程师对象</span></span><br><span class="line">		ComputerEngineer engineer = <span class="keyword">new</span> ComputerEngineer();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户选择并创建需要使用的装机方案对象</span></span><br><span class="line">		AbstractFactory schema = <span class="keyword">new</span> Schema1();</span><br><span class="line">		<span class="comment">//告诉装机工程师自己选择的装机方案，让装机工程师组装电脑</span></span><br><span class="line">		engineer.makeComputer(schema);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//客户选择并创建需要使用的装机方案对象</span></span><br><span class="line">		schema = <span class="keyword">new</span> Schema2();</span><br><span class="line">		<span class="comment">//告诉装机工程师自己选择的装机方案，让装机工程师组装电脑</span></span><br><span class="line">		engineer.makeComputer(schema);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//装机工程师类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装机工程师的类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">ComputerEngineer</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义组装机器需要的CPU</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CPUApi cpu= <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义组装机器需要的主板</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> MainboardApi mainboard = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 装机过程</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> schema 客户选择的装机方案</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">makeComputer</span><span class="params">(AbstractFactory schema)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：首先准备好装机所需要的配件</span></span><br><span class="line">		prepareHardwares(schema);</span><br><span class="line">		<span class="comment">//2：组装机器</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3：测试机器</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4：交付客户</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 准备装机所需要的配件</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> schema 客户选择的装机方案</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">prepareHardwares</span><span class="params">(AbstractFactory schema)</span></span>&#123;</span><br><span class="line">		<span class="comment">//这里要去准备CPU和主板的具体实现，为了示例简单，这里只准备这两个</span></span><br><span class="line">		<span class="comment">//可是，装机工程师并不知道如何去创建，怎么办呢？</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//使用抽象工厂来获取相应的接口对象</span></span><br><span class="line">		<span class="keyword">this</span>.cpu = schema.createCPUApi();</span><br><span class="line">		<span class="keyword">this</span>.mainboard = schema.createMainboardApi();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试一下配件是否好用</span></span><br><span class="line">		<span class="keyword">this</span>.cpu.calculate();</span><br><span class="line">		<span class="keyword">this</span>.mainboard.installCPU();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//抽象工厂类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象工厂的接口，声明创建抽象产品对象的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AbstractFactory</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建CPU的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> CPU的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> CPUApi <span class="title">createCPUApi</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建主板的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 主板的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> MainboardApi <span class="title">createMainboardApi</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//抽象工厂实现类1</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装机方案一：Intel 的CPU + 技嘉的主板</span></span><br><span class="line"><span class="comment"> * 这里创建CPU和主板对象的时候，是对应的，能匹配上的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Schema1</span> <span class="keyword">implements</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> CPUApi <span class="title">createCPUApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> IntelCPU(<span class="number">1156</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> MainboardApi <span class="title">createMainboardApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> GAMainboard(<span class="number">1156</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//抽象工厂实现类2</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装机方案二：AMD的CPU + 微星的主板</span></span><br><span class="line"><span class="comment"> * 这里创建CPU和主板对象的时候，是对应的，能匹配上的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Schema2</span> <span class="keyword">implements</span> <span class="title">AbstractFactory</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> CPUApi <span class="title">createCPUApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> AMDCPU(<span class="number">939</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> MainboardApi <span class="title">createMainboardApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MSIMainboard(<span class="number">939</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CPU接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CPU的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CPUApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意方法，CPU具有运算的功能</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calculate</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CPU实现类1</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *Intel的CPU实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IntelCPU</span> <span class="keyword">implements</span> <span class="title">CPUApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> pins = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pins CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">IntelCPU</span><span class="params">(<span class="keyword">int</span> pins)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pins = pins;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calculate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in Intel CPU,pins="</span>+pins);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CPU实现类2</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AMD的CPU实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AMDCPU</span> <span class="keyword">implements</span> <span class="title">CPUApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> pins = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pins CPU的针脚数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AMDCPU</span><span class="params">(<span class="keyword">int</span> pins)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pins = pins;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calculate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in AMD CPU,pins="</span>+pins);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主板接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主板的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainboardApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意方法，主板都具有安装CPU的功能</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installCPU</span><span class="params">()</span></span>;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主板实现类1</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 技嘉的主板 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GAMainboard</span> <span class="keyword">implements</span> <span class="title">MainboardApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> cpuHoles = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cpuHoles CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GAMainboard</span><span class="params">(<span class="keyword">int</span> cpuHoles)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cpuHoles = cpuHoles;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installCPU</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in GAMainboard,cpuHoles="</span>+cpuHoles);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//主板实现类2</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微星的主板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MSIMainboard</span> <span class="keyword">implements</span> <span class="title">MainboardApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> cpuHoles = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cpuHoles CPU插槽的孔数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MSIMainboard</span><span class="params">(<span class="keyword">int</span> cpuHoles)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cpuHoles = cpuHoles;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">installCPU</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in MSIMainboard,cpuHoles="</span>+cpuHoles);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="单例模式">单例模式</h2>
<h3 id="描述">描述</h3>
<p>定义：保证一个类仅有一个实例，并提供一个访问它的全局访问点。本质是控制实例的数目。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Singleton</td>
<td>负责创建Singleton类自身的唯一实例，并提供一个可以被外部调用的getInstance的方法</td>
</tr>
</tbody>
</table>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>懒汉式是时间换空间</li>
<li>饿汉式是空间换时间</li>
</ol>
<p>缺点</p>
<ol>
<li>双重检查加锁的懒汉式需要确保线程安全</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需控制一个类的实例只有一个且客户只能从一个全局访问点访问其时</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//控制类的实例个数（未考虑线程安全）</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 简单演示如何扩展单例模式，控制实例数目为3个 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OneExtend</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义一个缺省的key值的前缀</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String DEFAULT_PREKEY = <span class="string">"Cache"</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 缓存实例的容器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//实例调度的问题</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,OneExtend&gt; map = <span class="keyword">new</span> HashMap&lt;String,OneExtend&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录当前正在使用第几个实例，到了控制的最大数目，就返回从1开始</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义控制实例的最大数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> <span class="keyword">int</span> NUM_MAX = <span class="number">3</span>; </span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">OneExtend</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> OneExtend <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		String key = DEFAULT_PREKEY+num;</span><br><span class="line">		OneExtend oneExtend = map.get(key);</span><br><span class="line">		<span class="keyword">if</span>(oneExtend==<span class="keyword">null</span>)&#123;</span><br><span class="line">			oneExtend = <span class="keyword">new</span> OneExtend();</span><br><span class="line">			map.put(key, oneExtend);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//把当前实例的序号加1</span></span><br><span class="line">		num++;</span><br><span class="line">		<span class="keyword">if</span>(num &gt; NUM_MAX)&#123;</span><br><span class="line">			<span class="comment">//如果实例的序号已经达到最大数目了，那就重复从1开始获取</span></span><br><span class="line">			num = <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> oneExtend;		</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		OneExtend t1 = getInstance();</span><br><span class="line">		OneExtend t2 = getInstance();</span><br><span class="line">		OneExtend t3 = getInstance();</span><br><span class="line">		OneExtend t4 = getInstance();</span><br><span class="line">		OneExtend t5 = getInstance();</span><br><span class="line">		OneExtend t6 = getInstance();</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"t1=="</span>+t1);</span><br><span class="line">		System.out.println(<span class="string">"t2=="</span>+t2);</span><br><span class="line">		System.out.println(<span class="string">"t3=="</span>+t3);</span><br><span class="line">		System.out.println(<span class="string">"t4=="</span>+t4);</span><br><span class="line">		System.out.println(<span class="string">"t5=="</span>+t5);</span><br><span class="line">		System.out.println(<span class="string">"t6=="</span>+t6);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//饿汉式</span></span><br><span class="line"><span class="comment">//示例：饿汉式单例（以空间换时间）</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 饿汉式单例实现的示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义一个变量来存储创建好的类实例，直接在这里创建类实例，只会创建一次</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Singleton uniqueInstance = <span class="keyword">new</span> Singleton();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 私有化构造方法，好在内部控制创建实例的数目</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义一个方法来为客户端提供类实例</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 一个Singleton的实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//直接使用已经创建好的实例</span></span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意方法，单例可以有自己的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">singletonOperation</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//功能处理</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意属性，单例可以有自己的属性</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String singletonData;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意方法，让外部通过这些方法来访问属性的值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 属性的值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSingletonData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> singletonData;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//懒汉式</span></span><br><span class="line"><span class="comment">//示例：双重检查加锁的懒汉式单例（以时间换空间）</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对保存实例的变量添加volatile的修饰</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//先检查实例是否存在，如果不存在才进入下面的同步块</span></span><br><span class="line">		<span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//同步块，线程安全的创建实例</span></span><br><span class="line">			<span class="keyword">synchronized</span>(Singleton.class)&#123;</span><br><span class="line">				<span class="comment">//再次检查实例是否存在，如果不存在才真的创建实例</span></span><br><span class="line">				<span class="keyword">if</span>(instance == <span class="keyword">null</span>)&#123;</span><br><span class="line">					instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例：使用类的内部类实现的单例</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Singleton</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 类级的内部类，也就是静态的成员式内部类，该内部类的实例与外部类的实例没有绑定关系，</span></span><br><span class="line"><span class="comment">	 * 而且只有被调用到才会装载，从而实现了延迟加载</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SingletonHolder</span></span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 静态初始化器，由JVM来保证线程安全</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">static</span> Singleton instance = <span class="keyword">new</span> Singleton();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 私有化构造方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Singleton</span><span class="params">()</span></span>&#123;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  Singleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> SingletonHolder.instance;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//示例：使用枚举实现单例（效率高）</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用枚举来实现单例模式的示例</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> EnumSingleton &#123;	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 定义一个枚举的元素,它就代表了Singleton的一个实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	uniqueInstance;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  EnumSingleton <span class="title">getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> uniqueInstance;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="生成器模式">生成器模式</h2>
<h3 id="描述">描述</h3>
<p>定义：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。本质是分离整体构建算法和部件构造。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Builder</td>
<td>生成器接口，定义创建一个Product对象所需的各个部件的操作</td>
</tr>
<tr>
<td>ConcreteBuilder</td>
<td>生成器类，实现各个部件的创建，并负责组装Product对象的各个部件，同时提供一个让客户获取组装完成后的产品对象的方法</td>
</tr>
<tr>
<td>Diector</td>
<td>指导者，也被称为导向者，主要用于调用Builder接口，以一个统一的过程构建所需的Product对象</td>
</tr>
<tr>
<td>Product</td>
<td>产品，表示生成器构建的复杂对象，包含多个部件</td>
</tr>
</tbody>
</table>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>松散耦合</li>
<li>便于变换产品的内部表示</li>
<li>更好的复用性<br>
2.1.3.3 使用场景</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>同一个构建过程有着不同的表示</li>
<li>创建对象的算法独立于该对象的组成部分以及它们的装配方式</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//构建构建部件类似的对象</span></span><br><span class="line"><span class="comment">//示例：导出数据的应用框架</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//准备测试数据</span></span><br><span class="line">		ExportHeaderModel ehm = <span class="keyword">new</span> ExportHeaderModel();</span><br><span class="line">		ehm.setDepId(<span class="string">"一分公司"</span>);</span><br><span class="line">		ehm.setExportDate(<span class="string">"2010-05-18"</span>);</span><br><span class="line">		</span><br><span class="line">		Map&lt;String,Collection&lt;ExportDataModel&gt;&gt; mapData = <span class="keyword">new</span> HashMap&lt;String,Collection&lt;ExportDataModel&gt;&gt;();</span><br><span class="line">		Collection&lt;ExportDataModel&gt; col = <span class="keyword">new</span> ArrayList&lt;ExportDataModel&gt;();</span><br><span class="line">		</span><br><span class="line">		ExportDataModel edm1 = <span class="keyword">new</span> ExportDataModel();</span><br><span class="line">		edm1.setProductId(<span class="string">"产品001号"</span>);</span><br><span class="line">		edm1.setPrice(<span class="number">100</span>);</span><br><span class="line">		edm1.setAmount(<span class="number">80</span>);</span><br><span class="line">		</span><br><span class="line">		ExportDataModel edm2 = <span class="keyword">new</span> ExportDataModel();</span><br><span class="line">		edm2.setProductId(<span class="string">"产品002号"</span>);</span><br><span class="line">		edm2.setPrice(<span class="number">99</span>);</span><br><span class="line">		edm2.setAmount(<span class="number">55</span>);		</span><br><span class="line">		<span class="comment">//把数据组装起来</span></span><br><span class="line">		col.add(edm1);</span><br><span class="line">		col.add(edm2);		</span><br><span class="line">		mapData.put(<span class="string">"销售记录表"</span>, col);</span><br><span class="line">		</span><br><span class="line">		ExportFooterModel efm = <span class="keyword">new</span> ExportFooterModel();</span><br><span class="line">		efm.setExportUser(<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试输出到文本文件</span></span><br><span class="line">		TxtBuilder txtBuilder = <span class="keyword">new</span> TxtBuilder();</span><br><span class="line">		<span class="comment">//创建指导者对象</span></span><br><span class="line">		Director director = <span class="keyword">new</span> Director(txtBuilder);</span><br><span class="line">		director.construct(ehm, mapData, efm);</span><br><span class="line">		<span class="comment">//把要输出的内容输出到控制台看看</span></span><br><span class="line">		System.out.println(<span class="string">"输出到文本文件的内容：\n"</span>+txtBuilder.getResult());</span><br><span class="line">		<span class="comment">//测试输出到xml文件</span></span><br><span class="line">		XmlBuilder xmlBuilder = <span class="keyword">new</span> XmlBuilder();</span><br><span class="line">		Director director2 = <span class="keyword">new</span> Director(xmlBuilder);</span><br><span class="line">		director2.construct(ehm, mapData, efm);</span><br><span class="line">		<span class="comment">//把要输出的内容输出到控制台看看</span></span><br><span class="line">		System.out.println(<span class="string">"输出到XML文件的内容：\n"</span>+xmlBuilder.getResult());</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Director类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指导者，指导使用构建器的接口来构建输出的文件的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有当前需要使用的构建器对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Builder builder;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入构建器对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> builder 构建器对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.builder = builder;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 指导构建器构建最终的输出的文件的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ehm 文件头的内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mapData 数据的内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> efm 文件尾的内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">construct</span><span class="params">(ExportHeaderModel ehm,Map&lt;String,Collection&lt;ExportDataModel&gt;&gt; mapData,ExportFooterModel efm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先构建Header</span></span><br><span class="line">		builder.buildHeader(ehm);</span><br><span class="line">		<span class="comment">//2：然后构建Body</span></span><br><span class="line">		builder.buildBody(mapData);</span><br><span class="line">		<span class="comment">//3：然后构建Footer</span></span><br><span class="line">		builder.buildFooter(efm);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Builder接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构建器接口，定义创建一个输出文件对象所需的各个部件的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构建输出文件的Header部分</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ehm 文件头的内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构建输出文件的Body部分</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mapData 要输出的数据的内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(Map&lt;String,Collection&lt;ExportDataModel&gt;&gt; mapData)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构建输出文件的Footer部分</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> efm 文件尾的内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//TxtBuilder类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现导出数据到文本文件的的构建器对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxtBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录构建的文件的内容，相当于产品</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			Map&lt;String, Collection&lt;ExportDataModel&gt;&gt; mapData)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span>(String tblName : mapData.keySet())&#123;</span><br><span class="line">			<span class="comment">//先拼接表名称</span></span><br><span class="line">			buffer.append(tblName+<span class="string">"\n"</span>);</span><br><span class="line">			<span class="comment">//然后循环拼接具体数据</span></span><br><span class="line">			<span class="keyword">for</span>(ExportDataModel edm : mapData.get(tblName))&#123;</span><br><span class="line">				buffer.append(edm.getProductId()+<span class="string">","</span>+edm.getPrice()+<span class="string">","</span>+edm.getAmount()+<span class="string">"\n"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span> </span>&#123;</span><br><span class="line">		buffer.append(efm.getExportUser());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span> </span>&#123;</span><br><span class="line">		buffer.append(ehm.getDepId()+<span class="string">","</span>+ehm.getExportDate()+<span class="string">"\n"</span>);</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringBuffer <span class="title">getResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> buffer;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//XmlBuilder类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现导出数据到XML文件的的构建器对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录构建的文件的内容，相当于产品</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> StringBuffer buffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">			Map&lt;String, Collection&lt;ExportDataModel&gt;&gt; mapData)</span> </span>&#123;</span><br><span class="line">		buffer.append(<span class="string">"  &lt;Body&gt;\n"</span>);</span><br><span class="line">		<span class="keyword">for</span>(String tblName : mapData.keySet())&#123;</span><br><span class="line">			<span class="comment">//先拼接表名称</span></span><br><span class="line">			buffer.append(<span class="string">"    &lt;Datas TableName=\""</span>+tblName+<span class="string">"\"&gt;\n"</span>);</span><br><span class="line">			<span class="comment">//然后循环拼接具体数据</span></span><br><span class="line">			<span class="keyword">for</span>(ExportDataModel edm : mapData.get(tblName))&#123;</span><br><span class="line">				buffer.append(<span class="string">"      &lt;Data&gt;\n"</span>);</span><br><span class="line">				buffer.append(<span class="string">"        &lt;ProductId&gt;"</span>+edm.getProductId()+<span class="string">"&lt;/ProductId&gt;\n"</span>);</span><br><span class="line">				buffer.append(<span class="string">"        &lt;Price&gt;"</span>+edm.getPrice()+<span class="string">"&lt;/Price&gt;\n"</span>);</span><br><span class="line">				buffer.append(<span class="string">"        &lt;Amount&gt;"</span>+edm.getAmount()+<span class="string">"&lt;/Amount&gt;\n"</span>);</span><br><span class="line">				buffer.append(<span class="string">"      &lt;/Data&gt;\n"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			buffer.append(<span class="string">"    &lt;/Datas&gt;\n"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		buffer.append(<span class="string">"  &lt;/Body&gt;\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span> </span>&#123;</span><br><span class="line">		buffer.append(<span class="string">"  &lt;Footer&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"    &lt;ExportUser&gt;"</span>+efm.getExportUser()+<span class="string">"&lt;/ExportUser&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"  &lt;/Footer&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"&lt;/Report&gt;\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span> </span>&#123;</span><br><span class="line">		buffer.append(<span class="string">"&lt;?xml version='1.0' encoding='gb2312'?&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"&lt;Report&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"  &lt;Header&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"    &lt;DepId&gt;"</span>+ehm.getDepId()+<span class="string">"&lt;/DepId&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"    &lt;ExportDate&gt;"</span>+ehm.getExportDate()+<span class="string">"&lt;/ExportDate&gt;\n"</span>);</span><br><span class="line">		buffer.append(<span class="string">"  &lt;/Header&gt;\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringBuffer <span class="title">getResult</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> buffer;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导出的头模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述输出到文件头的内容的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportHeaderModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分公司或门市点编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String depId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 导出数据的日期</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String exportDate;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getDepId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> depId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepId</span><span class="params">(String depId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.depId = depId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getExportDate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> exportDate;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExportDate</span><span class="params">(String exportDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.exportDate = exportDate;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导出的数据体模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述输出数据的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportDataModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 产品编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String productId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 销售价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> price;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 销售数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> amount;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProductId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductId</span><span class="params">(String productId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productId = productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.price = price;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> amount;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.amount = amount;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//导出的脚模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 描述输出到文件尾的内容的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportFooterModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出人</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String exportUser;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getExportUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> exportUser;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExportUser</span><span class="params">(String exportUser)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.exportUser = exportUser;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构建复杂对象</span></span><br><span class="line"><span class="comment">//示例：构建保险合同对象</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建构建器</span></span><br><span class="line">		ConcreteBuilder builder = InsuranceContract.createConcreteBuilder(<span class="string">"001"</span>,<span class="number">12345L</span>,<span class="number">67890L</span>);</span><br><span class="line">		<span class="comment">//设置需要的数据，然后构建保险合同对象</span></span><br><span class="line">		InsuranceContract contract = builder.setPersonName(<span class="string">"张三"</span>).setOtherData(<span class="string">"test"</span>).build();</span><br><span class="line">		<span class="comment">//操作保险合同对象的方法</span></span><br><span class="line">		contract.someOperation();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//保险合同类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 保险合同的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InsuranceContract</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保险合同编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String contractId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 被保险人员的名称，同一份保险合同，要么跟人员签订，要么跟公司签订，</span></span><br><span class="line"><span class="comment">	 * 也就是说，"被保险人员"和"被保险公司"这两个属性，不可能同时有值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String personName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 被保险公司的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String companyName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保险开始生效的日期</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> beginDate;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保险失效的日期，一定会大于保险开始生效的日期</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">long</span> endDate;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示例：其它数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String otherData;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，访问级别是私有的</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">InsuranceContract</span><span class="params">(ConcreteBuilder builder)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.contractId = builder.contractId;</span><br><span class="line">		<span class="keyword">this</span>.personName = builder.personName;</span><br><span class="line">		<span class="keyword">this</span>.companyName = builder.companyName;</span><br><span class="line">		<span class="keyword">this</span>.beginDate = builder.beginDate;</span><br><span class="line">		<span class="keyword">this</span>.endDate = builder.endDate;</span><br><span class="line">		<span class="keyword">this</span>.otherData = builder.otherData;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 工厂方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> contractId</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> beginDate</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> endDate</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ConcreteBuilder <span class="title">createConcreteBuilder</span><span class="params">(String contractId,<span class="keyword">long</span> beginDate,<span class="keyword">long</span> endDate)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ConcreteBuilder(contractId,beginDate,endDate);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造保险合同对象的构建器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> </span>&#123;</span><br><span class="line">		<span class="keyword">private</span> String contractId;</span><br><span class="line">		<span class="keyword">private</span> String personName;</span><br><span class="line">		<span class="keyword">private</span> String companyName;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">long</span> beginDate;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">long</span> endDate;</span><br><span class="line">		<span class="keyword">private</span> String otherData;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 构造方法，访问级别是私有的父类的createConcreteBuilder方法创建，必须由，传入必须要有的参数</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> contractId 保险合同编号</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> beginDate 保险开始生效的日期</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> endDate 保险失效的日期</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="function"><span class="keyword">private</span> <span class="title">ConcreteBuilder</span><span class="params">(String contractId,<span class="keyword">long</span> beginDate,<span class="keyword">long</span> endDate)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.contractId = contractId;</span><br><span class="line">			<span class="keyword">this</span>.beginDate = beginDate;</span><br><span class="line">			<span class="keyword">this</span>.endDate = endDate;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 选填数据，被保险人员的名称</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> personName  被保险人员的名称</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 构建器对象</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> ConcreteBuilder <span class="title">setPersonName</span><span class="params">(String personName)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.personName = personName;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 *  选填数据，被保险公司的名称</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> companyName 被保险公司的名称</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 构建器对象</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> ConcreteBuilder <span class="title">setCompanyName</span><span class="params">(String companyName)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.companyName = companyName;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 选填数据，其它数据</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@param</span> otherData 其它数据</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 构建器对象</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> ConcreteBuilder <span class="title">setOtherData</span><span class="params">(String otherData)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.otherData = otherData;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 构建真正的对象并返回</span></span><br><span class="line"><span class="comment">		 * <span class="doctag">@return</span> 构建的保险合同的对象</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> InsuranceContract <span class="title">build</span><span class="params">()</span></span>&#123;</span><br><span class="line">			<span class="keyword">if</span>(contractId==<span class="keyword">null</span> || contractId.trim().length()==<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"合同编号不能为空"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">boolean</span> signPerson = personName!=<span class="keyword">null</span> &amp;&amp; personName.trim().length()&gt;<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">boolean</span> signCompany = companyName!=<span class="keyword">null</span> &amp;&amp; companyName.trim().length()&gt;<span class="number">0</span>;</span><br><span class="line">			<span class="keyword">if</span>(signPerson &amp;&amp; signCompany)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"一份保险合同不能同时与人和公司签订"</span>);</span><br><span class="line">			&#125;		</span><br><span class="line">			<span class="keyword">if</span>(signPerson==<span class="keyword">false</span> &amp;&amp; signCompany==<span class="keyword">false</span>)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"一份保险合同不能没有签订对象"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(beginDate&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"合同必须有保险开始生效的日期"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(endDate&lt;=<span class="number">0</span>)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"合同必须有保险失效的日期"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(endDate&lt;=beginDate)&#123;</span><br><span class="line">				<span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"保险失效的日期必须大于保险生效日期"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> InsuranceContract(<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意：保险合同的某些操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">someOperation</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"Now in Insurance Contract someOperation=="</span>+<span class="keyword">this</span>.contractId);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="原型模式">原型模式</h2>
<h3 id="描述">描述</h3>
<p>定义：用原型实例指定创建对象的种类，并通过复制其原型创建新的对象。本质是克隆生成对象。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prototype</td>
<td>声明一个克隆自身的接口，用于约束克隆自身的类，要求它们都要实现原型接口定义的克隆方法</td>
</tr>
<tr>
<td>ConcretePrototype</td>
<td>实现Prototype接口的类</td>
</tr>
<tr>
<td>Client</td>
<td>使用原型的客户端</td>
</tr>
</tbody>
</table>
<p>浅度克隆：只负责克隆按值传递的数据。<br>
深度克隆：既克隆按值传递的数据，也克隆引用类型的数据（有可能需要递归克隆）。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>对客户端隐藏具体的实现类型</li>
<li>在运行时动态改变具体的实现类型</li>
</ol>
<p>缺点</p>
<ol>
<li>难以实现深度克隆</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>新的对象实例需要复用已存在的实例部分或全部属性时，可以使用原型模式</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订单拆分</span></span><br><span class="line"><span class="comment">//示例：订单拆分</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//客户端类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderClient</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建订单对象，这里为了演示简单，直接new了</span></span><br><span class="line">		PersonalOrder op = <span class="keyword">new</span> PersonalOrder();</span><br><span class="line">		<span class="comment">//设置订单数据</span></span><br><span class="line">		op.setOrderProductNum(<span class="number">3925</span>);</span><br><span class="line">		op.setCustomerName(<span class="string">"张三"</span>);</span><br><span class="line">		op.setProductId(<span class="string">"P0001"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//这里获取业务处理的类，也直接new了，为了简单，连业务接口都没有做</span></span><br><span class="line">		OrderBusiness ob = <span class="keyword">new</span> OrderBusiness();</span><br><span class="line">		<span class="comment">//调用业务来保存订单对象</span></span><br><span class="line">		ob.saveOrder(op);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//业务类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 处理订单的业务对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderBusiness</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建订单的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> order 订单的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveOrder</span><span class="params">(OrderApi order)</span></span>&#123;</span><br><span class="line">		<span class="comment">//根据业务要求，当订单的预定的产品数量超过1000的时候，就需要把订单拆成两份订单</span></span><br><span class="line">		<span class="comment">//当然如果要做好，这里的1000应该做成常量，这么做是为了演示简单</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//1：判断当前的预定产品数量是否大于1000</span></span><br><span class="line">		<span class="keyword">while</span>(order.getOrderProductNum() &gt; <span class="number">1000</span>)&#123;</span><br><span class="line">			<span class="comment">//2：如果大于，还需要继续拆分</span></span><br><span class="line">			<span class="comment">//2.1再新建一份订单，跟传入的订单除了数量不一样外，其他都相同</span></span><br><span class="line">			OrderApi newOrder = order.cloneOrder();</span><br><span class="line">			<span class="comment">//然后进行赋值，产品数量为1000</span></span><br><span class="line">			newOrder.setOrderProductNum(<span class="number">1000</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//2.2原来的订单保留，把数量设置成减少1000</span></span><br><span class="line">			order.setOrderProductNum(order.getOrderProductNum()-<span class="number">1000</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//然后是业务功能处理，省略了，打印输出，看一下</span></span><br><span class="line">			System.out.println(<span class="string">"拆分生成订单=="</span>+newOrder);</span><br><span class="line">		&#125;		</span><br><span class="line">		<span class="comment">//3：不超过，那就直接业务功能处理，省略了，打印输出，看一下</span></span><br><span class="line">		System.out.println(<span class="string">"订单=="</span>+order);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//订单接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单的接口，声明了可以克隆自身的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取订单产品数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 订单中产品数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderProductNum</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置订单产品数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> num 订单产品数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderProductNum</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 克隆方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 订单原型的实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> OrderApi <span class="title">cloneOrder</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//个人订单类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 个人订单对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonalOrder</span> <span class="keyword">implements</span> <span class="title">OrderApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 订购人员姓名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String customerName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 产品编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String productId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 订单产品数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> orderProductNum = <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderProductNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.orderProductNum;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderProductNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderProductNum = num;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getCustomerName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> customerName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomerName</span><span class="params">(String customerName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.customerName = customerName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProductId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductId</span><span class="params">(String productId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productId = productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"本个人订单的订购人是="</span>+<span class="keyword">this</span>.customerName+<span class="string">"，订购产品是="</span>+<span class="keyword">this</span>.productId+<span class="string">"，订购数量为="</span>+<span class="keyword">this</span>.orderProductNum;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> OrderApi <span class="title">cloneOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建一个新的订单，然后把本实例的数据复制过去</span></span><br><span class="line">		PersonalOrder order = <span class="keyword">new</span> PersonalOrder();</span><br><span class="line">		order.setCustomerName(<span class="keyword">this</span>.customerName);</span><br><span class="line">		order.setProductId(<span class="keyword">this</span>.productId);</span><br><span class="line">		order.setOrderProductNum(<span class="keyword">this</span>.orderProductNum);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> order;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//企业订单类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 企业订单对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EnterpriseOrder</span> <span class="keyword">implements</span> <span class="title">OrderApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 企业名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String enterpriseName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 产品编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String productId;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 订单产品数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> orderProductNum = <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderProductNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.orderProductNum;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderProductNum</span><span class="params">(<span class="keyword">int</span> num)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderProductNum = num;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getEnterpriseName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> enterpriseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnterpriseName</span><span class="params">(String enterpriseName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.enterpriseName = enterpriseName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProductId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductId</span><span class="params">(String productId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productId = productId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"本企业订单的订购企业是="</span>+<span class="keyword">this</span>.enterpriseName+<span class="string">"，订购产品是="</span>+<span class="keyword">this</span>.productId+<span class="string">"，订购数量为="</span>+<span class="keyword">this</span>.orderProductNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> OrderApi <span class="title">cloneOrder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建一个新的订单，然后把本实例的数据复制过去</span></span><br><span class="line">		EnterpriseOrder order = <span class="keyword">new</span> EnterpriseOrder();</span><br><span class="line">		order.setEnterpriseName(<span class="keyword">this</span>.enterpriseName);</span><br><span class="line">		order.setProductId(<span class="keyword">this</span>.productId);</span><br><span class="line">		order.setOrderProductNum(<span class="keyword">this</span>.orderProductNum);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> order;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="结构型">结构型</h1>
<blockquote>
<p>结构型模式是描述如何组合类和对象以获得更大的结构。</p>
</blockquote>
<h2 id="外观模式">外观模式</h2>
<h3 id="描述">描述</h3>
<p>定义：为子系统中的一组接口提供一个一致的界面，Façade模式定义了一个高层接口，使得其子系统更加容易使用。本质是封装交互，简化调用。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Facede</td>
<td>定义子系统的多个模块对外的高层接口</td>
</tr>
<tr>
<td>模块</td>
<td>接受Façade的委派，真正实现功能，各个模块间可能有交互</td>
</tr>
</tbody>
</table>
<h3 id="外观模式的实现">外观模式的实现</h3>
<ol>
<li>作为辅助工具类实现。</li>
<li>作为interface实现，可以有选择性的暴露接口方法，尽量减少模块对子系统外提供的接口方法。</li>
</ol>
<p>组合简单工厂模式使用</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>松散耦合</li>
<li>简单易用</li>
<li>更好划分访问层次</li>
</ol>
<p>缺点</p>
<ol>
<li>过多或不太合理的Façade会使系统过于复杂</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>为一个复杂的子系统提供一个简单接口时，可以使用外观对象实现大部分客户需要的功能，简化客户的使用。</li>
<li>为使客户程序和抽象类的实现部分松散耦合，可以使用外观对象将这个子系统与客户程序分离，提高子系统的独立性和可移植性。</li>
<li>在构建多层结构的系统时，可以使用外观对象作为每层的入口，以简化层间调用，同时松散层次之间的依赖关系。</li>
</ol>
<h3 id="示例">示例</h3>
<p>略。</p>
<h2 id="适配器模式">适配器模式</h2>
<h3 id="描述">描述</h3>
<p>定义：将一个类的接口转换成客户期望的另外一个接口，使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。本质是转换匹配，复用功能。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Client</td>
<td>客户端，调用自身需要的领域接口Target</td>
</tr>
<tr>
<td>Target</td>
<td>定义客户端需要的跟特定领域相关的接口</td>
</tr>
<tr>
<td>Adaptee</td>
<td>已存在的接口，但与客户端要求的特定领域接口不一致，需要被适配</td>
</tr>
<tr>
<td>Adapter</td>
<td>适配器，将Adaptee适配成为Client需要的Target</td>
</tr>
</tbody>
</table>
<p>智能适配器：可以在适配器加入新功能的实现。</p>
<p>缺省适配：为一个接口提供缺省实现。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>更好的复用性</li>
<li>更好的可扩展性</li>
</ol>
<p>缺点</p>
<ol>
<li>过多的使用，会使系统混乱，不容易进行整体把握</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>已存在的类不符合客户端调用需求，可以使用适配器对象转换成需要的接口</li>
<li>需创建一个可复用的类，这个类可能和不兼容的类一起工作，可以使用适配器模式以期需要什么就适配什么</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//记录日志（单向适配）</span></span><br><span class="line"><span class="comment">//示例：已存在文件记录日志接口，新加数据库记录日志接口（单向适配，客户端调用数//据库记录日志接口实现文件记录日志功能）</span></span><br><span class="line"><span class="comment">//Client角色</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//准备日志内容，也就是测试的数据</span></span><br><span class="line">		LogModel lm1 = <span class="keyword">new</span> LogModel();</span><br><span class="line">		lm1.setLogId(<span class="string">"001"</span>);</span><br><span class="line">		lm1.setOperateUser(<span class="string">"admin"</span>);</span><br><span class="line">		lm1.setOperateTime(<span class="string">"2010-03-02 10:08:18"</span>);</span><br><span class="line">		lm1.setLogContent(<span class="string">"这是一个测试"</span>);</span><br><span class="line">		</span><br><span class="line">		List&lt;LogModel&gt; list = <span class="keyword">new</span> ArrayList&lt;LogModel&gt;();</span><br><span class="line">		list.add(lm1);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建操作日志文件的对象</span></span><br><span class="line">		LogFileOperateApi logFileApi = <span class="keyword">new</span> LogFileOperate(<span class="string">""</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建新版的操作日志的接口对象</span></span><br><span class="line">		LogDbOperateApi api = <span class="keyword">new</span> Adapter(logFileApi); </span><br><span class="line">		</span><br><span class="line">		<span class="comment">//保存日志文件</span></span><br><span class="line">		api.createLog(lm1);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//读取日志文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; allLog = api.getAllLog();</span><br><span class="line">		System.out.println(<span class="string">"allLog="</span>+allLog);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Target角色，数据库记录日志接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义操作日志的应用接口，为了示例的简单，</span></span><br><span class="line"><span class="comment"> * 只是简单的定义了增删改查的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogDbOperateApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 新增日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要新增的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 修改日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要修改的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要删除的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取所有的日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 所有的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">getAllLog</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Adaptee角色，文件记录日志接口及其实现类</span></span><br><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志文件操作接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogFileOperateApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读取日志文件，从文件里面获取存储的日志列表对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 存储的日志列表对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">readLogFile</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 写日志文件，把日志列表写出到日志文件中去</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> list 要写到日志文件的日志列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLogFile</span><span class="params">(List&lt;LogModel&gt; list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现对日志文件的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFileOperate</span> <span class="keyword">implements</span> <span class="title">LogFileOperateApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志文件的路径和文件名称，默认是当前classpath下的AdapterLog.log</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logFilePathName = <span class="string">"AdapterLog.log"</span>;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入文件的路径和名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> logFilePathName 文件的路径和名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LogFileOperate</span><span class="params">(String logFilePathName)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先判断是否传入了文件的路径和名称，如果是，</span></span><br><span class="line">		<span class="comment">//就重新设置操作的日志文件的路径和名称</span></span><br><span class="line">		<span class="keyword">if</span>(logFilePathName!=<span class="keyword">null</span> &amp;&amp; logFilePathName.trim().length()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">this</span>.logFilePathName = logFilePathName;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span>  List&lt;LogModel&gt; <span class="title">readLogFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;LogModel&gt; list = <span class="keyword">null</span>;</span><br><span class="line">		ObjectInputStream oin = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			File f = <span class="keyword">new</span> File(logFilePathName);</span><br><span class="line">			<span class="keyword">if</span>(f.exists())&#123;</span><br><span class="line">				oin = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">						<span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(f))</span><br><span class="line">				);</span><br><span class="line">				list = (List&lt;LogModel&gt;)oin.readObject();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(oin!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					oin.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLogFile</span><span class="params">(List&lt;LogModel&gt; list)</span></span>&#123;</span><br><span class="line">		File f = <span class="keyword">new</span> File(logFilePathName);</span><br><span class="line">		ObjectOutputStream oout = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			oout = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">					<span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(f))</span><br><span class="line">			);</span><br><span class="line">			oout.writeObject(list);			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				oout.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Adapter角色，</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 适配器对象，把记录日志到文件的功能适配成第二版需要的增删改查的功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">LogDbOperateApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有需要被适配的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> LogFileOperateApi adaptee;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入需要被适配的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> adaptee 需要被适配的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(LogFileOperateApi adaptee)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.adaptee = adaptee;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = adaptee.readLogFile();</span><br><span class="line">		<span class="comment">//2：加入新的日志对象</span></span><br><span class="line">		list.add(lm);</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		adaptee.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">getAllLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> adaptee.readLogFile();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = adaptee.readLogFile();</span><br><span class="line">		<span class="comment">//2：删除相应的日志对象</span></span><br><span class="line">		list.remove(lm);</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		adaptee.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = adaptee.readLogFile();</span><br><span class="line">		<span class="comment">//2：修改相应的日志对象</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(list.get(i).getLogId().equals(lm.getLogId()))&#123;</span><br><span class="line">				list.set(i, lm);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		adaptee.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日志数据模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志数据对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogModel</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String operateUser;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作时间，以yyyy-MM-dd HH:mm:ss的格式记录</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String operateTime;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logContent;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLogId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> logId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogId</span><span class="params">(String logId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.logId = logId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOperateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> operateUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperateUser</span><span class="params">(String operateUser)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operateUser = operateUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOperateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> operateTime;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperateTime</span><span class="params">(String operateTime)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operateTime = operateTime;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLogContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> logContent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogContent</span><span class="params">(String logContent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.logContent = logContent;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"logId="</span>+logId+<span class="string">",operateUser="</span>+operateUser+<span class="string">",operateTime"</span>+operateTime+<span class="string">",logContent="</span>+logContent;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//记录日志（双向适配）</span></span><br><span class="line"><span class="comment">//示例：文件记录日志接口和数据库记录日志接口双向适配</span></span><br><span class="line"><span class="comment">//Client</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//准备日志内容，也就是测试的数据</span></span><br><span class="line">		LogModel lm1 = <span class="keyword">new</span> LogModel();</span><br><span class="line">		lm1.setLogId(<span class="string">"001"</span>);</span><br><span class="line">		lm1.setOperateUser(<span class="string">"admin"</span>);</span><br><span class="line">		lm1.setOperateTime(<span class="string">"2010-03-02 10:08:18"</span>);</span><br><span class="line">		lm1.setLogContent(<span class="string">"这是一个测试"</span>);</span><br><span class="line">		</span><br><span class="line">		List&lt;LogModel&gt; list = <span class="keyword">new</span> ArrayList&lt;LogModel&gt;();</span><br><span class="line">		list.add(lm1);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建操作日志文件的对象</span></span><br><span class="line">		LogFileOperateApi fileLogApi = <span class="keyword">new</span> LogFileOperate(<span class="string">""</span>);</span><br><span class="line">		LogDbOperateApi dbLogApi = <span class="keyword">new</span> LogDbOperate();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建经过双向适配后的操作日志的接口对象</span></span><br><span class="line">		LogFileOperateApi fileLogApi2 = <span class="keyword">new</span> TwoDirectAdapter(fileLogApi,dbLogApi); </span><br><span class="line">		LogDbOperateApi dbLogApi2 = <span class="keyword">new</span> TwoDirectAdapter(fileLogApi,dbLogApi); </span><br><span class="line">		</span><br><span class="line">		<span class="comment">//先测试从文件操作适配到第二版，虽然调用的是第二版的接口，其实是文件操作在实现</span></span><br><span class="line">		dbLogApi2.createLog(lm1);</span><br><span class="line">		List&lt;LogModel&gt; allLog = dbLogApi2.getAllLog();</span><br><span class="line">		System.out.println(<span class="string">"allLog="</span>+allLog);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//再测试从数据库存储适配成第一版的接口，也就是调用第一版的接口，其实是数据实现</span></span><br><span class="line">		fileLogApi2.writeLogFile(list);</span><br><span class="line">		fileLogApi2.readLogFile();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//双向适配器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 双向适配器对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TwoDirectAdapter</span> <span class="keyword">implements</span> <span class="title">LogDbOperateApi</span>,<span class="title">LogFileOperateApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有需要被适配的文件存储日志的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> LogFileOperateApi fileLog;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有需要被适配的DB存储日志的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> LogDbOperateApi  dbLog;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入需要被适配的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> fileLog 需要被适配的文件存储日志的接口对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dbLog 需要被适配的DB存储日志的接口对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">TwoDirectAdapter</span><span class="params">(LogFileOperateApi fileLog,LogDbOperateApi dbLog)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fileLog = fileLog;</span><br><span class="line">		<span class="keyword">this</span>.dbLog = dbLog;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*-----以下是把文件操作的方式适配成为DB实现方式的接口-----*/</span>	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = fileLog.readLogFile();</span><br><span class="line">		<span class="comment">//2：加入新的日志对象</span></span><br><span class="line">		list.add(lm);</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		fileLog.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">getAllLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fileLog.readLogFile();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = fileLog.readLogFile();</span><br><span class="line">		<span class="comment">//2：删除相应的日志对象</span></span><br><span class="line">		list.remove(lm);</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		fileLog.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先读取文件的内容</span></span><br><span class="line">		List&lt;LogModel&gt; list = fileLog.readLogFile();</span><br><span class="line">		<span class="comment">//2：修改相应的日志对象</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;list.size();i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(list.get(i).getLogId().equals(lm.getLogId()))&#123;</span><br><span class="line">				list.set(i, lm);</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//3：重新写入文件</span></span><br><span class="line">		fileLog.writeLogFile(list);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*-----以下是把DB操作的方式适配成为文件实现方式的接口-----*/</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">readLogFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> dbLog.getAllLog();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLogFile</span><span class="params">(List&lt;LogModel&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：最简单的实现思路，先删除数据库中的数据</span></span><br><span class="line">		<span class="comment">//2：然后循环把现在的数据加入到数据库中</span></span><br><span class="line">		<span class="keyword">for</span>(LogModel lm : list)&#123;</span><br><span class="line">			dbLog.createLog(lm);</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据库记录日志接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义操作日志的应用接口，为了示例的简单，</span></span><br><span class="line"><span class="comment"> * 只是简单的定义了增删改查的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogDbOperateApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 新增日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要新增的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 修改日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要修改的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 需要删除的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLog</span><span class="params">(LogModel lm)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取所有的日志</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 所有的日志对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">getAllLog</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//数据库记录日志实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * DB存储日志的实现，为了简单，这里就不去真的实现和数据库交互了，示意一下</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogDbOperate</span> <span class="keyword">implements</span> <span class="title">LogDbOperateApi</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in LogDbOperate createLog,lm="</span>+lm);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">getAllLog</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in LogDbOperate getAllLog"</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in LogDbOperate removeLog,lm="</span>+lm);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateLog</span><span class="params">(LogModel lm)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"now in LogDbOperate updateLog,lm="</span>+lm);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//文件记录日志接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志文件操作接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LogFileOperateApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读取日志文件，从文件里面获取存储的日志列表对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 存储的日志列表对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;LogModel&gt; <span class="title">readLogFile</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 写日志文件，把日志列表写出到日志文件中去</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> list 要写到日志文件的日志列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLogFile</span><span class="params">(List&lt;LogModel&gt; list)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//文件记录日志实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现对日志文件的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFileOperate</span> <span class="keyword">implements</span> <span class="title">LogFileOperateApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志文件的路径和文件名称，默认是当前classpath下的AdapterLog.log</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logFilePathName = <span class="string">"AdapterLog.log"</span>;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入文件的路径和名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> logFilePathName 文件的路径和名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">LogFileOperate</span><span class="params">(String logFilePathName)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先判断是否传入了文件的路径和名称，如果是，</span></span><br><span class="line">		<span class="comment">//就重新设置操作的日志文件的路径和名称</span></span><br><span class="line">		<span class="keyword">if</span>(logFilePathName!=<span class="keyword">null</span> &amp;&amp; logFilePathName.trim().length()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">this</span>.logFilePathName = logFilePathName;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span>  List&lt;LogModel&gt; <span class="title">readLogFile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		List&lt;LogModel&gt; list = <span class="keyword">null</span>;</span><br><span class="line">		ObjectInputStream oin = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			File f = <span class="keyword">new</span> File(logFilePathName);</span><br><span class="line">			<span class="keyword">if</span>(f.exists())&#123;</span><br><span class="line">				oin = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">						<span class="keyword">new</span> BufferedInputStream(<span class="keyword">new</span> FileInputStream(f))</span><br><span class="line">				);</span><br><span class="line">				list = (List&lt;LogModel&gt;)oin.readObject();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="keyword">if</span>(oin!=<span class="keyword">null</span>)&#123;</span><br><span class="line">					oin.close();</span><br><span class="line">				&#125;</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">writeLogFile</span><span class="params">(List&lt;LogModel&gt; list)</span></span>&#123;</span><br><span class="line">		File f = <span class="keyword">new</span> File(logFilePathName);</span><br><span class="line">		ObjectOutputStream oout = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			oout = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">					<span class="keyword">new</span> BufferedOutputStream(<span class="keyword">new</span> FileOutputStream(f))</span><br><span class="line">			);</span><br><span class="line">			oout.writeObject(list);			</span><br><span class="line">		&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				oout.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//日志数据模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 日志数据对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogModel</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String operateUser;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作时间，以yyyy-MM-dd HH:mm:ss的格式记录</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String operateTime;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 日志内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String logContent;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLogId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> logId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogId</span><span class="params">(String logId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.logId = logId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOperateUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> operateUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperateUser</span><span class="params">(String operateUser)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operateUser = operateUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOperateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> operateTime;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperateTime</span><span class="params">(String operateTime)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operateTime = operateTime;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLogContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> logContent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogContent</span><span class="params">(String logContent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.logContent = logContent;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"logId="</span>+logId+<span class="string">",operateUser="</span>+operateUser+<span class="string">",operateTime"</span>+operateTime+<span class="string">",logContent="</span>+logContent;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="代理模式">代理模式</h2>
<h3 id="描述">描述</h3>
<p>定义：为其它对象提供一种代理以控制对这个对象的访问。本质是控制对象访问。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Proxy</td>
<td>代理对象，具有如下功能</td>
</tr>
</tbody>
</table>
<ol>
<li>实现与具体目标对象一样的接口</li>
<li>保存一个指向具体目标对象的引用，可在需要时调用</li>
<li>可以控制对具体目标对象的访问，并可能负责创建和删除它<br>
|Subject	|目标接口，定义代理和具体目标对象的接口<br>
|RealSubject	|具体目标对象，真正实现目标接口要求的功能</li>
</ol>
<p>代理的分类</p>
<ol>
<li>虚代理：根据需要创建开销较大的对象，该对象只有在需要时才会被真正创建</li>
<li>远程代理：用于在不同的地址空间上代表同一个对象，如：RMI</li>
<li>保护代理：控制对原始对象的访问</li>
<li>缓存代理</li>
<li>同步代理：解决竞态对象的冲突问题</li>
</ol>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>隐藏代理细节</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需为一个对象在不同的地址空间提供局部代表时，使用远程代理</li>
<li>按需创建开销很大的对象时，使用虚代理</li>
<li>需控制对原始对象访问时，使用保护代理</li>
<li>需在访问对象时执行附加操作时，使用智能指引代理</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//JDK动态代理</span></span><br><span class="line"><span class="comment">//示例：JDK动态代理实现访问权限控制</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 动态代理示例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//张三先登录系统创建了一个订单</span></span><br><span class="line">		Order order = <span class="keyword">new</span> Order(<span class="string">"设计模式"</span>,<span class="number">100</span>,<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建一个动态代理</span></span><br><span class="line">		DynamicProxy dynamicProxy = <span class="keyword">new</span> DynamicProxy();		</span><br><span class="line">		<span class="comment">//然后把订单和动态代理关联起来</span></span><br><span class="line">		OrderApi orderApi = dynamicProxy.getProxyInterface(order);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//以下就需要使用被代理过的接口来操作了</span></span><br><span class="line">		<span class="comment">//李四想要来修改，那就会报错</span></span><br><span class="line">		orderApi.setOrderNum(<span class="number">123</span>, <span class="string">"李四"</span>);</span><br><span class="line">		<span class="comment">//输出order</span></span><br><span class="line">		System.out.println(<span class="string">"李四修改后订单记录没有变化："</span>+orderApi);</span><br><span class="line">		<span class="comment">//张三修改就不会有问题</span></span><br><span class="line">		orderApi.setOrderNum(<span class="number">123</span>, <span class="string">"张三"</span>);</span><br><span class="line">		<span class="comment">//再次输出order</span></span><br><span class="line">		System.out.println(<span class="string">"张三修改后，订单记录："</span>+orderApi);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//订单接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单对象的接口定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OrderApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProductName</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> productName 订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 操作人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductName</span><span class="params">(String productName,String user)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取订单订购的数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 订单订购的数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderNum</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置订单订购的数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> orderNum 订单订购的数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 操作人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderNum</span><span class="params">(<span class="keyword">int</span> orderNum,String user)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取创建订单的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 创建订单的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrderUser</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置创建订单的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> orderUser 创建订单的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 操作人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderUser</span><span class="params">(String orderUser,String user)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//订单类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 订单对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">implements</span> <span class="title">OrderApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String productName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 订单订购的数量</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> orderNum;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建订单的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String orderUser;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入构建需要的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> productName 订单订购的产品名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> orderNum 订单订购的数量</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> orderUser 创建订单的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Order</span><span class="params">(String productName,<span class="keyword">int</span> orderNum,String orderUser)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productName = productName;</span><br><span class="line">		<span class="keyword">this</span>.orderNum = orderNum;</span><br><span class="line">		<span class="keyword">this</span>.orderUser = orderUser;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getProductName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> productName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductName</span><span class="params">(String productName,String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.productName = productName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getOrderNum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orderNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderNum</span><span class="params">(<span class="keyword">int</span> orderNum,String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderNum = orderNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getOrderUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> orderUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderUser</span><span class="params">(String orderUser,String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.orderUser = orderUser;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"productName="</span>+<span class="keyword">this</span>.getProductName()+<span class="string">",orderNum="</span>+<span class="keyword">this</span>.getOrderNum()+<span class="string">",orderUser="</span>+<span class="keyword">this</span>.getOrderUser();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//动态代理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用Java中的动态代理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DynamicProxy</span> <span class="keyword">implements</span> <span class="title">InvocationHandler</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 被代理的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> OrderApi order = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取绑定好代理和具体目标对象后的目标对象的接口</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> order 具体的订单对象，相当于具体目标对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 绑定好代理和具体目标对象后的目标对象的接口</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> OrderApi <span class="title">getProxyInterface</span><span class="params">(OrderApi order)</span></span>&#123;</span><br><span class="line">		<span class="comment">//设置被代理的对象，好方便invoke里面的操作</span></span><br><span class="line">		<span class="keyword">this</span>.order = order;</span><br><span class="line">		<span class="comment">//把真正的订单对象和动态代理关联起来</span></span><br><span class="line">		OrderApi orderApi = (OrderApi) Proxy.newProxyInstance(</span><br><span class="line">				order.getClass().getClassLoader(),</span><br><span class="line">				order.getClass().getInterfaces(), </span><br><span class="line">				<span class="keyword">this</span>);</span><br><span class="line">		<span class="keyword">return</span> orderApi;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		<span class="comment">//如果是调用setter方法就需要检查权限</span></span><br><span class="line">		<span class="keyword">if</span>(method.getName().startsWith(<span class="string">"set"</span>))&#123;</span><br><span class="line">			<span class="comment">//如果不是创建人，那就不能修改</span></span><br><span class="line">			<span class="keyword">if</span>(order.getOrderUser()!=<span class="keyword">null</span> &amp;&amp; order.getOrderUser().equals(args[<span class="number">1</span>]))&#123;</span><br><span class="line">				<span class="comment">//可以操作</span></span><br><span class="line">				<span class="keyword">return</span> method.invoke(order, args);</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				System.out.println(<span class="string">"对不起，"</span>+args[<span class="number">1</span>]+<span class="string">"，您无权修改本订单中的数据"</span>);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//不是调用的setter方法就继续运行</span></span><br><span class="line">			<span class="keyword">return</span> method.invoke(order, args);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CGLIB动态代理</span></span><br><span class="line"><span class="comment">//示例：CGLIB动态代理实现AOP</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        OrderManager order = (OrderManager) <span class="keyword">new</span> CGLibProxy().createProxyObject(<span class="keyword">new</span> OrderManager(<span class="string">"aoho"</span>));</span><br><span class="line">        order.save(UUID.randomUUID(), <span class="string">"save"</span>);</span><br><span class="line">        order.update(UUID.randomUUID(), <span class="string">"update"</span>);</span><br><span class="line">        order.getByName(<span class="string">"save"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//被代理的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String user = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OrderManager</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setUser(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">(UUID orderId, String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"call save()方法,save:"</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(UUID orderId, String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"call update()方法"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"call getByName()方法"</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"aoho"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//代理类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CGLibProxy</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</span><br><span class="line">	<span class="comment">// CGLib需要代理的目标对象</span></span><br><span class="line">	<span class="keyword">private</span> Object targetObject;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">createProxyObject</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.targetObject = obj;</span><br><span class="line">		Enhancer enhancer = <span class="keyword">new</span> Enhancer();</span><br><span class="line">		enhancer.setSuperclass(obj.getClass());</span><br><span class="line">		<span class="comment">//回调方法的参数为代理类对象CglibProxy，最后增强目标类调用的是代理类对象CglibProxy中的intercept方法 </span></span><br><span class="line">		enhancer.setCallback(<span class="keyword">this</span>);</span><br><span class="line">		<span class="comment">// 返回代理对象</span></span><br><span class="line">		<span class="keyword">return</span> enhancer.create();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Object proxy, Method method, Object[] args,</span></span></span><br><span class="line"><span class="function"><span class="params">			MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">		Object obj = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//切面逻辑（advise），此处是在目标类代码执行之前</span></span><br><span class="line">		System.out.println(<span class="string">"---before intercept----"</span>);</span><br><span class="line">		obj = method.invoke(targetObject, args);</span><br><span class="line">		System.out.println(<span class="string">"---after intercept----"</span>);</span><br><span class="line">		<span class="keyword">return</span> obj;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="组合模式">组合模式</h2>
<h3 id="描述">描述</h3>
<p>定义：将对象组合成树形结构以表示“部分-整体”的层次结构，使用户对单个对象和组合对象的使用具有一致性。本质是统一组合对象和叶子对象。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Component</td>
<td>抽象的组件对象，为组合中的对象声明接口，使客户端通过其访问和管理整个对象结构。也可以在其中为定义的功能提供缺省的实现</td>
</tr>
<tr>
<td>Leaf</td>
<td>叶子节点对象，定义和实现叶子对象的行为</td>
</tr>
<tr>
<td>Composite</td>
<td>组合对象，可以存储子组件；定义包含子组件的行为，并实现在组件接口中定义的与子组件有关的操作</td>
</tr>
<tr>
<td>Client</td>
<td>客户端</td>
</tr>
</tbody>
</table>
<p>环状引用：在对象结构中，某个对象包含的子对象，或是子对象的子对象。。。如此经过N层后，出现所包含的子对象中有这个对象本身，从而构成环状引用。而避免环状引用的方式，则是记录引用的路径，添加子节点时检测。</p>
<p>智能方案：将子节点也看成一个组合对象，只不过其子节点属性为空。而根节点的父节点引用，也为空。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>统一了组合对象和叶子对象的访问</li>
<li>易于扩展</li>
</ol>
<p>缺点</p>
<ol>
<li>难以限制组合中的组件类型</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需表示对象的“部分-整体”层次结构</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//商品类别树</span></span><br><span class="line"><span class="comment">//示例：商品类别树的管理</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 添加对父对象的引用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//定义所有的组合对象</span></span><br><span class="line">		Component root = <span class="keyword">new</span> Composite(<span class="string">"服装"</span>);</span><br><span class="line">		Component c1 = <span class="keyword">new</span> Composite(<span class="string">"男装"</span>);</span><br><span class="line">		Component c2 = <span class="keyword">new</span> Composite(<span class="string">"女装"</span>);</span><br><span class="line">		<span class="comment">//定义所有的叶子对象</span></span><br><span class="line">		Component leaf1 = <span class="keyword">new</span> Leaf(<span class="string">"衬衣"</span>);</span><br><span class="line">		Component leaf2 = <span class="keyword">new</span> Leaf(<span class="string">"夹克"</span>);</span><br><span class="line">		Component leaf3 = <span class="keyword">new</span> Leaf(<span class="string">"裙子"</span>);</span><br><span class="line">		Component leaf4 = <span class="keyword">new</span> Leaf(<span class="string">"套装"</span>);</span><br><span class="line">		<span class="comment">//按照树的结构来组合组合对象和叶子对象</span></span><br><span class="line">		root.addChild(c1);</span><br><span class="line">		root.addChild(c2);		</span><br><span class="line">		c1.addChild(leaf1);</span><br><span class="line">		c1.addChild(leaf2);		</span><br><span class="line">		c2.addChild(leaf3);</span><br><span class="line">		c2.addChild(leaf4);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用根对象的输出功能来输出整棵树</span></span><br><span class="line">		root.printStruct(<span class="string">""</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"----------------------------&gt;"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//然后删除一个节点</span></span><br><span class="line">		root.removeChild(c1);</span><br><span class="line">		<span class="comment">//重新输出整棵树</span></span><br><span class="line">		root.printStruct(<span class="string">""</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//组件抽象类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象的组件对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录父组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Component parent = <span class="keyword">null</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取一个组件的父组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 一个组件的父组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getParent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> parent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置一个组件的父组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> parent 一个组件的父组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParent</span><span class="params">(Component parent)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.parent = parent;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回某个组件的子组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 某个组件的子组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Component&gt; <span class="title">getChildren</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*-------------------以下是原有的定义----------------------*/</span>	</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出组件自身的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">printStruct</span><span class="params">(String preStr)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 向组合对象中加入组件对象 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> child 被加入组合对象中的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 缺省的实现，抛出例外，因为叶子对象没有这个功能，或者子组件没有实现这个功能</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从组合对象中移出某个组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> child 被移出的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 缺省的实现，抛出例外，因为叶子对象没有这个功能，或者子组件没有实现这个功能</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回某个索引对应的组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index 需要获取的组件对象的索引，索引从0开始</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 索引对应的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getChildren</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//组合对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 组合对象，可以包含其它组合对象或者叶子对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//延迟初始化</span></span><br><span class="line">		<span class="keyword">if</span> (childComponents == <span class="keyword">null</span>) &#123;</span><br><span class="line">			childComponents = <span class="keyword">new</span> ArrayList&lt;Component&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		childComponents.add(child);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//添加对父组件的引用</span></span><br><span class="line">		child.setParent(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (childComponents != <span class="keyword">null</span>) &#123;</span><br><span class="line">			<span class="comment">//查找到要删除的组件在集合中的索引位置</span></span><br><span class="line">			<span class="keyword">int</span> idx = childComponents.indexOf(child);</span><br><span class="line">			<span class="keyword">if</span> (idx != -<span class="number">1</span>) &#123;</span><br><span class="line">				<span class="comment">//先把被删除的商品类别对象的父商品类别，设置成为被删除的商品类别的子类别的父商品类别</span></span><br><span class="line">				<span class="keyword">for</span>(Component c : child.getChildren())&#123;</span><br><span class="line">					<span class="comment">//删除的组件对象是本实例的一个子组件对象</span></span><br><span class="line">					c.setParent(<span class="keyword">this</span>);</span><br><span class="line">					<span class="comment">//把被删除的商品类别对象的子组件对象添加到当前实例中</span></span><br><span class="line">					childComponents.add(c);</span><br><span class="line">				&#125;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">//真的删除</span></span><br><span class="line">				childComponents.remove(idx);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Component&gt; <span class="title">getChildren</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> childComponents;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*-------------------以下是原有的实现，没有变化----------------------*/</span>		</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来存储组合对象中包含的子组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Component&gt; childComponents = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 组合对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入组合对象的名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 组合对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Composite</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出组合对象自身的结构</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> preStr 前缀，主要是按照层级拼接的空格，实现向后缩进</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printStruct</span><span class="params">(String preStr)</span></span>&#123;</span><br><span class="line">		<span class="comment">//先把自己输出去</span></span><br><span class="line">		System.out.println(preStr+<span class="string">"+"</span>+<span class="keyword">this</span>.name);</span><br><span class="line">		<span class="comment">//如果还包含有子组件，那么就输出这些子组件对象</span></span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.childComponents!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//然后添加一个空格，表示向后缩进一个空格</span></span><br><span class="line">			preStr+=<span class="string">" "</span>;		</span><br><span class="line">			<span class="comment">//输出当前对象的子对象了</span></span><br><span class="line">			<span class="keyword">for</span>(Component c : childComponents)&#123;</span><br><span class="line">				<span class="comment">//递归输出每个子对象</span></span><br><span class="line">				c.printStruct(preStr);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//叶子对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 叶子对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 叶子对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入叶子对象的名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 叶子对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 输出叶子对象的结构，叶子对象没有子对象，也就是输出叶子对象的名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> preStr 前缀，主要是按照层级拼接的空格，实现向后缩进</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printStruct</span><span class="params">(String preStr)</span></span>&#123;</span><br><span class="line">		System.out.println(preStr+<span class="string">"-"</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="装饰模式">装饰模式</h2>
<h3 id="描述">描述</h3>
<p>定义：动态地给对象添加额外的职责。本质是增强功能，动态组合。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Component</td>
<td>组件对象接口</td>
</tr>
<tr>
<td>ConcreteComponent</td>
<td>组件对象的实现，是被装饰器装饰的原始对象</td>
</tr>
<tr>
<td>Decorator</td>
<td>装饰器的抽象父类，需定义一个与组件接口一致的接口，并持有一个被装饰的对象</td>
</tr>
<tr>
<td>ConcreteDecorator</td>
<td>装饰器对象的实现</td>
</tr>
</tbody>
</table>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>比继承更灵活</li>
<li>更容易复用功能</li>
<li>简化高层定义</li>
</ol>
<p>缺点</p>
<ol>
<li>可能会产生很多细粒度的对象</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需动态、透明地给对象添加职责</li>
<li>不适合使用子类扩展时</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：奖金计算</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用装饰模式的客户端</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先创建计算基本奖金的类，这也是被装饰的对象</span></span><br><span class="line">		Component c1 = <span class="keyword">new</span> ConcreteComponent();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//然后对计算的基本奖金进行装饰，这里要组合各个装饰</span></span><br><span class="line">		<span class="comment">//说明，各个装饰者之间最好是不要有先后顺序的限制，也就是先装饰谁和后装饰谁都应该是一样的</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//先组合普通业务人员的奖金计算</span></span><br><span class="line">		Decorator d1 = <span class="keyword">new</span> MonthPrizeDecorator(c1);</span><br><span class="line">		Decorator d2 = <span class="keyword">new</span> SumPrizeDecorator(d1);	</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//注意：这里只需要使用最后组合好的对象调用业务方法即可，会依次调用回去</span></span><br><span class="line">		<span class="comment">//日期对象都没有用上，所以传null就可以了</span></span><br><span class="line">		<span class="keyword">double</span> zs = d2.calcPrize(<span class="string">"张三"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);		</span><br><span class="line">		System.out.println(<span class="string">"==========张三应得奖金："</span>+zs);</span><br><span class="line">		<span class="keyword">double</span> ls = d2.calcPrize(<span class="string">"李四"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">		System.out.println(<span class="string">"==========李四应得奖金："</span>+ls);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//如果是业务经理，还需要一个计算团队的奖金计算</span></span><br><span class="line">		Decorator d3 = <span class="keyword">new</span> GroupPrizeDecorator(d2);</span><br><span class="line">		<span class="keyword">double</span> ww = d3.calcPrize(<span class="string">"王五"</span>,<span class="keyword">null</span>,<span class="keyword">null</span>);</span><br><span class="line">		System.out.println(<span class="string">"==========王经理应得奖金："</span>+ww);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算奖金的组件接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 计算某人在某段时间内的奖金，有些参数在演示中并不会使用，</span></span><br><span class="line"><span class="comment">	 * 但是在实际业务实现上是会用的，为了表示这是个具体的业务方法，</span></span><br><span class="line"><span class="comment">	 * 因此这些参数被保留了</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 被计算奖金的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> begin 计算奖金的开始时间</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end 计算奖金的结束时间</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 某人在某段时间内的奖金</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user,Date begin,Date end)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算实现</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 基本的实现计算奖金的类，也是被装饰器装饰的对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteComponent</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user, Date begin, Date end)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//只是一个默认的实现，默认没有奖金</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//装饰器接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器的接口，需要跟被装饰的对象实现同样的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Decorator</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有被装饰的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> Component c;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过构造方法传入被装饰的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> c被装饰的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Decorator</span><span class="params">(Component c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.c = c;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user, Date begin, Date end)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//转调组件对象的方法</span></span><br><span class="line">		<span class="keyword">return</span> c.calcPrize(user, begin, end);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算当月业务奖金</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器对象，计算当月业务奖金</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MonthPrizeDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">MonthPrizeDecorator</span><span class="params">(Component c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(c);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user, Date begin, Date end)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先获取前面运算出来的奖金</span></span><br><span class="line">		<span class="keyword">double</span> money = <span class="keyword">super</span>.calcPrize(user, begin, end);</span><br><span class="line">		<span class="comment">//2：然后计算当月业务奖金,按照人员和时间去获取当月的业务额，然后再乘以3%</span></span><br><span class="line">		<span class="keyword">double</span> prize = TempDB.mapMonthSaleMoney.get(user) * <span class="number">0.03</span>;</span><br><span class="line">		System.out.println(user+<span class="string">"当月业务奖金"</span>+prize);</span><br><span class="line">		<span class="keyword">return</span> money + prize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算累计奖金</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器对象，计算累计奖金</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SumPrizeDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SumPrizeDecorator</span><span class="params">(Component c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(c);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user, Date begin, Date end)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先获取前面运算出来的奖金</span></span><br><span class="line">		<span class="keyword">double</span> money = <span class="keyword">super</span>.calcPrize(user, begin, end);</span><br><span class="line">		<span class="comment">//2：然后计算累计奖金,其实这里应该按照人员去获取累计的业务额，然后再乘以0.1%</span></span><br><span class="line">		<span class="comment">//简单演示一下，假定大家的累计业务额都是1000000元</span></span><br><span class="line">		<span class="keyword">double</span> prize = <span class="number">1000000</span> * <span class="number">0.001</span>;</span><br><span class="line">		System.out.println(user+<span class="string">"累计奖金"</span>+prize);</span><br><span class="line">		<span class="keyword">return</span> money + prize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算当月团队业务奖金</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 装饰器对象，计算当月团队业务奖金</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GroupPrizeDecorator</span> <span class="keyword">extends</span> <span class="title">Decorator</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">GroupPrizeDecorator</span><span class="params">(Component c)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(c);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrize</span><span class="params">(String user, Date begin, Date end)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：先获取前面运算出来的奖金</span></span><br><span class="line">		<span class="keyword">double</span> money = <span class="keyword">super</span>.calcPrize(user, begin, end);</span><br><span class="line">		<span class="comment">//2：然后计算当月团队业务奖金，先计算出团队总的业务额，然后再乘以1%</span></span><br><span class="line">		<span class="comment">//假设都是一个团队的</span></span><br><span class="line">		<span class="keyword">double</span> group = <span class="number">0.0</span>;</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">double</span> d : TempDB.mapMonthSaleMoney.values())&#123;</span><br><span class="line">			group += d;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">double</span> prize = group * <span class="number">0.01</span>;</span><br><span class="line">		System.out.println(user+<span class="string">"当月团队业务奖金"</span>+prize);</span><br><span class="line">		<span class="keyword">return</span> money + prize;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//模拟数据库</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在内存中模拟数据库，准备点测试数据，好计算奖金</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TempDB</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">TempDB</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录每个人的月度销售额，只用了人员，月份没有用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String,Double&gt; mapMonthSaleMoney = <span class="keyword">new</span> HashMap&lt;String,Double&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span>&#123;</span><br><span class="line">		<span class="comment">//填充测试数据</span></span><br><span class="line">		mapMonthSaleMoney.put(<span class="string">"张三"</span>,<span class="number">10000.0</span>);</span><br><span class="line">		mapMonthSaleMoney.put(<span class="string">"李四"</span>,<span class="number">20000.0</span>);</span><br><span class="line">		mapMonthSaleMoney.put(<span class="string">"王五"</span>,<span class="number">30000.0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="桥接模式">桥接模式</h2>
<h3 id="描述">描述</h3>
<p>定义：将抽象部分与它的实现部分分离，使得它们都可以独立地变化。本质是分离抽象和实现。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Abstraction</td>
<td>抽象部分接口，需维护一个实现部分的对象引用，在抽象对象的方法需调用实现部分的对象完成功能</td>
</tr>
<tr>
<td>RefinedAbstraction</td>
<td>扩展抽象部分接口，定义与实际业务相关的方法</td>
</tr>
<tr>
<td>Implementor</td>
<td>实现部分接口</td>
</tr>
<tr>
<td>ConcreteImplementor</td>
<td>真正实现Implementor接口的对象</td>
</tr>
</tbody>
</table>
<p>桥接和继承：桥接变化维度为两维，继承变化维度为一维。</p>
<p>桥接</p>
<ol>
<li>客户端负责创建Implementor对象，并在创建抽象部分对象时将它设置到抽象部分对象</li>
<li>在抽象部分对象构建时，由其自身创建相应的Implementor对象</li>
<li>在Abstraction中选择并创建一个缺省的Implementor对象，而子类可以根据所需覆盖这个实现</li>
<li>使用抽象工厂或简单工厂选择并创建Implementor对象，抽象部分通过调用工厂的方法获取Implementor对象</li>
<li>通过IoC/DI容器创建Implementor对象并注入到Abstraction</li>
</ol>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>分离抽象和实现部分</li>
<li>更好的扩展性</li>
<li>可动态切换实现</li>
<li>可减少继承的子类</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>抽象和实现部分需要解绑时</li>
<li>抽象和实现部分都需单独扩展</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：实现发送加急消息</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用桥接模式实现用各种方式发送各种消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建具体的实现对象</span></span><br><span class="line">		MessageImplementor impl = <span class="keyword">new</span> MessageSMS();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//创建一个普通消息对象</span></span><br><span class="line">		AbstractMessage m = <span class="keyword">new</span> CommonMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建一个紧急消息对象</span></span><br><span class="line">		m = <span class="keyword">new</span> UrgencyMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建一个特急消息对象</span></span><br><span class="line">		m = <span class="keyword">new</span> SpecialUrgencyMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//把实现方式切换成手机短消息，然后再实现一遍</span></span><br><span class="line">		impl = <span class="keyword">new</span> MessageMobile();</span><br><span class="line">		</span><br><span class="line">		m = <span class="keyword">new</span> CommonMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">		</span><br><span class="line">		m = <span class="keyword">new</span> UrgencyMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">		</span><br><span class="line">		m = <span class="keyword">new</span> SpecialUrgencyMessage(impl);</span><br><span class="line">		m.sendMessage(<span class="string">"请喝一杯茶"</span>, <span class="string">"小李"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送消息实现部分接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现发送消息的统一接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MessageImplementor</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送消息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> message 要发送的消息内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> toUser 把消息发送的目的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String message,String toUser)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送站内短消息</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以站内短消息的方式发送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">MessageSMS</span> <span class="keyword">implements</span> <span class="title">MessageImplementor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"使用站内短消息的方式，发送消息'"</span>+message+<span class="string">"'给"</span>+toUser);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送Email</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以Email的方式发送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageEmail</span> <span class="keyword">implements</span> <span class="title">MessageImplementor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"使用Email的方式，发送消息'"</span>+message+<span class="string">"'给"</span>+toUser);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送手机短信</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以手机短消息的方式发送消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">MessageMobile</span> <span class="keyword">implements</span> <span class="title">MessageImplementor</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">send</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"使用手机短消息的方式，发送消息'"</span>+message+<span class="string">"'给"</span>+toUser);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//发送消息抽象部分接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象的消息对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractMessage</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有一个实现部分的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> MessageImplementor impl;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入实现部分的对象 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> impl 实现部分的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AbstractMessage</span><span class="params">(MessageImplementor impl)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.impl = impl;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 发送消息，转调实现部分的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> message 要发送的消息内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> toUser 把消息发送的目的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message,String toUser)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.impl.send(message, toUser);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通消息</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonMessage</span> <span class="keyword">extends</span> <span class="title">AbstractMessage</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CommonMessage</span><span class="params">(MessageImplementor impl)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(impl);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//对于普通消息，什么都不干，直接调用父类的方法，把消息发送出去就可以了</span></span><br><span class="line">		<span class="keyword">super</span>.sendMessage(message, toUser);</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//加急消息</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 加急消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UrgencyMessage</span> <span class="keyword">extends</span> <span class="title">AbstractMessage</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">UrgencyMessage</span><span class="params">(MessageImplementor impl)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(impl);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		message = <span class="string">"加急："</span>+message;</span><br><span class="line">		<span class="keyword">super</span>.sendMessage(message, toUser);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 监控某消息的处理过程</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> messageId 被监控的消息的编号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 包含监控到的数据对象，这里示意一下，所以用了Object</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">watch</span><span class="params">(String messageId)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//获取相应的数据，组织成监控的数据对象，然后返回		</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//特急消息</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 特急消息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpecialUrgencyMessage</span> <span class="keyword">extends</span> <span class="title">AbstractMessage</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SpecialUrgencyMessage</span><span class="params">(MessageImplementor impl)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(impl);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hurry</span><span class="params">(String messageId)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//执行催促的业务，发出催促的信息</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String message, String toUser)</span> </span>&#123;</span><br><span class="line">		message = <span class="string">"特急："</span>+message;</span><br><span class="line">		<span class="keyword">super</span>.sendMessage(message, toUser);</span><br><span class="line">		<span class="comment">//还需要增加一条待催促的信息</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="行为型">行为型</h1>
<blockquote>
<p>行为型模式是描述算法和对象间职责的分配。</p>
</blockquote>
<h2 id="中介者模式">中介者模式</h2>
<h3 id="描述">描述</h3>
<p>定义：用一个中介对象封装一系列的对象交互，使得各对象不需显式地相互引用，从而使得其松散耦合，且可以独立的改变它们之间的交互。本质是封装交互。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mediator</td>
<td>中介者接口，定义各个同事之间交互需要的方法；可以是公共的通讯方法，也可以是小范围的交互方法</td>
</tr>
<tr>
<td>ConcreteMediator</td>
<td>中介者类，需维护各个同事对象，并负责具体的协调各同事对象的交互关系</td>
</tr>
<tr>
<td>Colleague</td>
<td>同事类，通常实现为抽象类，主要负责约束同事对象的类型，并实现具体同事类之间的公共功能</td>
</tr>
<tr>
<td>ConcreteColleague</td>
<td>具体的同事类，实现自身业务；在需要与其它同事通讯时，则与特有的中介者通信，中介者会负责与其它的同事交互</td>
</tr>
</tbody>
</table>
<p>对标准中介者模式的改进</p>
<ol>
<li>通常会去掉同事对象的父类，这样使得任意的需要相互交互的对象都可以成为同事</li>
<li>通常不定义Mediator接口，将具体的中介者对象实现成为单例</li>
<li>同事对象不再持有中介者，而是需要时直接获取其对象并调用；中介者也不再持有同事对象，而是在具体处理方法创建、或者获取、或者从参数传入需要的同事对象</li>
</ol>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>松散耦合</li>
<li>集中控制交互</li>
<li>多对多变成一对多</li>
</ol>
<p>缺点</p>
<ol>
<li>过度集中化</li>
<li></li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>简化一组对象之间的通信</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//电脑播放电影</span></span><br><span class="line"><span class="comment">//示例：使用电影播放电影</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用电脑看电影的例子</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：创建中介者——主板对象</span></span><br><span class="line">		MotherBoard mediator = <span class="keyword">new</span> MotherBoard();</span><br><span class="line">		<span class="comment">//2：创建同事类</span></span><br><span class="line">		CDDriver cd = <span class="keyword">new</span> CDDriver(mediator);</span><br><span class="line">		CPU cpu = <span class="keyword">new</span> CPU(mediator);</span><br><span class="line">		VideoCard vc = <span class="keyword">new</span> VideoCard(mediator);</span><br><span class="line">		SoundCard sc = <span class="keyword">new</span> SoundCard(mediator);</span><br><span class="line">		<span class="comment">//3：让中介者知道所有的同事</span></span><br><span class="line">		mediator.setCdDriver(cd);</span><br><span class="line">		mediator.setCpu(cpu);</span><br><span class="line">		mediator.setVideoCard(vc);</span><br><span class="line">		mediator.setSoundCard(sc);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4：开始看电影，把光盘放入光驱，光驱开始读盘</span></span><br><span class="line">		cd.readCD();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//中介者接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 中介者对象的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Mediator</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 同事对象在自身改变的时候来通知中介者的方法，</span></span><br><span class="line"><span class="comment">	 * 让中介者去负责相应的与其他同事对象的交互</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> colleague 同事对象自身，好让中介者对象通过对象实例</span></span><br><span class="line"><span class="comment">	 *                  去获取同事对象的状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changed</span><span class="params">(Colleague colleague)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//电脑主板类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主板类，实现中介者接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MotherBoard</span> <span class="keyword">implements</span> <span class="title">Mediator</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 需要知道要交互的同事类——光驱类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CDDriver cdDriver = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 需要知道要交互的同事类——CPU类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CPU cpu = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 需要知道要交互的同事类——显卡类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> VideoCard videoCard = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 需要知道要交互的同事类——声卡类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> SoundCard soundCard = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCdDriver</span><span class="params">(CDDriver cdDriver)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cdDriver = cdDriver;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCpu</span><span class="params">(CPU cpu)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cpu = cpu;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setVideoCard</span><span class="params">(VideoCard videoCard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.videoCard = videoCard;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSoundCard</span><span class="params">(SoundCard soundCard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.soundCard = soundCard;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changed</span><span class="params">(Colleague colleague)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(colleague == cdDriver)&#123;</span><br><span class="line">			<span class="comment">//表示光驱读取数据了</span></span><br><span class="line">			<span class="keyword">this</span>.opeCDDriverReadData((CDDriver)colleague);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(colleague == cpu)&#123;</span><br><span class="line">			<span class="comment">//表示CPU处理完了</span></span><br><span class="line">			<span class="keyword">this</span>.opeCPU((CPU)colleague);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理光驱读取数据过后与其他对象的交互</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cd 光驱同事对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">opeCDDriverReadData</span><span class="params">(CDDriver cd)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：先获取光驱读取的数据</span></span><br><span class="line">		String data = cd.getData();</span><br><span class="line">		<span class="comment">//2：把这些数据传递给CPU进行处理</span></span><br><span class="line">		<span class="keyword">this</span>.cpu.executeData(data);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理CPU处理完数据后与其他对象的交互</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cpu CPU同事类</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">opeCPU</span><span class="params">(CPU cpu)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：先获取CPU处理过后的数据</span></span><br><span class="line">		String videoData = cpu.getVideoData();</span><br><span class="line">		String soundData = cpu.getSoundData();</span><br><span class="line">		<span class="comment">//2：把这些数据传递给显卡和声卡展示出来</span></span><br><span class="line">		<span class="keyword">this</span>.videoCard.showData(videoData);</span><br><span class="line">		<span class="keyword">this</span>.soundCard.soundData(soundData);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//同事抽象类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 同事类的抽象父类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Colleague</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有中介者对象，每一个同事类都知道它的中介者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Mediator mediator;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入中介者对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mediator 中介者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Colleague</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mediator = mediator;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取当前同事类对应的中介者对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 对应的中介者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Mediator <span class="title">getMediator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mediator;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//光驱类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 光驱类，一个同事类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CDDriver</span> <span class="keyword">extends</span> <span class="title">Colleague</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CDDriver</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 光驱读取出来的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String data = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取光驱读取出来的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 光驱读取出来的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getData</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.data;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读取光盘</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">readCD</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//逗号前是视频显示的数据，逗号后是声音</span></span><br><span class="line">		<span class="keyword">this</span>.data = <span class="string">"设计模式,值得好好研究"</span>;</span><br><span class="line">		<span class="comment">//通知主板，自己的状态发生了改变</span></span><br><span class="line">		<span class="keyword">this</span>.getMediator().changed(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//CPU类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * CPU类，一个同事类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CPU</span> <span class="keyword">extends</span> <span class="title">Colleague</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CPU</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分解出来的视频数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String videoData = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 分解出来的声音数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String soundData = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取分解出来的视频数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 分解出来的视频数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getVideoData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> videoData;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取分解出来的声音数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 分解出来的声音数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getSoundData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> soundData;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理数据，把数据分成音频和视频的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data 被处理的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executeData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		<span class="comment">//把数据分解开，前面的是视频数据，后面的是音频数据</span></span><br><span class="line">		String [] ss = data.split(<span class="string">","</span>);</span><br><span class="line">		<span class="keyword">this</span>.videoData = ss[<span class="number">0</span>];</span><br><span class="line">		<span class="keyword">this</span>.soundData = ss[<span class="number">1</span>];</span><br><span class="line">		<span class="comment">//通知主板，CPU的工作完成</span></span><br><span class="line">		<span class="keyword">this</span>.getMediator().changed(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//显卡类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 显卡类，一个同事类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoCard</span> <span class="keyword">extends</span> <span class="title">Colleague</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">VideoCard</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 显示视频数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data 被显示的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"您正观看的是："</span>+data);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//声卡类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 声卡类，一个同事类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SoundCard</span> <span class="keyword">extends</span> <span class="title">Colleague</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SoundCard</span><span class="params">(Mediator mediator)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(mediator);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按照声频数据发出声音</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> data 发出声音的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">soundData</span><span class="params">(String data)</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"画外音："</span>+data);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="观察者模式">观察者模式</h2>
<h3 id="描述">描述</h3>
<p>定义：定义对象间的一种一对多的依赖关系，当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并被自动更新。本质是触发联动。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Subject</td>
<td>目标对象，具有如下功能</td>
</tr>
</tbody>
</table>
<ol>
<li>一个目标可以被多个观察者观察</li>
<li>目标提供对观察者注册和退订的维护</li>
<li>目标的状态发生变化时，负责通知所有注册的观察者<br>
|Observer	|观察者接口，提供目标通知时对应的更新方法，可以在其方法回调目标对象，获取目标对象的数据<br>
|ConcreteSubject	|实现目标的对象，维护目标状态并执行相应的通知<br>
|ConcreteObserver	|实现观察者的对象，接收目标的通知，并进行相应的后续处理</li>
</ol>
<p>推模型：目标对象主动向观察者推送目标的详细信息，不管观察者是否需要，相当于广播通信。</p>
<p>拉模型：目标对象在通知观察者时，只传递少量信息，若观察者需要更具体的信息，由其主动到目标对象中获取。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>观察者和目标之间的抽象耦合</li>
<li>动态联动</li>
<li>支持广播通信</li>
</ol>
<p>缺点</p>
<ol>
<li>可能会消耗多余的资源，如：广播通信并不是所有观察者都需要每次的广播信息</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>一个抽象模型有两个方面，其中一个方面的操作依赖于另一个方面的状态变化</li>
<li>需要触发联动效果，但不知有多少被触发的对象</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//订阅报纸</span></span><br><span class="line"><span class="comment">//示例：Java中的观察者模式实现订阅报纸</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 java 提供的 观察 支持</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建一个报纸，作为被观察者</span></span><br><span class="line">		NewsPaper subject = <span class="keyword">new</span> NewsPaper();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建阅读者，也就是观察者</span></span><br><span class="line">		Reader reader1 = <span class="keyword">new</span> Reader();</span><br><span class="line">		reader1.setName(<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">		Reader reader2 = <span class="keyword">new</span> Reader();</span><br><span class="line">		reader2.setName(<span class="string">"李四"</span>);</span><br><span class="line">		</span><br><span class="line">		Reader reader3 = <span class="keyword">new</span> Reader();</span><br><span class="line">		reader3.setName(<span class="string">"王五"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//注册阅读者</span></span><br><span class="line">		subject.addObserver(reader1);</span><br><span class="line">		subject.addObserver(reader2);</span><br><span class="line">		subject.addObserver(reader3);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//要出报纸啦</span></span><br><span class="line">		subject.setContent(<span class="string">"本期内容是观察者模式"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//报纸类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 报纸对象，具体的目标实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NewsPaper</span> <span class="keyword">extends</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">Observable</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 报纸的具体内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String content;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取报纸的具体内容</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 报纸的具体内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> content;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，设置报纸的具体内容，相当于要出版报纸了</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> content 报纸的具体内容</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setContent</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.content = content;</span><br><span class="line">		<span class="comment">//内容有了，说明又出报纸了，那就通知所有的读者</span></span><br><span class="line">		<span class="comment">//注意在用Java中的Observer模式的时候，这句话不可少</span></span><br><span class="line">		<span class="keyword">this</span>.setChanged();</span><br><span class="line">		<span class="comment">//然后主动通知，这里用的是推的方式</span></span><br><span class="line">		<span class="keyword">this</span>.notifyObservers(<span class="keyword">this</span>.content);</span><br><span class="line">		<span class="comment">//如果用拉的方式，这么调用</span></span><br><span class="line">		<span class="comment">//this.notifyObservers();</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//读者类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 真正的读者，为了简单就描述一下姓名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Reader</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">Observer</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 读者的姓名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(Observable o, Object obj)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//这是采用推的方式</span></span><br><span class="line">		System.out.println(name+<span class="string">"收到报纸了，阅读先。目标推过来的内容是==="</span>+obj);</span><br><span class="line">		<span class="comment">//这是获取拉的数据</span></span><br><span class="line">		System.out.println(name+<span class="string">"收到报纸了，阅读先。主动到目标对象去拉的内容是==="</span></span><br><span class="line">		+((NewsPaper)o).getContent());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//水质检测</span></span><br><span class="line"><span class="comment">//示例：水质检测通知不同岗位的人</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 检测水质案例</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建水质主题对象</span></span><br><span class="line">		WaterQuality subject = <span class="keyword">new</span> WaterQuality();</span><br><span class="line">		<span class="comment">//创建几个观察者</span></span><br><span class="line">		WatcherObserver watcher1 = <span class="keyword">new</span> Watcher();</span><br><span class="line">		watcher1.setJob(<span class="string">"监测人员"</span>);</span><br><span class="line">		WatcherObserver watcher2 = <span class="keyword">new</span> Watcher();</span><br><span class="line">		watcher2.setJob(<span class="string">"预警人员"</span>);</span><br><span class="line">		WatcherObserver watcher3 = <span class="keyword">new</span> Watcher();</span><br><span class="line">		watcher3.setJob(<span class="string">"监测部门领导"</span>);</span><br><span class="line">		<span class="comment">//注册观察者</span></span><br><span class="line">		subject.attach(watcher1);</span><br><span class="line">		subject.attach(watcher2);</span><br><span class="line">		subject.attach(watcher3);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//填写水质报告</span></span><br><span class="line">		System.out.println(<span class="string">"当水质为正常的时候------------------〉"</span>);</span><br><span class="line">		subject.setPolluteLevel(<span class="number">0</span>);</span><br><span class="line">		System.out.println(<span class="string">"当水质为轻度污染的时候---------------〉"</span>);</span><br><span class="line">		subject.setPolluteLevel(<span class="number">1</span>);</span><br><span class="line">		System.out.println(<span class="string">"当水质为中度污染的时候---------------〉"</span>);</span><br><span class="line">		subject.setPolluteLevel(<span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//目标抽象类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义水质监测的目标对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">WaterQualitySubject</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来保存注册的观察者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> List&lt;WatcherObserver&gt; observers = <span class="keyword">new</span> ArrayList&lt;WatcherObserver&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 注册观察者对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> observer 观察者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">attach</span><span class="params">(WatcherObserver observer)</span> </span>&#123;</span><br><span class="line">		observers.add(observer);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 删除观察者对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> observer 观察者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">detach</span><span class="params">(WatcherObserver observer)</span> </span>&#123;</span><br><span class="line">		observers.remove(observer);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通知相应的观察者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">notifyWatchers</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取水质污染的级别</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 水质污染的级别</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getPolluteLevel</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//目标类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的水质监测对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WaterQuality</span> <span class="keyword">extends</span> <span class="title">WaterQualitySubject</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 污染的级别，0表示正常，1表示轻度污染，2表示中度污染，3表示高度污染</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> polluteLevel = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取水质污染的级别</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 水质污染的级别</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPolluteLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> polluteLevel;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 当监测水质情况后，设置水质污染的级别</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> polluteLevel 水质污染的级别</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPolluteLevel</span><span class="params">(<span class="keyword">int</span> polluteLevel)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.polluteLevel = polluteLevel;</span><br><span class="line">		<span class="comment">//通知相应的观察者</span></span><br><span class="line">		<span class="keyword">this</span>.notifyWatchers();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通知相应的观察者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">notifyWatchers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//循环所有注册的观察者</span></span><br><span class="line">		<span class="keyword">for</span>(WatcherObserver watcher : observers)&#123;</span><br><span class="line">			<span class="comment">//开始根据污染级别判断是否需要通知，由这里总控</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.polluteLevel &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">				<span class="comment">//通知监测员做记录</span></span><br><span class="line">				<span class="keyword">if</span>(<span class="string">"监测人员"</span>.equals(watcher.getJob()))&#123;</span><br><span class="line">					watcher.update(<span class="keyword">this</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.polluteLevel &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">				<span class="comment">//通知预警人员</span></span><br><span class="line">				<span class="keyword">if</span>(<span class="string">"预警人员"</span>.equals(watcher.getJob()))&#123;</span><br><span class="line">					watcher.update(<span class="keyword">this</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.polluteLevel &gt;= <span class="number">2</span>)&#123;</span><br><span class="line">				<span class="comment">//通知监测部门领导</span></span><br><span class="line">				<span class="keyword">if</span>(<span class="string">"监测部门领导"</span>.equals(watcher.getJob()))&#123;</span><br><span class="line">					watcher.update(<span class="keyword">this</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//观察者接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 水质观察者接口定义</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">WatcherObserver</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 被通知的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> subject 传入被观察的目标对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(WaterQualitySubject subject)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置观察人员的职务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> job 观察人员的职务</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJob</span><span class="params">(String job)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取观察人员的职务</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 观察人员的职务</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getJob</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//观察者类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的观察者实现</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> <span class="keyword">implements</span> <span class="title">WatcherObserver</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 职务</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String job;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(WaterQualitySubject subject)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//这里采用的是拉的方式</span></span><br><span class="line">		System.out.println(job+<span class="string">"获取到通知，当前污染级别为："</span>+subject.getPolluteLevel());</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getJob</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.job;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJob</span><span class="params">(String job)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.job = job;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="命令模式">命令模式</h2>
<h3 id="描述">描述</h3>
<p>定义：将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤销的操作。本质是封装请求。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Command</td>
<td>命令接口，声明执行的方法</td>
</tr>
<tr>
<td>ConcreteCommand</td>
<td>命令实现类，调用持有的接收者完成命令要执行的操作</td>
</tr>
<tr>
<td>Receiver</td>
<td>接收者，真正执行命令的对象</td>
</tr>
<tr>
<td>Invoker</td>
<td>要求命令对象执行请求，可以持有一个或多个命令对象</td>
</tr>
<tr>
<td>Client</td>
<td>组装命令对象和接收者</td>
</tr>
</tbody>
</table>
<p>参数化配置：可以用不同的命令对象，参数化配置客户的请求。</p>
<p>可撤销操作的实现方式</p>
<ol>
<li>补偿式</li>
<li>存储恢复式</li>
</ol>
<p>宏命令：包含多个命令的命令，是一个命令的组合。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>更松散的耦合</li>
<li>可实现动态控制</li>
<li>便于复合命令</li>
<li>优秀的扩展性</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需抽象出执行的动作并参数化其对象时</li>
<li>需在不同时刻指定、排列和执行请求时</li>
<li>需支持撤销、恢复和重做操作时</li>
<li>需支持系统崩溃时，能将对系统的操作重新执行一遍时</li>
<li>需事务的系统，命令模式提供了对事务进行建模的方法</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//电脑开机</span></span><br><span class="line"><span class="comment">//示例：命令模式实现电脑开机</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用命令模式实现开机过程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：把命令和真正的实现组合起来，相当于在组装机器，</span></span><br><span class="line">		<span class="comment">//把机箱上按钮的连接线插接到主板上。</span></span><br><span class="line">		MainBoardApi mainBoard = <span class="keyword">new</span> GigaMainBoard();</span><br><span class="line">		OpenCommand openCommand = <span class="keyword">new</span> OpenCommand(mainBoard);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2：为机箱上的按钮设置对应的命令，让按钮知道该干什么</span></span><br><span class="line">		Box box = <span class="keyword">new</span> Box();</span><br><span class="line">		box.setOpenCommand(openCommand);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3：然后模拟按下机箱上的按钮</span></span><br><span class="line">		box.openButtonPressed();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//电脑主板接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 主板的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MainBoardApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 主板具有能开机的功能</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//技嘉主板类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 技嘉主板类，开机命令的真正实现者，在Command模式中充当Receiver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GigaMainBoard</span> <span class="keyword">implements</span> <span class="title">MainBoardApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 真正的开机命令的实现</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"技嘉主板现在正在开机，请等候"</span>);</span><br><span class="line">		System.out.println(<span class="string">"接通电源......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"设备检查......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"装载系统......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"机器正常运转起来......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"机器已经正常打开，请操作"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//微星主板类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 微星主板类，开机命令的真正实现者，在Command模式中充当Receiver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MsiMainBoard</span> <span class="keyword">implements</span> <span class="title">MainBoardApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 真正的开机命令的实现</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">()</span></span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"微星主板现在正在开机，请等候"</span>);</span><br><span class="line">		System.out.println(<span class="string">"接通电源......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"设备检查......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"装载系统......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"机器正常运转起来......"</span>);</span><br><span class="line">		System.out.println(<span class="string">"机器已经正常打开，请操作"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令接口，声明执行的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//开机命令类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 开机命令的实现，实现Command接口，</span></span><br><span class="line"><span class="comment"> * 持有开机命令的真正实现，通过调用接收者的方法来实现命令</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有真正实现命令的接收者——主板对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> MainBoardApi mainBoard = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入主板对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mainBoard 主板对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">OpenCommand</span><span class="params">(MainBoardApi mainBoard)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.mainBoard = mainBoard;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//对于命令对象，根本不知道如何开机，会转调主板对象</span></span><br><span class="line">		<span class="comment">//让主板去完成开机的功能</span></span><br><span class="line">		<span class="keyword">this</span>.mainBoard.open();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//机箱类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 机箱对象，本身有按钮，持有按钮对应的命令对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Box</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 开机命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Command openCommand;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置开机命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> command 开机命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOpenCommand</span><span class="params">(Command command)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.openCommand = command;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 提供给客户使用，接受并相应用户请求，相当于按钮被按下触发的方法</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">openButtonPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//按下按钮，执行命令</span></span><br><span class="line">		openCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//计算器</span></span><br><span class="line"><span class="comment">//示例：命令模式实现计算器加减法运算并提供撤销和恢复操作</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令模式实现计算器功能，支持撤销命令功能（反操作）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：组装命令和接收者</span></span><br><span class="line">		<span class="comment">//创建接收者</span></span><br><span class="line">		OperationApi operation = <span class="keyword">new</span> Operation();</span><br><span class="line">		<span class="comment">//创建命令对象，并组装命令和接收者</span></span><br><span class="line">		AddCommand addCmd = <span class="keyword">new</span> AddCommand(operation);</span><br><span class="line">		SubstractCommand substractCmd = <span class="keyword">new</span> SubstractCommand(operation);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2：把命令设置到持有者，就是计算器里面</span></span><br><span class="line">		Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">		calculator.setAddCmd(addCmd);</span><br><span class="line">		calculator.setSubstractCmd(substractCmd);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3:模拟按下按钮，测试一下</span></span><br><span class="line">		calculator.addPressed(<span class="number">5</span>);</span><br><span class="line">		System.out.println(<span class="string">"一次加法运算后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.substractPressed(<span class="number">3</span>);</span><br><span class="line">		System.out.println(<span class="string">"一次减法运算后的结果为："</span>+operation.getResult());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试撤消</span></span><br><span class="line">		calculator.undoPressed();</span><br><span class="line">		System.out.println(<span class="string">"撤销一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.undoPressed();</span><br><span class="line">		System.out.println(<span class="string">"再撤销一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试恢复</span></span><br><span class="line">		calculator.redoPressed();</span><br><span class="line">		System.out.println(<span class="string">"恢复操作一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.redoPressed();</span><br><span class="line">		System.out.println(<span class="string">"再恢复操作一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">/*</span></span><br><span class="line"><span class="comment">		一次加法运算后的结果为：5</span></span><br><span class="line"><span class="comment">		一次减法运算后的结果为：2</span></span><br><span class="line"><span class="comment">		撤销一次后的结果为：5</span></span><br><span class="line"><span class="comment">		再撤销一次后的结果为：0</span></span><br><span class="line"><span class="comment">		恢复操作一次后的结果为：5</span></span><br><span class="line"><span class="comment">		再恢复操作一次后的结果为：2</span></span><br><span class="line"><span class="comment">		*/</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//操作接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作运算的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OperationApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取计算完成后的结果</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 计算完成后的结果</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置计算开始的初始值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> result 计算开始的初始值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(<span class="keyword">int</span> result)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行加法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> num 需要加的数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行减法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> num 需要减的数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//操作类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 运算类，真正实现加减法运算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Operation</span> <span class="keyword">implements</span> <span class="title">OperationApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录运算的结果</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setResult</span><span class="params">(<span class="keyword">int</span> result)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.result = result;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">		<span class="comment">//实现加法功能</span></span><br><span class="line">		result += num;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">		<span class="comment">//实现减法功能</span></span><br><span class="line">		result -= num;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令接口，声明执行的操作，支持可撤销操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">int</span> opeNum)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行撤销命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行恢复命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redo</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//加法命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的加法命令实现对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> OperationApi operation = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作的数据，也就是要加上的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> opeNum;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> operation 具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> opeNum 要加上的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AddCommand</span><span class="params">(OperationApi operation)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation = operation;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">int</span> opeNum)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.opeNum = opeNum;</span><br><span class="line">		<span class="comment">//转调接收者去真正执行功能，这个命令是做加法</span></span><br><span class="line">		<span class="keyword">this</span>.operation.add(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//转调接收者去真正执行功能</span></span><br><span class="line">		<span class="comment">//命令本身是做加法，那么撤销的时候就是做减法了</span></span><br><span class="line">		<span class="keyword">this</span>.operation.substract(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		execute(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//减法命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的减法命令实现对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubstractCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> OperationApi operation = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 操作的数据，也就是要减去的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> opeNum;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> operation 具体执行计算的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> opeNum 要减去的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SubstractCommand</span><span class="params">(OperationApi operation)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation = operation;</span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(<span class="keyword">int</span> opeNum)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.opeNum = opeNum;</span><br><span class="line">		<span class="comment">//转调接收者去真正执行功能，这个命令是做减法</span></span><br><span class="line">		<span class="keyword">this</span>.operation.substract(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//转调接收者去真正执行功能</span></span><br><span class="line">		<span class="comment">//命令本身是做减法，那么撤销的时候就是做加法了</span></span><br><span class="line">		<span class="keyword">this</span>.operation.add(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		execute(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算器类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算器类，计算器上有加法按钮、减法按钮，还有撤销和恢复的按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令的操作的历史记录，在撤销时候用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Command&gt; undoCmds = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令被撤销的历史记录，在恢复时候用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Command&gt; redoCmds = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Command addCmd = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Command substractCmd = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddCmd</span><span class="params">(Command addCmd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addCmd = addCmd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubstractCmd</span><span class="params">(Command substractCmd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.substractCmd = substractCmd;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPressed</span><span class="params">(<span class="keyword">int</span> opeNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addCmd.execute(opeNum);</span><br><span class="line">		<span class="comment">//把操作记录到历史记录里面</span></span><br><span class="line">		undoCmds.add(<span class="keyword">this</span>.addCmd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substractPressed</span><span class="params">(<span class="keyword">int</span> opeNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.substractCmd.execute(opeNum);</span><br><span class="line">		<span class="comment">//把操作记录到历史记录里面</span></span><br><span class="line">		undoCmds.add(<span class="keyword">this</span>.substractCmd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undoPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.undoCmds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//取出最后一个命令来撤销</span></span><br><span class="line">			Command cmd = <span class="keyword">this</span>.undoCmds.get(<span class="keyword">this</span>.undoCmds.size()-<span class="number">1</span>);</span><br><span class="line">			cmd.undo();</span><br><span class="line">			<span class="comment">//如果还有恢复的功能，那就把这个命令记录到恢复的历史记录里面</span></span><br><span class="line">			<span class="keyword">this</span>.redoCmds.add(cmd );</span><br><span class="line">			<span class="comment">//然后把最后一个命令删除掉，</span></span><br><span class="line">			<span class="keyword">this</span>.undoCmds.remove(cmd);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"很抱歉，没有可撤销的命令"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redoPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="keyword">this</span>.redoCmds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//取出最后一个命令来重做</span></span><br><span class="line">			Command cmd = <span class="keyword">this</span>.redoCmds.get(<span class="keyword">this</span>.redoCmds.size()-<span class="number">1</span>);</span><br><span class="line">			cmd.redo();	</span><br><span class="line">			<span class="comment">//把这个命令记录到可撤销的历史记录里面</span></span><br><span class="line">			<span class="keyword">this</span>.undoCmds.add(cmd);</span><br><span class="line">			<span class="comment">//然后把最后一个命令删除掉</span></span><br><span class="line">			<span class="keyword">this</span>.redoCmds.remove(cmd);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"很抱歉，没有可恢复的命令"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//点菜（宏命令）</span></span><br><span class="line"><span class="comment">//示例：宏命令实现点菜过程</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点菜过程（宏命令）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//只是负责向服务员点菜就好了</span></span><br><span class="line">		<span class="comment">//创建服务员</span></span><br><span class="line">		Waiter waiter = <span class="keyword">new</span> Waiter();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建命令对象，就是要点的菜</span></span><br><span class="line">		Command chop = <span class="keyword">new</span> ChopCommand();</span><br><span class="line">		Command duck = <span class="keyword">new</span> DuckCommand();</span><br><span class="line">		Command pork = <span class="keyword">new</span> PorkCommand();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//点菜，就是把这些菜让服务员记录下来</span></span><br><span class="line">		waiter.orderDish(chop);</span><br><span class="line">		waiter.orderDish(duck);</span><br><span class="line">		waiter.orderDish(pork);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//点菜完毕</span></span><br><span class="line">		waiter.orderOver();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//服务员</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务员，负责组合菜单，负责组装每个菜和具体的实现者，</span></span><br><span class="line"><span class="comment"> * 还负责执行调用，相当于标准Command模式的Client+Invoker</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waiter</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有一个宏命令对象——菜单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> MenuCommand menuCommand = <span class="keyword">new</span> MenuCommand();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 客户点菜</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cmd 客户点的菜，每道菜是一个命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderDish</span><span class="params">(Command cmd)</span></span>&#123;</span><br><span class="line">		<span class="comment">//客户传过来的命令对象是没有和接收者组装的</span></span><br><span class="line">		<span class="comment">//在这里组装吧</span></span><br><span class="line">		CookApi hotCook = <span class="keyword">new</span> HotCook();</span><br><span class="line">		CookApi coolCook = <span class="keyword">new</span> CoolCook();</span><br><span class="line">		<span class="comment">//判读到底是组合凉菜师傅还是热菜师傅</span></span><br><span class="line">		<span class="comment">//简单点根据命令的原始对象的类型来判断</span></span><br><span class="line">		<span class="keyword">if</span>(cmd <span class="keyword">instanceof</span> DuckCommand)&#123;</span><br><span class="line">			((DuckCommand)cmd).setCookApi(hotCook);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmd <span class="keyword">instanceof</span> ChopCommand)&#123;</span><br><span class="line">			((ChopCommand)cmd).setCookApi(hotCook);</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(cmd <span class="keyword">instanceof</span> PorkCommand)&#123;</span><br><span class="line">			<span class="comment">//这是个凉菜，所以要组合凉菜的师傅</span></span><br><span class="line">			((PorkCommand)cmd).setCookApi(coolCook);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//添加到菜单中</span></span><br><span class="line">		menuCommand.addCommand(cmd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 客户点菜完毕，表示要执行命令了，这里就是执行菜单这个组合命令</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderOver</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.menuCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令接口，声明执行的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜品命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象，绿豆排骨煲</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChopCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CookApi cookApi = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cookApi 具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi = cookApi;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi.cook(<span class="string">"绿豆排骨煲"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜品命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象，北京烤鸭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> CookApi cookApi = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi = cookApi;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi.cook(<span class="string">"北京烤鸭"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜品命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象，蒜泥白肉</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PorkCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> CookApi cookApi = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi = cookApi;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi.cook(<span class="string">"蒜泥白肉"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//宏命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单对象，是个宏命令对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录组合本菜单的多道菜品，也就是多个命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Collection&lt;Command&gt; col = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 点菜，把菜品加入到菜单中</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cmd 客户点的菜</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCommand</span><span class="params">(Command cmd)</span></span>&#123;</span><br><span class="line">		col.add(cmd);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//执行菜单其实就是循环执行菜单里面的每个菜</span></span><br><span class="line">		<span class="keyword">for</span>(Command cmd : col)&#123;</span><br><span class="line">			cmd.execute();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//厨师接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 厨师的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CookApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，做菜的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 菜名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//凉菜厨师</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 厨师对象，做凉菜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CoolCook</span> <span class="keyword">implements</span> <span class="title">CookApi</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"凉菜"</span>+name+<span class="string">"已经做好，本厨师正在装盘。"</span> );</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//热菜厨师</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 厨师对象，做热菜</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotCook</span> <span class="keyword">implements</span> <span class="title">CookApi</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"本厨师正在做："</span>+name);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//点菜（队列）</span></span><br><span class="line"><span class="comment">//示例：队列加宏命令实现点菜过程</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 点菜队列命令的实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先要启动后台，让整个程序运行起来</span></span><br><span class="line">		CookManager.runCookManager();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//为了简单，直接用循环模拟多个桌号点菜</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>;i&lt;<span class="number">5</span>;i++)&#123;</span><br><span class="line">			<span class="comment">//创建服务员</span></span><br><span class="line">			Waiter waiter = <span class="keyword">new</span> Waiter();</span><br><span class="line">			<span class="comment">//创建命令对象，就是要点的菜</span></span><br><span class="line">			Command chop = <span class="keyword">new</span> ChopCommand(i);</span><br><span class="line">			Command duck = <span class="keyword">new</span> DuckCommand(i);</span><br><span class="line">			<span class="comment">//点菜，就是把这些菜让服务员记录下来</span></span><br><span class="line">			waiter.orderDish(chop);</span><br><span class="line">			waiter.orderDish(duck);</span><br><span class="line">			<span class="comment">//点菜完毕</span></span><br><span class="line">			waiter.orderOver();</span><br><span class="line">		&#125;		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//后厨管理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 后厨的管理类，通过此类让后厨的厨师进行运行状态</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CookManager</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来控制是否需要创建厨师，如果已经创建过了就不要再执行了</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> runFlag = <span class="keyword">false</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 运行厨师管理，创建厨师对象并启动他们相应的现程，</span></span><br><span class="line"><span class="comment">	 * 无论运行多少次，创建厨师对象和启动线程的工作就只做一次</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runCookManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!runFlag)&#123;</span><br><span class="line">			runFlag = <span class="keyword">true</span>;</span><br><span class="line">			<span class="comment">//创建三位厨师</span></span><br><span class="line">			HotCook cook1 = <span class="keyword">new</span> HotCook(<span class="string">"张三"</span>);</span><br><span class="line">			HotCook cook2 = <span class="keyword">new</span> HotCook(<span class="string">"李四"</span>);</span><br><span class="line">			HotCook cook3 = <span class="keyword">new</span> HotCook(<span class="string">"王五"</span>);</span><br><span class="line">			<span class="comment">//启动他们的线程</span></span><br><span class="line">			Thread t1 = <span class="keyword">new</span> Thread(cook1);</span><br><span class="line">			t1.start();</span><br><span class="line">			Thread t2 = <span class="keyword">new</span> Thread(cook2);</span><br><span class="line">			t2.start();</span><br><span class="line">			Thread t3 = <span class="keyword">new</span> Thread(cook3);</span><br><span class="line">			t3.start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//厨师接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 厨师的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CookApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，做菜的方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> tableNum 点菜的桌号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 菜名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">(<span class="keyword">int</span> tableNum,String name)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//热菜厨师</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 厨师对象，做热菜的厨师</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotCook</span> <span class="keyword">implements</span> <span class="title">CookApi</span>,<span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 厨师姓名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入厨师姓名</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 厨师姓名</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HotCook</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cook</span><span class="params">(<span class="keyword">int</span> tableNum,String name)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//每次做菜的时间是不一定的，用个随机数来模拟一下</span></span><br><span class="line">		<span class="keyword">int</span> cookTime = (<span class="keyword">int</span>)(<span class="number">20</span> * Math.random());</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.name+<span class="string">"厨师正在为"</span>+tableNum+<span class="string">"号桌做："</span>+name);</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="comment">//让线程休息这么长时间，表示正在做菜</span></span><br><span class="line">			Thread.sleep(cookTime);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.name+<span class="string">"厨师为"</span>+tableNum+<span class="string">"号桌做好了："</span>+name+<span class="string">",共计耗时="</span>+cookTime+<span class="string">"秒"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span>(<span class="keyword">true</span>)&#123;</span><br><span class="line">			<span class="comment">//到命令队列里面获取命令对象</span></span><br><span class="line">			Command cmd = CommandQueue.getOneCommand();</span><br><span class="line">			<span class="keyword">if</span>(cmd != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="comment">//说明取到命令对象了，这个命令对象还没有设置接收者</span></span><br><span class="line">				<span class="comment">//因为前面都还不知道到底哪一个厨师来真正执行这个命令</span></span><br><span class="line">				<span class="comment">//现在知道了，就是当前厨师实例，设置到命令对象里面</span></span><br><span class="line">				cmd.setCookApi(<span class="keyword">this</span>);</span><br><span class="line">				<span class="comment">//然后真正执行这个命令</span></span><br><span class="line">				cmd.execute();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//休息1秒</span></span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//服务员</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 服务员，负责组合菜单,还负责执行调用</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Waiter</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有一个宏命令对象——菜单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> MenuCommand menuCommand = <span class="keyword">new</span> MenuCommand();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 客户点菜</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cmd 客户点的菜，每道菜是一个命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderDish</span><span class="params">(Command cmd)</span></span>&#123;</span><br><span class="line">		<span class="comment">//添加到菜单中</span></span><br><span class="line">		menuCommand.addCommand(cmd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 客户点菜完毕，表示要执行命令了，这里就是执行菜单这个组合命令</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">orderOver</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.menuCommand.execute();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令接口，声明执行的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行命令对应的操作</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置命令的接收者</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cookApi 命令的接收者 </span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回发起请求的桌号，就是点菜的桌号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 发起请求的桌号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTableNum</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜单命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 菜单对象，是个宏命令对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MenuCommand</span> <span class="keyword">implements</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录组合本菜单的多道菜品，也就是多个命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Collection&lt;Command&gt; col = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 点菜，把菜品加入到菜单中</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cmd 客户点的菜</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCommand</span><span class="params">(Command cmd)</span></span>&#123;</span><br><span class="line">		col.add(cmd);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span></span>&#123;</span><br><span class="line">		<span class="comment">//什么都不用做</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTableNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//什么都不用做</span></span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取菜单中的多个命令对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 菜单中的多个命令对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Collection&lt;Command&gt; <span class="title">getCommands</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.col;</span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="comment">//执行菜单就是把菜单传递给后厨</span></span><br><span class="line">		CommandQueue.addMenu(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜品命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象，绿豆排骨煲</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChopCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> CookApi cookApi = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> cookApi 具体做菜的厨师的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi = cookApi;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 点菜的桌号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tableNum;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入点菜的桌号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> tableNum 点菜的桌号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ChopCommand</span><span class="params">(<span class="keyword">int</span> tableNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.tableNum = tableNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTableNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.tableNum;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi.cook(tableNum,<span class="string">"绿豆排骨煲"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//菜品命令</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象，北京烤鸭</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DuckCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="keyword">private</span> CookApi cookApi = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCookApi</span><span class="params">(CookApi cookApi)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi = cookApi;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tableNum;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">DuckCommand</span><span class="params">(<span class="keyword">int</span> tableNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.tableNum = tableNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTableNum</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.tableNum;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.cookApi.cook(tableNum,<span class="string">"北京烤鸭"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令队列</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令队列类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommandQueue</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来存储命令对象的队列</span></span><br><span class="line"><span class="comment">	 * 请注意：这里没有使用java.util.Queue，是因为常用的实现Queue接口的LinkedList类要求存放的对象是可排序的，</span></span><br><span class="line"><span class="comment">	 * 排序是使用的Comparator，这跟要演示的功能没有多大关系，反而会增加复杂性。</span></span><br><span class="line"><span class="comment">	 * 另外一个需要的功能是把命令对象按照先后顺序排好就可以了，只要是有序的就可以了。</span></span><br><span class="line"><span class="comment">	 * 因此为了演示的简洁性，就直接使用List了。</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> List&lt;Command&gt; cmds = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 服务员传过来一个新的菜单</span></span><br><span class="line"><span class="comment">	 * 需要同步：是因为同时会有很多的服务员传入菜单，而同时又有很多厨师在从队列里取值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> menu 传入的菜单</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">addMenu</span><span class="params">(MenuCommand menu)</span></span>&#123;</span><br><span class="line">		<span class="comment">//一个菜单对象包含很多命令对象</span></span><br><span class="line">		<span class="keyword">for</span>(Command cmd : menu.getCommands())&#123;</span><br><span class="line">			cmds.add(cmd);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 厨师从命令队列里面获取命令对象进行处理，也是需要同步的</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> Command <span class="title">getOneCommand</span><span class="params">()</span></span>&#123;</span><br><span class="line">		Command cmd = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>(cmds.size() &gt; <span class="number">0</span> )&#123;</span><br><span class="line">			<span class="comment">//取出队列的第一个，因为是约定的按照加入的先后来处理</span></span><br><span class="line">			cmd = cmds.get(<span class="number">0</span>);</span><br><span class="line">			<span class="comment">//同时从队列里面取掉这个命令对象</span></span><br><span class="line">			cmds.remove(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> cmd;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="迭代器模式">迭代器模式</h2>
<h3 id="描述">描述</h3>
<p>定义：提供一种方法顺序访问一个聚合对象中各个元素，而又不需要暴露该对象的内部表示。本质是控制访问聚合对象中的元素。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Iterator</td>
<td>迭代器接口，定义访问和遍历元素的接口</td>
</tr>
<tr>
<td>ConcreteIterator</td>
<td>具体的迭代器实现对象，实现对聚合对象的遍历，并跟踪遍历时的当前位置</td>
</tr>
<tr>
<td>Aggregate</td>
<td>聚合对象，定义创建相应迭代器对象的接口</td>
</tr>
<tr>
<td>ConcreteAggregate</td>
<td>具体聚合对象，实现创建相应的迭代器对象</td>
</tr>
</tbody>
</table>
<p>内部迭代器：由迭代器自身控制迭代下一个元素的步骤，客户端无法干预。因此，若需在迭代过程中完成工作，客户端则需将操作传给迭代器，类似于Java的回调机制。</p>
<p>外部迭代器：有客户端控制下一个元素的步骤，如：客户端必须显式调用next方法迭代下一个元素。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>更好的封装性</li>
<li>简化聚合接口</li>
<li>简化调用</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>若需提供访问一个聚合对象的内容，又不暴露它的内部表示时</li>
<li>需有多种遍历方式可以访问聚合对象时</li>
<li>需为遍历不同的聚合对象提供一个统一的接口</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//工资表数据整合</span></span><br><span class="line"><span class="comment">//示例：将母公司和子公司的工资整合起来，统一查看</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 迭代模式的使用：工资表数据整合，一个是用 list ，一个是用 array ，需要以统一的方式访问</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//访问集团的工资列表</span></span><br><span class="line">		PayManager payManager= <span class="keyword">new</span> PayManager();</span><br><span class="line">		<span class="comment">//先计算再获取</span></span><br><span class="line">		payManager.calcPay();</span><br><span class="line">		System.out.println(<span class="string">"集团工资列表："</span>);</span><br><span class="line">		test(payManager.createIterator());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//访问新收购公司的工资列表</span></span><br><span class="line">		SalaryManager salaryManager = <span class="keyword">new</span> SalaryManager();</span><br><span class="line">		<span class="comment">//先计算再获取</span></span><br><span class="line">		salaryManager.calcSalary();</span><br><span class="line">		System.out.println(<span class="string">"新收购的公司工资列表："</span>);</span><br><span class="line">		test(salaryManager.createIterator());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 测试通过访问聚合对象的迭代器，是否能正常访问聚合对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> it 聚合对象的迭代器</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(Iterator it)</span></span>&#123;</span><br><span class="line">		<span class="comment">//循环输出聚合对象中的值</span></span><br><span class="line">		<span class="comment">//首先设置迭代器到第一个元素</span></span><br><span class="line">		it.first();</span><br><span class="line">		<span class="keyword">while</span>(!it.isDone())&#123;</span><br><span class="line">			<span class="comment">//取出当前的元素来</span></span><br><span class="line">			Object obj = it.currentItem();</span><br><span class="line">			System.out.println(<span class="string">"the obj=="</span>+obj);</span><br><span class="line">			<span class="comment">//如果还没有迭代到最后，那么就向下迭代一个</span></span><br><span class="line">			it.next();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//聚合接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 聚合对象的接口，定义创建相应迭代器对象的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Aggregate</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 工厂方法，创建相应迭代器对象的接口</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 相应迭代器对象的接口</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> Iterator <span class="title">createIterator</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//母公司工资类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 客户方已有的工资管理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayManager</span> <span class="keyword">extends</span> <span class="title">Aggregate</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 聚合对象，这里是Java的集合对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取工资列表</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 工资列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List <span class="title">getPayList</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 计算工资，其实应该有很多参数，为了演示从简</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcPay</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//计算工资，并把工资信息填充到工资列表里面</span></span><br><span class="line">		<span class="comment">//为了测试，做点假数据进去</span></span><br><span class="line">		PayModel pm1 = <span class="keyword">new</span> PayModel();</span><br><span class="line">		pm1.setPay(<span class="number">3800</span>);</span><br><span class="line">		pm1.setUserName(<span class="string">"张三"</span>);</span><br><span class="line">		</span><br><span class="line">		PayModel pm2 = <span class="keyword">new</span> PayModel();</span><br><span class="line">		pm2.setPay(<span class="number">5800</span>);</span><br><span class="line">		pm2.setUserName(<span class="string">"李四"</span>);</span><br><span class="line">		</span><br><span class="line">		list.add(pm1);</span><br><span class="line">		list.add(pm2);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> CollectionIteratorImpl(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		Object retObj = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="keyword">this</span>.list.size())&#123;</span><br><span class="line">			retObj = <span class="keyword">this</span>.list.get(index);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> retObj;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.list.size();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//子公司工资类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 被客户方收购的那个公司的工资管理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SalaryManager</span> <span class="keyword">extends</span> <span class="title">Aggregate</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用数组管理</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> PayModel[] pms = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取工资列表</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 工资列表</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> PayModel[] getPays()&#123;</span><br><span class="line">		<span class="keyword">return</span> pms;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 计算工资，其实应该有很多参数，为了演示从简</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcSalary</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//计算工资，并把工资信息填充到工资列表里面</span></span><br><span class="line">		<span class="comment">//为了测试，做点假数据进去</span></span><br><span class="line">		PayModel pm1 = <span class="keyword">new</span> PayModel();</span><br><span class="line">		pm1.setPay(<span class="number">2200</span>);</span><br><span class="line">		pm1.setUserName(<span class="string">"王五"</span>);</span><br><span class="line">		</span><br><span class="line">		PayModel pm2 = <span class="keyword">new</span> PayModel();</span><br><span class="line">		pm2.setPay(<span class="number">3600</span>);</span><br><span class="line">		pm2.setUserName(<span class="string">"赵六"</span>);</span><br><span class="line">		</span><br><span class="line">		pms = <span class="keyword">new</span> PayModel[<span class="number">2</span>];</span><br><span class="line">		pms[<span class="number">0</span>] = pm1;</span><br><span class="line">		pms[<span class="number">1</span>] = pm2;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Iterator <span class="title">createIterator</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> ArrayIteratorImpl(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(<span class="keyword">int</span> index)</span></span>&#123;</span><br><span class="line">		Object retObj = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>(index &lt; pms.length)&#123;</span><br><span class="line">			retObj = pms[index];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> retObj;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.pms.length;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//迭代器接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 迭代器接口，定义访问和遍历元素的操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Iterator</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移动到聚合对象的第一个位置</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 移动到聚合对象的下一个位置</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断是否已经移动聚合对象的最后一个位置</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示已经移动聚合对象的最后一个位置，</span></span><br><span class="line"><span class="comment">	 *         false表示还没有移动到聚合对象的最后一个位置</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取迭代的当前元素</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 迭代的当前元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">currentItem</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//访问数组迭代器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用来实现访问数组的迭代接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayIteratorImpl</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来存放被迭代的聚合对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> SalaryManager aggregate = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录当前迭代到的位置索引</span></span><br><span class="line"><span class="comment">	 * -1表示刚开始的时候，迭代器指向聚合对象第一个对象之前</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index = -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ArrayIteratorImpl</span><span class="params">(SalaryManager aggregate)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.aggregate = aggregate;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">()</span></span>&#123;</span><br><span class="line">		index = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="keyword">this</span>.aggregate.size())&#123;</span><br><span class="line">			index = index + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index == <span class="keyword">this</span>.aggregate.size())&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">currentItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.aggregate.get(index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//访问集合迭代器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用来实现访问Collection集合的迭代接口，为了外部统一访问方式</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CollectionIteratorImpl</span> <span class="keyword">implements</span> <span class="title">Iterator</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来存放被迭代的聚合对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> PayManager aggregate = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录当前迭代到的位置索引</span></span><br><span class="line"><span class="comment">	 * -1表示刚开始的时候，迭代器指向聚合对象第一个对象之前</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> index = -<span class="number">1</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CollectionIteratorImpl</span><span class="params">(PayManager aggregate)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.aggregate = aggregate;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">first</span><span class="params">()</span></span>&#123;</span><br><span class="line">		index = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">next</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index &lt; <span class="keyword">this</span>.aggregate.size())&#123;</span><br><span class="line">			index = index + <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(index == <span class="keyword">this</span>.aggregate.size())&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">currentItem</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.aggregate.get(index);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工资模型</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工资描述模型对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 支付工资的人员</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String userName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 支付的工资数额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> pay;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserName</span><span class="params">(String userName)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pay;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPay</span><span class="params">(<span class="keyword">double</span> pay)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pay = pay;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"userName="</span>+userName+<span class="string">",pay="</span>+pay;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模板方法模式">模板方法模式</h2>
<h3 id="描述">描述</h3>
<p>定义：定义一个操作中的算法骨架，将部分步骤延迟到子类中实现；使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。本质是固定算法骨架。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AbstractClass</td>
<td>抽象类，定义算法骨架和原语操作并提供算法中部分步骤的通用实现</td>
</tr>
<tr>
<td>ConcreteClass</td>
<td>实现类，实现算法骨架中的某些步骤，完成跟特定子类相关的功能</td>
</tr>
</tbody>
</table>
<p>原语操作：在模板中定义的抽象操作，且是必需的，需由子类实现。</p>
<p>钩子操作：在模板中定义并提供默认实现的操作。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>代码复用</li>
</ol>
<p>缺点</p>
<ol>
<li>算法骨架不易升级</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>需固定算法骨架，实现一个算法不变的部分，并将可变的行为由其子类实现</li>
<li>各个子类中具有公共行为，应该抽取出来，集中到公共类中实现，从而实现代码复用</li>
<li>需控制子类扩展的情况，模板方法模式会在特定时刻调用子类的方法，这样只允许在扩展这些方法</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调技术</span></span><br><span class="line"><span class="comment">//示例：字符串转大小写（JDK1.8回调方式）</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallbackDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">adapter</span><span class="params">(Function&lt;String, String&gt; function)</span> </span>&#123;</span><br><span class="line">		String message = <span class="string">"Hello World"</span>;</span><br><span class="line">		System.out.println(function.apply(message));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Function&lt;String, String&gt; function1 = (str) -&gt; &#123;</span><br><span class="line">			<span class="keyword">return</span> str.toUpperCase();</span><br><span class="line">		&#125;;</span><br><span class="line">		Function&lt;String, String&gt; function2 = (str) -&gt; &#123;</span><br><span class="line">			<span class="keyword">return</span> str.toLowerCase();</span><br><span class="line">		&#125;;</span><br><span class="line">		adapter(function1);</span><br><span class="line">		adapter(function2);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多种类型用户登陆</span></span><br><span class="line"><span class="comment">//继承实现</span></span><br><span class="line"><span class="comment">//示例：模板方法模式使用继承实现多种类型用户登陆逻辑</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用模板模式实现 普通用户与员工 登录功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//准备登录人的信息</span></span><br><span class="line">		LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">		lm.setLoginId(<span class="string">"admin"</span>);</span><br><span class="line">		lm.setPwd(<span class="string">"workerpwd"</span>);</span><br><span class="line">		<span class="comment">//准备用来进行判断的对象</span></span><br><span class="line">		LoginTemplate lt = <span class="keyword">new</span> WorkerLogin();</span><br><span class="line">		LoginTemplate lt2 = <span class="keyword">new</span> NormalLogin();</span><br><span class="line">		<span class="comment">//进行登录测试</span></span><br><span class="line">		<span class="keyword">boolean</span> flag = lt.login(lm);</span><br><span class="line">		System.out.println(<span class="string">"可以登录工作平台="</span>+flag);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">boolean</span> flag2 = lt2.login(lm);</span><br><span class="line">		System.out.println(<span class="string">"可以进行普通人员登录="</span>+flag2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//准备登录人的信息</span></span><br><span class="line">		NormalLoginModel nlm = <span class="keyword">new</span> NormalLoginModel();</span><br><span class="line">		nlm.setLoginId(<span class="string">"testUser"</span>);</span><br><span class="line">		nlm.setPwd(<span class="string">"testpwd"</span>);</span><br><span class="line">		nlm.setQuestion(<span class="string">"testQuestion"</span>);</span><br><span class="line">		nlm.setAnswer(<span class="string">"testAnswer"</span>);</span><br><span class="line">		<span class="comment">//准备用来进行判断的对象</span></span><br><span class="line">		LoginTemplate lt3 = <span class="keyword">new</span> NormalLogin2();</span><br><span class="line">		<span class="comment">//进行登录测试</span></span><br><span class="line">		<span class="keyword">boolean</span> flag3 = lt3.login(nlm);</span><br><span class="line">		System.out.println(<span class="string">"可以进行普通人员加强版登录="</span>+flag3);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//登陆模型</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装进行登录控制所需要的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登录人员的编号，通用的，可能是用户编号，也可能是工作人员编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String loginId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登录的密码</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String pwd;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLoginId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> loginId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoginId</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.loginId = loginId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(String pwd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//登陆模板抽象类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	登录控制的模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginTemplate</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断登录数据是否正确，也就是是否能登录成功</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 封装登录数据的Model</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示登录成功，false表示登录失败</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(LoginModel lm)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：根据登录人员的编号去获取相应的数据</span></span><br><span class="line">		LoginModel dbLm = <span class="keyword">this</span>.findLoginUser(lm.getLoginId());</span><br><span class="line">		<span class="keyword">if</span>(dbLm!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//2：对密码进行加密</span></span><br><span class="line">			String encryptPwd = <span class="keyword">this</span>.encryptPwd(lm.getPwd());</span><br><span class="line">			<span class="comment">//把加密后的密码设置回到登录数据模型里面</span></span><br><span class="line">			lm.setPwd(encryptPwd);</span><br><span class="line">			<span class="comment">//3：判断是否匹配</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.match(lm, dbLm);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据登录编号来查找和获取存储中相应的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> loginId 登录编号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 登录编号在存储中相对应的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对密码数据进行加密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pwd 密码数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 加密后的密码数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断用户填写的登录数据和存储中对应的数据是否匹配得上</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 用户填写的登录数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dbLm 在存储中对应的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示匹配成功，false表示匹配失败</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm,LoginModel dbLm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(lm.getLoginId().equals(dbLm.getLoginId()) </span><br><span class="line">				&amp;&amp; lm.getPwd().equals(dbLm.getPwd()))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通登陆实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通用户登录控制的逻辑处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalLogin</span> <span class="keyword">extends</span> <span class="title">LoginTemplate</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 这里省略具体的处理，仅做示意，返回一个有默认数据的对象</span></span><br><span class="line">		LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">		lm.setLoginId(loginId);</span><br><span class="line">		lm.setPwd(<span class="string">"testpwd"</span>);</span><br><span class="line">		<span class="keyword">return</span> lm;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工作人员登陆实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 工作人员登录控制的逻辑处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WorkerLogin</span> <span class="keyword">extends</span> <span class="title">LoginTemplate</span></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 这里省略具体的处理，仅做示意，返回一个有默认数据的对象</span></span><br><span class="line">		LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">		lm.setLoginId(loginId);</span><br><span class="line">		lm.setPwd(<span class="string">"workerpwd"</span>);</span><br><span class="line">		<span class="keyword">return</span> lm;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd)</span></span>&#123;</span><br><span class="line">		<span class="comment">//覆盖父类的方法，提供真正的加密实现</span></span><br><span class="line">		<span class="comment">//这里对密码进行加密，比如使用：MD5、3DES等等，省略了</span></span><br><span class="line">		System.out.println(<span class="string">"使用MD5进行密码加密"</span>);</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通登陆加强实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 普通用户登录控制加强版的逻辑处理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalLogin2</span> <span class="keyword">extends</span> <span class="title">LoginTemplate</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 这里省略具体的处理，仅做示意，返回一个有默认数据的对象</span></span><br><span class="line">		<span class="comment">//注意一点：这里使用的是自己需要的数据模型了</span></span><br><span class="line">		NormalLoginModel nlm = <span class="keyword">new</span> NormalLoginModel();</span><br><span class="line">		nlm.setLoginId(loginId);</span><br><span class="line">		nlm.setPwd(<span class="string">"testpwd"</span>);</span><br><span class="line">		nlm.setQuestion(<span class="string">"testQuestion"</span>);</span><br><span class="line">		nlm.setAnswer(<span class="string">"testAnswer"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">return</span> nlm;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm,LoginModel dbLm)</span></span>&#123;</span><br><span class="line">		<span class="comment">//这个方法需要覆盖，因为现在进行登录控制的时候，</span></span><br><span class="line">		<span class="comment">//需要检测4个值是否正确，而不仅仅是缺省的2个</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//先调用父类实现好的，检测编号和密码是否正确</span></span><br><span class="line">		<span class="keyword">boolean</span> f1 = <span class="keyword">super</span>.match(lm, dbLm);</span><br><span class="line">		<span class="keyword">if</span>(f1)&#123;</span><br><span class="line">			<span class="comment">//如果编号和密码正确，继续检查问题和答案是否正确</span></span><br><span class="line">			</span><br><span class="line">			<span class="comment">//先把数据转换成自己需要的数据</span></span><br><span class="line">			NormalLoginModel nlm = (NormalLoginModel)lm;</span><br><span class="line">			NormalLoginModel dbNlm = (NormalLoginModel)dbLm;</span><br><span class="line">			<span class="comment">//检查问题和答案是否正确</span></span><br><span class="line">			<span class="keyword">if</span>(dbNlm.getQuestion().equals(nlm.getQuestion())</span><br><span class="line">					&amp;&amp; dbNlm.getAnswer().equals(nlm.getAnswer()))&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//普通登陆加强模型</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装进行登录控制所需要的数据，在公共数据的基础上，</span></span><br><span class="line"><span class="comment"> * 添加具体模块需要的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalLoginModel</span> <span class="keyword">extends</span> <span class="title">LoginModel</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 密码验证问题</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String question;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 密码验证答案</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String answer;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getQuestion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> question;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQuestion</span><span class="params">(String question)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.question = question;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAnswer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> answer;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAnswer</span><span class="params">(String answer)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.answer = answer;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//回调实现</span></span><br><span class="line"><span class="comment">//示例：模板方法模式使用回调技术实现多种类型用户登陆逻辑</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用 java 的回调机制实现登录功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//准备登录人的信息</span></span><br><span class="line">		LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">		lm.setLoginId(<span class="string">"admin"</span>);</span><br><span class="line">		lm.setPwd(<span class="string">"workerpwd"</span>);</span><br><span class="line">		<span class="comment">//准备用来进行判断的对象</span></span><br><span class="line">		LoginTemplate lt = <span class="keyword">new</span> LoginTemplate();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//进行登录测试，先测试普通人员登录</span></span><br><span class="line">		<span class="keyword">boolean</span> flag = lt.login(lm,<span class="keyword">new</span> LoginCallback()&#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd, LoginTemplate template)</span> </span>&#123;</span><br><span class="line">				<span class="comment">//自己不需要，直接转调模板中的默认实现</span></span><br><span class="line">				<span class="keyword">return</span> template.encryptPwd(pwd);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// 这里省略具体的处理，仅做示意，返回一个有默认数据的对象</span></span><br><span class="line">				LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">				lm.setLoginId(loginId);</span><br><span class="line">				lm.setPwd(<span class="string">"testpwd"</span>);</span><br><span class="line">				<span class="keyword">return</span> lm;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm, LoginModel dbLm,</span></span></span><br><span class="line"><span class="function"><span class="params">					LoginTemplate template)</span> </span>&#123;</span><br><span class="line">				<span class="comment">//自己不需要覆盖，直接转调模板中的默认实现</span></span><br><span class="line">				<span class="keyword">return</span> template.match(lm, dbLm);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		System.out.println(<span class="string">"可以进行普通人员登录="</span>+flag);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//测试工作人员登录</span></span><br><span class="line">		<span class="keyword">boolean</span> flag2 = lt.login(lm,<span class="keyword">new</span> LoginCallback()&#123;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd, LoginTemplate template)</span> </span>&#123;</span><br><span class="line">				<span class="comment">//覆盖父类的方法，提供真正的加密实现</span></span><br><span class="line">				<span class="comment">//这里对密码进行加密，比如使用：MD5、3DES等等，省略了</span></span><br><span class="line">				System.out.println(<span class="string">"使用MD5进行密码加密"</span>);</span><br><span class="line">				<span class="keyword">return</span> pwd;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">				<span class="comment">// 这里省略具体的处理，仅做示意，返回一个有默认数据的对象</span></span><br><span class="line">				LoginModel lm = <span class="keyword">new</span> LoginModel();</span><br><span class="line">				lm.setLoginId(loginId);</span><br><span class="line">				lm.setPwd(<span class="string">"workerpwd"</span>);</span><br><span class="line">				<span class="keyword">return</span> lm;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm, LoginModel dbLm,</span></span></span><br><span class="line"><span class="function"><span class="params">					LoginTemplate template)</span> </span>&#123;</span><br><span class="line">				<span class="comment">//自己不需要覆盖，直接转调模板中的默认实现</span></span><br><span class="line">				<span class="keyword">return</span> template.match(lm, dbLm);</span><br><span class="line">			&#125;</span><br><span class="line">			</span><br><span class="line">		&#125;);		</span><br><span class="line">		System.out.println(<span class="string">"可以登录工作平台="</span>+flag2);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//登陆模型</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装进行登录控制所需要的数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登录人员的编号，通用的，可能是用户编号，也可能是工作人员编号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String loginId;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 登录的密码</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String pwd;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getLoginId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> loginId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLoginId</span><span class="params">(String loginId)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.loginId = loginId;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getPwd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPwd</span><span class="params">(String pwd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.pwd = pwd;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//回调接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 登录控制的模板方法需要的回调接口，</span></span><br><span class="line"><span class="comment"> * 需要尽可能的把所有需要的接口方法都定义出来,</span></span><br><span class="line"><span class="comment"> * 或者说是所有可以被扩展的方法都需要被定义出来</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">LoginCallback</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 根据登录编号来查找和获取存储中相应的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> loginId 登录编号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 登录编号在存储中相对应的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> LoginModel <span class="title">findLoginUser</span><span class="params">(String loginId)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对密码数据进行加密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pwd 密码数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> template LoginTemplate对象，通过它来调用在</span></span><br><span class="line"><span class="comment">	 * 				LoginTemplate中定义的公共方法或缺省实现</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 加密后的密码数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd,LoginTemplate template)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断用户填写的登录数据和存储中对应的数据是否匹配得上</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 用户填写的登录数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dbLm 在存储中对应的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> template LoginTemplate对象，通过它来调用在</span></span><br><span class="line"><span class="comment">	 * 				LoginTemplate中定义的公共方法或缺省实现</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示匹配成功，false表示匹配失败</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm,LoginModel dbLm,LoginTemplate template)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//登陆实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	登录控制的模板</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginTemplate</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断登录数据是否正确，也就是是否能登录成功</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 封装登录数据的Model</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> callback LoginCallback对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示登录成功，false表示登录失败</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">login</span><span class="params">(LoginModel lm,LoginCallback callback)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：根据登录人员的编号去获取相应的数据</span></span><br><span class="line">		LoginModel dbLm = callback.findLoginUser(lm.getLoginId());</span><br><span class="line">		<span class="keyword">if</span>(dbLm!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//2：对密码进行加密</span></span><br><span class="line">			String encryptPwd = callback.encryptPwd(lm.getPwd(),<span class="keyword">this</span>);</span><br><span class="line">			<span class="comment">//把加密后的密码设置回到登录数据模型里面</span></span><br><span class="line">			lm.setPwd(encryptPwd);</span><br><span class="line">			<span class="comment">//3：判断是否匹配</span></span><br><span class="line">			<span class="keyword">return</span> callback.match(lm, dbLm,<span class="keyword">this</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 对密码数据进行加密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pwd 密码数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 加密后的密码数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">encryptPwd</span><span class="params">(String pwd)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> pwd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 判断用户填写的登录数据和存储中对应的数据是否匹配得上</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> lm 用户填写的登录数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> dbLm 在存储中对应的数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> true表示匹配成功，false表示匹配失败</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">match</span><span class="params">(LoginModel lm,LoginModel dbLm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(lm.getLoginId().equals(dbLm.getLoginId()) </span><br><span class="line">				&amp;&amp; lm.getPwd().equals(dbLm.getPwd()))&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="策略模式">策略模式</h2>
<h3 id="描述">描述</h3>
<p>定义：定义一系列封装好的算法并使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。本质是分离算法，选择实现。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Strategy</td>
<td>策略接口，约束一系列具体的策略算法。Context使用其调用具体的策略实现定义的算法</td>
</tr>
<tr>
<td>ConcreteStrategy</td>
<td>具体的策略实现</td>
</tr>
<tr>
<td>Context</td>
<td>上下文，负责和具体的策略类交互</td>
</tr>
</tbody>
</table>
<p>实现容错恢复：策略模式可以实现容错恢复功能。如：正常情况需将操作日志记录到数据库，若出现异常情况，可以暂时记录到文件，待数据库正常后，再从文件读取日志记录到数据库。保证记录日志功能正常使用。</p>
<p>对于一系列算法的实现上存在公共功能的情况，策略模式有3中实现方式</p>
<ol>
<li>在上下文实现公共功能，让具体的策略算法回调这些方法</li>
<li>将策略的接口改造成抽象类，并在其中实现具体算法的公共功能</li>
<li>为策略算法定义一个抽象的父类，使其父类实现策略接口和公共功能</li>
</ol>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>定义一系列算法</li>
<li>避免多重条件语句</li>
<li>更好的扩展性</li>
</ol>
<p>缺点</p>
<ol>
<li>客户必须了解各种策略的差异</li>
<li>增加了类</li>
<li>只适合扁平的算法结构</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>出现有相关的类，仅仅是行为有差别的情况</li>
<li>出现同一个算法，有多种不同的实现情况</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//报价管理（JDK1.5回调技术）</span></span><br><span class="line"><span class="comment">//示例：使用JDK1.5回调技术实现对不同客户的报价管理</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用策略模式实现报价逻辑</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：选择并创建需要使用的策略对象</span></span><br><span class="line">		Strategy strategy = <span class="keyword">new</span> LargeCustomerStrategy();</span><br><span class="line">		<span class="comment">//2：创建上下文</span></span><br><span class="line">		Price ctx = <span class="keyword">new</span> Price(strategy);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3：计算报价</span></span><br><span class="line">		<span class="keyword">double</span> quote = ctx.quote(<span class="number">1000</span>);</span><br><span class="line">		System.out.println(<span class="string">"向客户报价："</span>+quote);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//策略接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 策略，定义计算报价算法的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Strategy</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 计算应报的价格</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> goodsPrice 商品销售原价</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 计算出来的，应该给客户报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//战略合作客户策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体算法实现，为战略合作客户客户计算应报的价格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CooperateCustomerStrategy</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"对于战略合作客户，统一8折"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*<span class="number">0.8</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//大客户策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体算法实现，为大客户计算应报的价格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LargeCustomerStrategy</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"对于大客户，统一折扣10%"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*(<span class="number">1</span>-<span class="number">0.1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//新客户或普通客户策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体算法实现，为新客户或者是普通客户计算应报的价格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalCustomerStrategy</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"对于新客户或者是普通客户，没有折扣"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//老客户策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体算法实现，为老客户计算应报的价格</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OldCustomerStrategy</span> <span class="keyword">implements</span> <span class="title">Strategy</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"对于老客户，统一折扣5%"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*(<span class="number">1</span>-<span class="number">0.05</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//价格管理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 价格管理，主要完成计算向客户所报价格的功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Price</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有一个具体的策略对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Strategy strategy = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入一个具体的策略对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> aStrategy 具体的策略对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Price</span><span class="params">(Strategy aStrategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.strategy = aStrategy;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 报价，计算对客户的报价</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> goodsPrice 商品销售原价</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 计算出来的，应该给客户报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">quote</span><span class="params">(<span class="keyword">double</span> goodsPrice)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.strategy.calcPrice(goodsPrice);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//价格管理（JDK1.8回调技术）</span></span><br><span class="line"><span class="comment">//示例：使用JDK1.8回调技术实现对不同客户的报价管理</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用策略模式实现报价逻辑</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：创建上下文</span></span><br><span class="line">		Price ctx = <span class="keyword">new</span> Price();</span><br><span class="line"></span><br><span class="line">		<span class="comment">//2：计算报价</span></span><br><span class="line">		<span class="keyword">double</span> quote = ctx.quote(<span class="number">1000</span>, StrategyUtil.cooperateCustomerStrategy);</span><br><span class="line">		</span><br><span class="line">		System.out.println(<span class="string">"向客户报价："</span>+quote);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//价格管理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 价格管理，主要完成计算向客户所报价格的功能</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Price</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 报价，计算对客户的报价</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> goodsPrice 商品销售原价</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> calcPrice 计算函数</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 计算出来的，应该给客户报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">quote</span><span class="params">(<span class="keyword">double</span> goodsPrice, Function&lt;Double, Double&gt; calcPrice)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> calcPrice.apply(goodsPrice);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//策略工具类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 策略工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StrategyUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">StrategyUtil</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体算法实现，为大客户计算应报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Function&lt;Double, Double&gt; largeCustomerStrategy = (goodsPrice) -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">"对于大客户，统一折扣10%"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*(<span class="number">1</span>-<span class="number">0.1</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体算法实现，为战略合作客户客户计算应报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Function&lt;Double, Double&gt; cooperateCustomerStrategy = (goodsPrice) -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">"对于战略合作客户，统一8折"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*<span class="number">0.8</span>;</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体算法实现，为新客户或者是普通客户计算应报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Function&lt;Double, Double&gt; normalCustomerStrategy = (goodsPrice) -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">"对于新客户或者是普通客户，没有折扣"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice;</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体算法实现，为老客户计算应报的价格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> Function&lt;Double, Double&gt; oldCustomerStrategy = (goodsPrice) -&gt; &#123;</span><br><span class="line">		System.out.println(<span class="string">"对于老客户，统一折扣5%"</span>);</span><br><span class="line">		<span class="keyword">return</span> goodsPrice*(<span class="number">1</span>-<span class="number">0.05</span>);</span><br><span class="line">	&#125;;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//工资支付</span></span><br><span class="line"><span class="comment">//示例：实现多种工资支付方式的自由切换</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用策略模式实现 复杂的工资支付功能</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//创建相应的支付策略</span></span><br><span class="line">		PaymentStrategy strategyRMB = <span class="keyword">new</span> RMBCash();</span><br><span class="line">		PaymentStrategy strategyDollar = <span class="keyword">new</span> DollarCash();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//准备小李的支付工资上下文</span></span><br><span class="line">		PaymentContext ctx1 = <span class="keyword">new</span> PaymentContext(<span class="string">"小李"</span>,<span class="number">5000</span>,strategyRMB);</span><br><span class="line">		<span class="comment">//向小李支付工资</span></span><br><span class="line">		ctx1.payNow();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//切换一个人，给petter支付工资</span></span><br><span class="line">		PaymentContext ctx2 = <span class="keyword">new</span> PaymentContext(<span class="string">"Petter"</span>,<span class="number">8000</span>,strategyDollar);</span><br><span class="line">		ctx2.payNow();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试新添加的支付方式</span></span><br><span class="line">		PaymentStrategy strategyCard = <span class="keyword">new</span> Card();</span><br><span class="line">		PaymentContext ctx3 = <span class="keyword">new</span> PaymentContext2(<span class="string">"小王"</span>,<span class="number">9000</span>,<span class="string">"010998877656"</span>,strategyCard);</span><br><span class="line">		ctx3.payNow();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试新添加的支付方式</span></span><br><span class="line">		PaymentStrategy strategyCard2 = <span class="keyword">new</span> Card2(<span class="string">"010998877656"</span>);</span><br><span class="line">		PaymentContext ctx4 = <span class="keyword">new</span> PaymentContext(<span class="string">"小张"</span>,<span class="number">9000</span>,strategyCard2);</span><br><span class="line">		ctx4.payNow();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支付工资策略接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付工资的策略的接口，公司有多种支付工资的算法</span></span><br><span class="line"><span class="comment"> * 比如：现金、银行卡、现金加股票、现金加期权、美元支付等等</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PaymentStrategy</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 公司给某人真正支付工资</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ctx 支付工资的上下文，里面包含算法需要的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentContext ctx)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//人民币现金支付策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 人民币现金支付</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RMBCash</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentContext ctx)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"现在给"</span>+ctx.getUserName()+<span class="string">"人民币现金支付"</span>+ctx.getMoney()+<span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//美元现金支付策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 美元现金支付</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DollarCash</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentContext ctx)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"现在给"</span>+ctx.getUserName()+<span class="string">"美元现金支付"</span>+ctx.getMoney()+<span class="string">"元"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支付到银行卡策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付到银行卡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Card</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentContext ctx)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//这个新的算法自己知道要使用扩展的支付上下文，所以强制造型一下</span></span><br><span class="line">		PaymentContext2 ctx2 = (PaymentContext2)ctx;</span><br><span class="line">		System.out.println(<span class="string">"现在给"</span>+ctx2.getUserName()+<span class="string">"的"</span>+ctx2.getAccount()+<span class="string">"帐号支付了"</span>+ctx2.getMoney()+<span class="string">"元"</span>);</span><br><span class="line">		<span class="comment">//连接银行，进行转帐，就不去管了</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支付到银行卡加强策略实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付到银行卡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Card2</span> <span class="keyword">implements</span> <span class="title">PaymentStrategy</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 帐号信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String account = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入帐号信息</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> account 帐号信息</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Card2</span><span class="params">(String account)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.account = account;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pay</span><span class="params">(PaymentContext ctx)</span> </span>&#123;</span><br><span class="line">		System.out.println(<span class="string">"现在给"</span>+ctx.getUserName()+<span class="string">"的"</span>+<span class="keyword">this</span>.account+<span class="string">"帐号支付了"</span>+ctx.getMoney()+<span class="string">"元"</span>);</span><br><span class="line">		<span class="comment">//连接银行，进行转帐，就不去管了</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支付工资的上下文实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 支付工资的上下文，每个人的工资不同，支付方式也不同</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentContext</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 应被支付工资的人员，简单点，用姓名来代替</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String userName = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 应被支付的工资的金额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> money = <span class="number">0.0</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 支付工资的方式策略的接口</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> PaymentStrategy strategy = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入被支付工资的人员，应支付的金额和具体的支付策略</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userName 被支付工资的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> money 应支付的金额</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> strategy 具体的支付策略</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PaymentContext</span><span class="params">(String userName,<span class="keyword">double</span> money,PaymentStrategy strategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.userName = userName;</span><br><span class="line">		<span class="keyword">this</span>.money = money;</span><br><span class="line">		<span class="keyword">this</span>.strategy = strategy;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 立即支付工资</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">payNow</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//使用客户希望的支付策略来支付工资</span></span><br><span class="line">		<span class="keyword">this</span>.strategy.pay(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> userName;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getMoney</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> money;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//支付工资的上下文加强实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 扩展的支付上下文对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaymentContext2</span> <span class="keyword">extends</span> <span class="title">PaymentContext</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 银行帐号</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String account = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入被支付工资的人员，应支付的金额和具体的支付策略</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> userName 被支付工资的人员</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> money 应支付的金额</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> account 支付到的银行帐号</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> strategy 具体的支付策略</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PaymentContext2</span><span class="params">(String userName,<span class="keyword">double</span> money,String account,PaymentStrategy strategy)</span></span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(userName,money,strategy);</span><br><span class="line">		<span class="keyword">this</span>.account = account;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getAccount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> account;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="状态模式">状态模式</h2>
<h3 id="描述">描述</h3>
<p>定义：允许一个对象在其内部状态改变时改变它的行为。本质是根据状态分离和选择行为。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Context</td>
<td>环境，也称为上下文；定义客户感兴趣的接口，并维护一个具体处理当前状态的实例对象</td>
</tr>
<tr>
<td>State</td>
<td>状态接口，封装与上下文的一个特定状态所对应的行为</td>
</tr>
<tr>
<td>ConcreteState</td>
<td>实现状态处理类，每个类实现一个状态的具体处理</td>
</tr>
</tbody>
</table>
<p>行为的平行性：各个状态的行为所处的层次是一样的，相互独立且没有关联，根据不同的状态决定平行的哪一个行为。行为是不同的，对应的实现也是不同的；因此，相互之间不可替换。</p>
<p>创建和销毁状态对象的方式</p>
<ol>
<li>需要时再创建，用完后则销毁</li>
<li>提前创建并且始终不销毁，如：使用单例</li>
<li>采用延迟加载和缓存合用的方式</li>
</ol>
<p>状态转换控制</p>
<ol>
<li>上下文中处理：规则比较稳定</li>
<li>状态处理类中处理：状态的转换取决于前一个状态处理的结果</li>
</ol>
<p>转移持久化：转移是描述从A状态到B状态的转换变化。持久化则是记录其描述到数据库。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>简化业务逻辑控制</li>
<li>分离状态和行为</li>
<li>更好的扩展性</li>
<li>显式进行状态转换</li>
</ol>
<p>缺点</p>
<ol>
<li>引入太多的状态类</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>一个对象的行为取决于其状态，且其必须在运行时刻根据状态改变其行为</li>
<li>一个操作中含有庞大的多分支语句，且这些分支依赖于该对象的状态</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在线投票</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//上下文转换状态</span></span><br><span class="line"><span class="comment">//示例：实现在线投票</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用状态模式实现投票功能（违背开闭原则）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		VoteManager vm = <span class="keyword">new</span> VoteManager();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">9</span>;i++)&#123;</span><br><span class="line">			vm.vote(<span class="string">"u1"</span>, <span class="string">"A"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//投票管理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 投票管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteManager</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有状态处理对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> VoteState state = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录用户投票的结果,Map&lt;String,String&gt;对应Map&lt;用户名称,投票的选项&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,String&gt; mapVote = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录用户投票次数,Map&lt;String,Integer&gt;对应Map&lt;用户名称,投票的次数&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,Integer&gt; mapVoteCount = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取记录用户投票结果的Map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 记录用户投票结果的Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getMapVote</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mapVote;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 投票</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 投票人，为了简单，就是用户名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteItem 投票的选项</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user,String voteItem)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：先为该用户增加投票的次数</span></span><br><span class="line">		<span class="comment">//先从记录中取出已有的投票次数</span></span><br><span class="line">		Integer oldVoteCount = mapVoteCount.get(user);</span><br><span class="line">		<span class="keyword">if</span>(oldVoteCount==<span class="keyword">null</span>)&#123;</span><br><span class="line">			oldVoteCount = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		oldVoteCount = oldVoteCount + <span class="number">1</span>;</span><br><span class="line">		mapVoteCount.put(user, oldVoteCount);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2：判断该用户投票的类型，就相当于是判断对应的状态</span></span><br><span class="line">		<span class="comment">//到底是正常投票、重复投票、恶意投票还是上黑名单的状态</span></span><br><span class="line">		<span class="keyword">if</span>(oldVoteCount==<span class="number">1</span>)&#123;</span><br><span class="line">			state = <span class="keyword">new</span> NormalVoteState();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldVoteCount&gt;<span class="number">1</span> &amp;&amp; oldVoteCount&lt;<span class="number">5</span>)&#123;</span><br><span class="line">			state = <span class="keyword">new</span> RepeatVoteState();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldVoteCount &gt;= <span class="number">5</span> &amp;&amp; oldVoteCount&lt;<span class="number">8</span>)&#123;</span><br><span class="line">			state = <span class="keyword">new</span> SpiteVoteState();</span><br><span class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(oldVoteCount&gt;=<span class="number">8</span>)&#123;</span><br><span class="line">			state = <span class="keyword">new</span> BlackVoteState();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//然后转调状态对象来进行相应的操作</span></span><br><span class="line">		state.vote(user, voteItem, <span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//状态接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装一个投票状态相关的行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VoteState</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理状态对应的行为</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 投票人</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteItem 投票项</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteManager 投票上下文，用来在实现状态对应的功能处理的时候，</span></span><br><span class="line"><span class="comment">	 *                    可以回调上下文的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user,String voteItem,VoteManager voteManager)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//正常投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//正常投票</span></span><br><span class="line">		<span class="comment">//记录到投票记录中</span></span><br><span class="line">		voteManager.getMapVote().put(user, voteItem);</span><br><span class="line">		System.out.println(<span class="string">"恭喜你投票成功"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重复投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepeatVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//重复投票</span></span><br><span class="line">		<span class="comment">//暂时不做处理</span></span><br><span class="line">		System.out.println(<span class="string">"请不要重复投票"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//恶意投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpiteVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//恶意投票</span></span><br><span class="line">		<span class="comment">//取消用户的投票资格，并取消投票记录</span></span><br><span class="line">		String s = voteManager.getMapVote().get(user);</span><br><span class="line">		<span class="keyword">if</span>(s!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			voteManager.getMapVote().remove(user);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"你有恶意刷票行为，取消投票资格"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//黑名单状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlackVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//黑名单</span></span><br><span class="line">		<span class="comment">//记入黑名单中，禁止登录系统了</span></span><br><span class="line">		System.out.println(<span class="string">"进入黑名单，将禁止登录和使用本系统"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//状态处理类转换状态</span></span><br><span class="line"><span class="comment">//示例：实现在线投票</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		VoteManager vm = <span class="keyword">new</span> VoteManager();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++)&#123;</span><br><span class="line">			vm.vote(<span class="string">"u1"</span>, <span class="string">"A"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//投票管理类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 投票管理</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VoteManager</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录当前每个用户对应的状态处理对象，每个用户当前的状态是不同的</span></span><br><span class="line"><span class="comment">	 * Map&lt;String,VoteState&gt;对应Map&lt;用户名称,当前对应的状态处理对象&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,VoteState&gt; mapState = <span class="keyword">new</span> HashMap&lt;String,VoteState&gt;();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录用户投票的结果,Map&lt;String,String&gt;对应Map&lt;用户名称,投票的选项&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,String&gt; mapVote = <span class="keyword">new</span> HashMap&lt;String,String&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录用户投票次数,Map&lt;String,Integer&gt;对应Map&lt;用户名称,投票的次数&gt;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Map&lt;String,Integer&gt; mapVoteCount = <span class="keyword">new</span> HashMap&lt;String,Integer&gt;();</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取记录用户投票结果的Map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 记录用户投票结果的Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, String&gt; <span class="title">getMapVote</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mapVote;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取记录每个用户对应的状态处理对象的Map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 记录每个用户对应的状态处理对象的Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, VoteState&gt; <span class="title">getMapState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mapState;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取记录每个用户对应的投票次数的Map</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 记录每个用户对应的投票次数的Map</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Map&lt;String, Integer&gt; <span class="title">getMapVoteCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> mapVoteCount;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 投票</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 投票人，为了简单，就是用户名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteItem 投票的选项</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user,String voteItem)</span></span>&#123;</span><br><span class="line">		<span class="comment">//1：先为该用户增加投票的次数</span></span><br><span class="line">		<span class="comment">//先从记录中取出已有的投票次数</span></span><br><span class="line">		Integer oldVoteCount = mapVoteCount.get(user);</span><br><span class="line">		<span class="keyword">if</span>(oldVoteCount==<span class="keyword">null</span>)&#123;</span><br><span class="line">			oldVoteCount = <span class="number">0</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		oldVoteCount = oldVoteCount + <span class="number">1</span>;</span><br><span class="line">		mapVoteCount.put(user, oldVoteCount);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//2：获取该用户的投票状态</span></span><br><span class="line">		VoteState state = mapState.get(user);</span><br><span class="line">		<span class="comment">//如果没有投票状态，说明还没有投过票，就初始化一个正常投票状态</span></span><br><span class="line">		<span class="keyword">if</span>(state==<span class="keyword">null</span>)&#123;</span><br><span class="line">			state = <span class="keyword">new</span> NormalVoteState();</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//然后转调状态对象来进行相应的操作</span></span><br><span class="line">		state.vote(user, voteItem, <span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//状态接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装一个投票状态相关的行为</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">VoteState</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 处理状态对应的行为</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> user 投票人</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteItem 投票项</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> voteManager 投票上下文，用来在实现状态对应的功能处理的时候，</span></span><br><span class="line"><span class="comment">	 *                    可以回调上下文的数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user,String voteItem,VoteManager voteManager)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//正常投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NormalVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//正常投票</span></span><br><span class="line">		<span class="comment">//记录到投票记录中</span></span><br><span class="line">		voteManager.getMapVote().put(user, voteItem);</span><br><span class="line">		System.out.println(<span class="string">"恭喜你投票成功"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//正常投票完成，维护下一个状态，同一个人再投票就重复了</span></span><br><span class="line">		voteManager.getMapState().put(user, <span class="keyword">new</span> RepeatVoteState());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//重复投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RepeatVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//重复投票</span></span><br><span class="line">		<span class="comment">//暂时不做处理</span></span><br><span class="line">		System.out.println(<span class="string">"请不要重复投票"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//重复投票完成，维护下一个状态，重复投票到5次，就算恶意投票了</span></span><br><span class="line">		<span class="comment">//注意这里是判断大于等于4，因为这里设置的是下一个状态</span></span><br><span class="line">		<span class="comment">//下一个操作次数就是5了，就应该算是恶意投票了</span></span><br><span class="line">		<span class="keyword">if</span>(voteManager.getMapVoteCount().get(user) &gt;= <span class="number">4</span>)&#123;</span><br><span class="line">			voteManager.getMapState().put(user, <span class="keyword">new</span> SpiteVoteState());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//恶意投票状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpiteVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//恶意投票</span></span><br><span class="line">		<span class="comment">//取消用户的投票资格，并取消投票记录</span></span><br><span class="line">		String s = voteManager.getMapVote().get(user);</span><br><span class="line">		<span class="keyword">if</span>(s!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			voteManager.getMapVote().remove(user);</span><br><span class="line">		&#125;</span><br><span class="line">		System.out.println(<span class="string">"你有恶意刷票行为，取消投票资格"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//恶意投票完成，维护下一个状态，投票到8次，就进黑名单了</span></span><br><span class="line">		<span class="comment">//注意这里是判断大于等于7，因为这里设置的是下一个状态</span></span><br><span class="line">		<span class="comment">//下一个操作次数就是8了，就应该算是进黑名单了</span></span><br><span class="line">		<span class="keyword">if</span>(voteManager.getMapVoteCount().get(user) &gt;= <span class="number">7</span>)&#123;</span><br><span class="line">			voteManager.getMapState().put(user, <span class="keyword">new</span> BlackVoteState());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//黑名单状态类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BlackVoteState</span> <span class="keyword">implements</span> <span class="title">VoteState</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">vote</span><span class="params">(String user, String voteItem, VoteManager voteManager)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//黑名单</span></span><br><span class="line">		<span class="comment">//记入黑名单中，禁止登录系统了</span></span><br><span class="line">		System.out.println(<span class="string">"进入黑名单，将禁止登录和使用本系统"</span>);</span><br><span class="line">				</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="备忘录模式">备忘录模式</h2>
<h3 id="描述">描述</h3>
<p>定义：在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存。这样以后就可将该对象恢复到原先保存的状态。本质是保存和恢复内部状态。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Memento</td>
<td>备忘录，存储原发器对象的内部状态，但具体存储的数据是由原发器对象决定的。另外，备忘录应该只能由原发器对象访问它内部的数据</td>
</tr>
<tr>
<td>Originator</td>
<td>原发器，使用备忘录保存某个时刻其自身的状态，也可以使用备忘录恢复其内部状态</td>
</tr>
<tr>
<td>Caretaker</td>
<td>备忘录管理者，主责保存备忘录对象，但不能对备忘录对象的内容进行操作或检查</td>
</tr>
</tbody>
</table>
<p>窄接口：管理者只能看到备忘录的窄接口；窄接口没有任务的方法，只是一个类型标识，使得管理者只能将备忘录传递给其它对象。</p>
<p>宽接口：原发器能够看到一个宽接口，允许它访问所需的所有数据，以返回到先前的状态。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>更好的封装性</li>
<li>简化原发器</li>
<li>保证安全性（窄接口和宽接口）</li>
</ol>
<p>缺点</p>
<ol>
<li>可能会导致高的开销（若需缓存备忘录对象）</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>须保存一个对象在某一个时刻的全部或部分状态</li>
<li>需保存一个对象的内部状态并且保证其安全性</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//仿真系统</span></span><br><span class="line"><span class="comment">//示例：实现仿真系统</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用备忘录模式和原型模式实现仿真系统</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 创建模拟运行流程的对象</span></span><br><span class="line">		FlowAMockPrototype mock = <span class="keyword">new</span> FlowAMockPrototype(<span class="string">"TestFlow"</span>); <span class="comment">// //原型模式</span></span><br><span class="line">		<span class="comment">//运行流程的第一个阶段</span></span><br><span class="line">		mock.runPhaseOne();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//创建一个管理者</span></span><br><span class="line">		FlowAMementoFileCareTaker careTaker = <span class="keyword">new</span> FlowAMementoFileCareTaker(); <span class="comment">// 离线存储</span></span><br><span class="line">		<span class="comment">//创建此时对象的备忘录对象，并保存到管理者对象那里，后面要用</span></span><br><span class="line">		FlowAMockMemento memento = mock.createMemento();</span><br><span class="line">		careTaker.saveMemento(memento);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//按照方案一来运行流程后半部分</span></span><br><span class="line">		mock.schema1();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//从管理者获取备忘录对象，然后设置回去，</span></span><br><span class="line">		<span class="comment">//让模拟运行流程的对象自己恢复自己的内部状态</span></span><br><span class="line">		mock.setMemento(careTaker.retriveMemento());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//按照方案二来运行流程后半部分</span></span><br><span class="line">		mock.schema2();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//共同流程分支实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟运行流程A，只是一个示意，代指某个具体流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowAMockPrototype</span> <span class="keyword">implements</span> <span class="title">Cloneable</span>, <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 流程名称，不需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String flowName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，代指某个中间结果，需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tempResult;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，代指某个中间结果，需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String tempState;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入流程名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> flowName 流程名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FlowAMockPrototype</span><span class="params">(String flowName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.flowName = flowName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，运行流程的第一个阶段</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runPhaseOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//在这个阶段，可能产生了中间结果，示意一下</span></span><br><span class="line">		tempResult = <span class="number">3</span>;</span><br><span class="line">		tempState = <span class="string">"PhaseOne"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，按照方案一来运行流程后半部分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schema1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//示意，需要使用第一个阶段产生的数据</span></span><br><span class="line">		<span class="keyword">this</span>.tempState += <span class="string">",Schema1"</span>;</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.tempState + <span class="string">" : now run "</span>+tempResult);</span><br><span class="line">		<span class="keyword">this</span>.tempResult += <span class="number">11</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，按照方案二来运行流程后半部分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schema2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//示意，需要使用第一个阶段产生的数据</span></span><br><span class="line">		<span class="keyword">this</span>.tempState += <span class="string">",Schema2"</span>;</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.tempState + <span class="string">" : now run "</span>+tempResult);</span><br><span class="line">		<span class="keyword">this</span>.tempResult += <span class="number">22</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建保存原发器对象的状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 创建好的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> FlowAMockMemento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> MementoImplPrototype((FlowAMockPrototype) <span class="keyword">this</span>.clone());</span><br><span class="line">		&#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重新设置原发器对象的状态，让其回到备忘录对象记录的状态</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> memento 记录有原发器状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(FlowAMockMemento memento)</span> </span>&#123;</span><br><span class="line">		MementoImplPrototype mementoImpl = (MementoImplPrototype)memento;</span><br><span class="line">		<span class="keyword">this</span>.tempResult = mementoImpl.getFlowAMock().tempResult;</span><br><span class="line">		<span class="keyword">this</span>.tempState = mementoImpl.getFlowAMock().tempState;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 真正的备忘录对象，实现备忘录窄接口</span></span><br><span class="line"><span class="comment">	 * 实现成私有的内部类，不让外部访问</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoImplPrototype</span> <span class="keyword">implements</span> <span class="title">FlowAMockMemento</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span> FlowAMockPrototype flowAMock = <span class="keyword">null</span>;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MementoImplPrototype</span><span class="params">(FlowAMockPrototype f)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.flowAMock = f;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> FlowAMockPrototype <span class="title">getFlowAMock</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> flowAMock;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//备忘录对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 负责在文件中保存模拟运行流程A的对象的备忘录对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowAMementoFileCareTaker</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 保存备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> memento 被保存的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveMemento</span><span class="params">(FlowAMockMemento memento)</span></span>&#123;</span><br><span class="line">		<span class="comment">//写到文件中</span></span><br><span class="line">		ObjectOutputStream out = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			out = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">					<span class="keyword">new</span> BufferedOutputStream(</span><br><span class="line">							<span class="keyword">new</span> FileOutputStream(<span class="string">"FlowAMemento"</span>)</span><br><span class="line">					)</span><br><span class="line">			);</span><br><span class="line">			out.writeObject(memento);</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception err)&#123;</span><br><span class="line">			err.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				out.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取被保存的备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 被保存的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> FlowAMockMemento <span class="title">retriveMemento</span><span class="params">()</span></span>&#123;</span><br><span class="line">		FlowAMockMemento memento = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//从文件中获取备忘录数据</span></span><br><span class="line">		ObjectInputStream in = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">try</span>&#123;</span><br><span class="line">			in = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">					<span class="keyword">new</span> BufferedInputStream(</span><br><span class="line">							<span class="keyword">new</span> FileInputStream(<span class="string">"FlowAMemento"</span>)</span><br><span class="line">					)</span><br><span class="line">			);</span><br><span class="line">			memento = (FlowAMockMemento)in.readObject();</span><br><span class="line">		&#125;<span class="keyword">catch</span>(Exception err)&#123;</span><br><span class="line">			err.printStackTrace();</span><br><span class="line">		&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				in.close();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> memento;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//备忘录接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟运行流程A的对象的备忘录接口，是个窄接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FlowAMockMemento</span> <span class="keyword">extends</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">	<span class="comment">//空的</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//原发器对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 模拟运行流程A，只是一个示意，代指某个具体流程</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlowAMock</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 流程名称，不需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String flowName;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，代指某个中间结果，需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> tempResult;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，代指某个中间结果，需要外部存储的状态数据</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String tempState;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入流程名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> flowName 流程名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FlowAMock</span><span class="params">(String flowName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.flowName = flowName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，运行流程的第一个阶段</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runPhaseOne</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//在这个阶段，可能产生了中间结果，示意一下</span></span><br><span class="line">		tempResult = <span class="number">3</span>;</span><br><span class="line">		tempState = <span class="string">"PhaseOne"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，按照方案一来运行流程后半部分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schema1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//示意，需要使用第一个阶段产生的数据</span></span><br><span class="line">		<span class="keyword">this</span>.tempState += <span class="string">",Schema1"</span>;</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.tempState + <span class="string">" : now run "</span>+tempResult);</span><br><span class="line">		<span class="keyword">this</span>.tempResult += <span class="number">11</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 示意，按照方案二来运行流程后半部分</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">schema2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//示意，需要使用第一个阶段产生的数据</span></span><br><span class="line">		<span class="keyword">this</span>.tempState += <span class="string">",Schema2"</span>;</span><br><span class="line">		System.out.println(<span class="keyword">this</span>.tempState + <span class="string">" : now run "</span>+tempResult);</span><br><span class="line">		<span class="keyword">this</span>.tempResult += <span class="number">22</span>;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建保存原发器对象的状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 创建好的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> FlowAMockMemento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> MementoImpl(<span class="keyword">this</span>.tempResult,<span class="keyword">this</span>.tempState);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重新设置原发器对象的状态，让其回到备忘录对象记录的状态</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> memento 记录有原发器状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(FlowAMockMemento memento)</span> </span>&#123;</span><br><span class="line">		MementoImpl mementoImpl = (MementoImpl)memento;</span><br><span class="line">		<span class="keyword">this</span>.tempResult = mementoImpl.getTempResult();</span><br><span class="line">		<span class="keyword">this</span>.tempState = mementoImpl.getTempState();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 真正的备忘录对象，实现备忘录窄接口</span></span><br><span class="line"><span class="comment">	 * 实现成私有的内部类，不让外部访问</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoImpl</span> <span class="keyword">implements</span> <span class="title">FlowAMockMemento</span></span>&#123;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 示意，保存某个中间结果</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> tempResult;</span><br><span class="line">		<span class="comment">/**</span></span><br><span class="line"><span class="comment">		 * 示意，保存某个中间结果</span></span><br><span class="line"><span class="comment">		 */</span></span><br><span class="line">		<span class="keyword">private</span> String tempState;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MementoImpl</span><span class="params">(<span class="keyword">int</span> tempResult,String tempState)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.tempResult = tempResult;</span><br><span class="line">			<span class="keyword">this</span>.tempState = tempState;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTempResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> tempResult;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> String <span class="title">getTempState</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> tempState;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算器</span></span><br><span class="line"><span class="comment">//示例：命令模式和备忘录模式实现具备撤销和恢复功能的计算器</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用备忘录模式实现计算器的撤销功能（存储恢复式）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//1：组装命令和接收者</span></span><br><span class="line">		<span class="comment">//创建接收者</span></span><br><span class="line">		OperationApi operation = <span class="keyword">new</span> Operation();</span><br><span class="line">		<span class="comment">//创建命令</span></span><br><span class="line">		AddCommand addCmd = <span class="keyword">new</span> AddCommand(<span class="number">5</span>);</span><br><span class="line">		SubstractCommand substractCmd = <span class="keyword">new</span> SubstractCommand(<span class="number">3</span>);</span><br><span class="line">		<span class="comment">//组装命令和接收者</span></span><br><span class="line">		addCmd.setOperation(operation);</span><br><span class="line">		substractCmd.setOperation(operation);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2：把命令设置到持有者，就是计算器里面</span></span><br><span class="line">		Calculator calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">		calculator.setAddCmd(addCmd);</span><br><span class="line">		calculator.setSubstractCmd(substractCmd);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//3:模拟按下按钮，测试一下</span></span><br><span class="line">		calculator.addPressed();</span><br><span class="line">		System.out.println(<span class="string">"一次加法运算后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.substractPressed();</span><br><span class="line">		System.out.println(<span class="string">"一次减法运算后的结果为："</span>+operation.getResult());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试撤消</span></span><br><span class="line">		calculator.undoPressed();</span><br><span class="line">		System.out.println(<span class="string">"撤销一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.undoPressed();</span><br><span class="line">		System.out.println(<span class="string">"再撤销一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//测试恢复</span></span><br><span class="line">		calculator.redoPressed();</span><br><span class="line">		System.out.println(<span class="string">"恢复操作一次后的结果为："</span>+operation.getResult());</span><br><span class="line">		calculator.redoPressed();</span><br><span class="line">		System.out.println(<span class="string">"再恢复操作一次后的结果为："</span>+operation.getResult());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//操作运算接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作运算的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">OperationApi</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 获取计算完成后的结果</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 计算完成后的结果</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行加法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> num 需要加的数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行减法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> num 需要减的数</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> num)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建保存原发器对象的状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 创建好的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重新设置原发器对象的状态，让其回到备忘录对象记录的状态</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> memento 记录有原发器状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(Memento memento)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//操作运算实现类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 运算类，真正实现加减法运算</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Operation</span> <span class="keyword">implements</span> <span class="title">OperationApi</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 记录运算的结果</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> result;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> result;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">		result += num;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substract</span><span class="params">(<span class="keyword">int</span> num)</span></span>&#123;</span><br><span class="line">		result -= num;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		MementoImpl m = <span class="keyword">new</span> MementoImpl(result);</span><br><span class="line">		<span class="keyword">return</span> m;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMemento</span><span class="params">(Memento memento)</span> </span>&#123;</span><br><span class="line">		MementoImpl m = (MementoImpl)memento;</span><br><span class="line">		<span class="keyword">this</span>.result = m.getResult();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MementoImpl</span> <span class="keyword">implements</span> <span class="title">Memento</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">MementoImpl</span><span class="params">(<span class="keyword">int</span> result)</span></span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.result = result;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getResult</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> result;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义一个命令的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Command</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 执行命令</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 撤销命令，恢复到备忘录对象记录的状态</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> m 备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">(Memento m)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重做命令，恢复到备忘录对象记录的状态</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> m 备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redo</span><span class="params">(Memento m)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 创建保存原发器对象的状态的备忘录对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 创建好的备忘录对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//命令抽象类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 命令对象的公共对象，实现各个命令对象的公共方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractCommand</span> <span class="keyword">implements</span> <span class="title">Command</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 具体的功能实现，这里不管</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有真正的命令实现者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> OperationApi operation = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOperation</span><span class="params">(OperationApi operation)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation = operation;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Memento <span class="title">createMemento</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.operation.createMemento();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redo</span><span class="params">(Memento m)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation.setMemento(m);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undo</span><span class="params">(Memento m)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation.setMemento(m);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//加法命令实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddCommand</span> <span class="keyword">extends</span> <span class="title">AbstractCommand</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> opeNum;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">AddCommand</span><span class="params">(<span class="keyword">int</span> opeNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.opeNum = opeNum;</span><br><span class="line">	&#125;	</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation.add(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//减法命令实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SubstractCommand</span> <span class="keyword">extends</span> <span class="title">AbstractCommand</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">int</span> opeNum;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">SubstractCommand</span><span class="params">(<span class="keyword">int</span> opeNum)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.opeNum = opeNum;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.operation.substract(opeNum);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算器类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 计算器类，计算器上有加法按钮、减法按钮，还有撤销和恢复的按钮</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令的操作的历史记录，在撤销时候用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Command&gt; undoCmds = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令被撤销的历史记录，在恢复时候用</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Command&gt; redoCmds = <span class="keyword">new</span> ArrayList&lt;Command&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 命令操作对应的备忘录对象的历史记录，在撤销时候用</span></span><br><span class="line"><span class="comment">	 * 由于对于每个命令对象，撤销和重做的状态是不一样的，</span></span><br><span class="line"><span class="comment">	 * 撤销是回到命令操作前的状态，而重做是回到命令操作后的状态，</span></span><br><span class="line"><span class="comment">	 * 因此对每一个命令，使用一个备忘录对象的数组来记录对应的状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Memento[]&gt; undoMementos = <span class="keyword">new</span> ArrayList&lt;Memento[]&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 被撤销命令对应的备忘录对象的历史记录，在恢复时候用,</span></span><br><span class="line"><span class="comment">	 * 数组有两个元素，第一个是命令执行前的状态，第二个是命令执行后的状态</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Memento[]&gt; redoMementos = <span class="keyword">new</span> ArrayList&lt;Memento[]&gt;();</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Command addCmd = <span class="keyword">null</span>;</span><br><span class="line">	<span class="keyword">private</span> Command substractCmd = <span class="keyword">null</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddCmd</span><span class="params">(Command addCmd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.addCmd = addCmd;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSubstractCmd</span><span class="params">(Command substractCmd)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.substractCmd = substractCmd;</span><br><span class="line">	&#125;	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//获取对应的备忘录对象，并保存在相应的历史记录里面</span></span><br><span class="line">		Memento m1 = <span class="keyword">this</span>.addCmd.createMemento();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行命令</span></span><br><span class="line">		<span class="keyword">this</span>.addCmd.execute();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//把操作记录到历史记录里面</span></span><br><span class="line">		undoCmds.add(<span class="keyword">this</span>.addCmd);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取执行命令后的备忘录对象</span></span><br><span class="line">		Memento m2 = <span class="keyword">this</span>.addCmd.createMemento();</span><br><span class="line">		<span class="comment">//设置到撤销的历史记录里面</span></span><br><span class="line">		<span class="keyword">this</span>.undoMementos.add(<span class="keyword">new</span> Memento[]&#123;m1,m2&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">substractPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//获取对应的备忘录对象，并保存在相应的历史记录里面		</span></span><br><span class="line">		Memento m1 = <span class="keyword">this</span>.substractCmd.createMemento();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//执行命令</span></span><br><span class="line">		<span class="keyword">this</span>.substractCmd.execute();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//把操作记录到历史记录里面</span></span><br><span class="line">		undoCmds.add(<span class="keyword">this</span>.substractCmd);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//获取执行命令后的备忘录对象</span></span><br><span class="line">		Memento m2 = <span class="keyword">this</span>.substractCmd.createMemento();</span><br><span class="line">		<span class="comment">//设置到撤销的历史记录里面</span></span><br><span class="line">		<span class="keyword">this</span>.undoMementos.add(<span class="keyword">new</span> Memento[]&#123;m1,m2&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">undoPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(undoCmds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//取出最后一个命令来撤销</span></span><br><span class="line">			Command cmd = undoCmds.get(undoCmds.size()-<span class="number">1</span>);</span><br><span class="line">			<span class="comment">//获取对应的备忘录对象</span></span><br><span class="line">			Memento[] ms = undoMementos.get(undoCmds.size()-<span class="number">1</span>);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//撤销</span></span><br><span class="line">			cmd.undo(ms[<span class="number">0</span>]);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//如果还有恢复的功能，那就把这个命令记录到恢复的历史记录里面</span></span><br><span class="line">			redoCmds.add(cmd);</span><br><span class="line">			<span class="comment">//把相应的备忘录对象也添加过去</span></span><br><span class="line">			redoMementos.add(ms);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//然后把最后一个命令删除掉，</span></span><br><span class="line">			undoCmds.remove(cmd);</span><br><span class="line">			<span class="comment">//把相应的备忘录对象也删除掉</span></span><br><span class="line">			undoMementos.remove(ms);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"很抱歉，没有可撤销的命令"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">redoPressed</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(redoCmds.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//取出最后一个命令来重做</span></span><br><span class="line">			Command cmd = redoCmds.get(redoCmds.size()-<span class="number">1</span>);</span><br><span class="line">			<span class="comment">//获取对应的备忘录对象</span></span><br><span class="line">			Memento[] ms = redoMementos.get(redoCmds.size()-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">			<span class="comment">//重做</span></span><br><span class="line">			cmd.redo(ms[<span class="number">1</span>]);</span><br><span class="line">			</span><br><span class="line">			<span class="comment">//把这个命令记录到可撤销的历史记录里面</span></span><br><span class="line">			undoCmds.add(cmd);</span><br><span class="line">			<span class="comment">//把相应的备忘录对象也添加过去</span></span><br><span class="line">			undoMementos.add(ms);</span><br><span class="line">			<span class="comment">//然后把最后一个命令删除掉</span></span><br><span class="line">			redoCmds.remove(cmd);</span><br><span class="line">			<span class="comment">//把相应的备忘录对象也删除掉</span></span><br><span class="line">			redoMementos.remove(ms);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"很抱歉，没有可恢复的命令"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//备忘录接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Memento</span> </span>&#123;</span><br><span class="line">	<span class="comment">//空的</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="解释器模式">解释器模式</h2>
<h3 id="描述">描述</h3>
<p>定义：给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示解释语言中的句子。本质是分离实现，解释执行。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>AbstractExpression</td>
<td>解释器接口，约定解释器的解释操作</td>
</tr>
<tr>
<td>TerminalExpression</td>
<td>终结符解释器，实现语法规则中和终结符相关的操作</td>
</tr>
<tr>
<td>NonterminalExpression</td>
<td>非终结符解释器</td>
</tr>
<tr>
<td>Context</td>
<td>上下文，包含各个解释器需要的数据或是公共功能</td>
</tr>
<tr>
<td>Client</td>
<td>客户端</td>
</tr>
</tbody>
</table>
<p>解析器：将表达式解析转换为解释器需要的抽象语法树。</p>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>易于实现语法</li>
<li>易于扩展语法</li>
</ol>
<p>缺点</p>
<ol>
<li>不适合复杂的语法</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>有语言需要解释执行</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：模拟XPath解析XML（解析器+解释器）</span></span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 解释器模式实现用表达式取xml元素值（增加了解析器）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="comment">//准备上下文</span></span><br><span class="line">		Context c = <span class="keyword">new</span> Context(<span class="string">"InterpreterTest.xml"</span>);</span><br><span class="line">		<span class="comment">//通过解析器获取抽象语法树</span></span><br><span class="line">		ReadXmlExpression re = Parser.parse(<span class="string">"root/a/b/d$.id$"</span>);</span><br><span class="line">		<span class="comment">//请求解析，获取返回值</span></span><br><span class="line">		String ss[] = re.interpret(c);</span><br><span class="line">		<span class="keyword">for</span> (String s : ss) &#123;</span><br><span class="line">			System.out.println(<span class="string">"d的属性id值是="</span> + s);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//如果要使用同一个上下文，连续进行解析，需要重新初始化上下文对象</span></span><br><span class="line">		c.reInit();</span><br><span class="line">		ReadXmlExpression re2 = Parser.parse(<span class="string">"root/a/b/d$"</span>);</span><br><span class="line">		<span class="comment">//请求解析，获取返回值</span></span><br><span class="line">		String ss2[] = re2.interpret(c);</span><br><span class="line">		<span class="keyword">for</span> (String s : ss2) &#123;</span><br><span class="line">			System.out.println(<span class="string">"d的值是="</span> + s);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//上下文</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *	上下文，用来包含解释器需要的一些全局信息</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Dom解析Xml的Document对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Document document = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 上一次被处理的多个元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Element&gt; preEles = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> filePathName 需要读取的xml的路径和名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Context</span><span class="params">(String filePathName)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		<span class="comment">//通过辅助的Xml工具类来获取被解析的xml对应的Document对象</span></span><br><span class="line">		<span class="keyword">this</span>.document = XmlUtil.getRoot(filePathName);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 重新初始化上下文</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">		preEles = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 各个Expression公共使用的方法,</span></span><br><span class="line"><span class="comment">	 * 根据父元素和当前元素的名称来获取当前的多个元素的集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> pEle 父元素 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> eleName 当前元素的名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 当前的多个元素的集合</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Element&gt; <span class="title">getNowEles</span><span class="params">(Element pEle,String eleName)</span></span>&#123;</span><br><span class="line">		List&lt;Element&gt; elements = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">		NodeList tempNodeList = pEle.getChildNodes();</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;tempNodeList.getLength();i++)&#123;</span><br><span class="line">			<span class="keyword">if</span>(tempNodeList.item(i) <span class="keyword">instanceof</span> Element)&#123;</span><br><span class="line">				Element nowEle = (Element)tempNodeList.item(i);</span><br><span class="line">				<span class="keyword">if</span>(nowEle.getTagName().equals(eleName))&#123;</span><br><span class="line">					elements.add(nowEle);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> elements;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Document <span class="title">getDocument</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> document;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Element&gt; <span class="title">getPreEles</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> preEles;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPreEles</span><span class="params">(List&lt;Element&gt; nowEles)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.preEles = nowEles;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解析器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据语法来解析表达式，转换成为相应的抽象语法树</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Parser</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 私有化构造器，避免外部无谓的创建对象实例</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="title">Parser</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//定义几个常量，内部使用</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String BACKLASH = <span class="string">"/"</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String DOT = <span class="string">"."</span>;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> String DOLLAR = <span class="string">"$"</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按照分解的先后记录需要解析的元素的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; listEle = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 传入一个字符串表达式，通过解析，组合成为一个抽象的语法树</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> expr 描述要取值的字符串表达式</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 对应的抽象语法树</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ReadXmlExpression <span class="title">parse</span><span class="params">(String expr)</span></span>&#123;</span><br><span class="line">		<span class="comment">//先初始化记录需解析的元素的名称的集会</span></span><br><span class="line">		listEle = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//第一步：分解表达式，得到需要解析的元素名称和该元素对应的解析模型</span></span><br><span class="line">		Map&lt;String,ParserModel&gt; mapPath = parseMapPath(expr);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//第二步：根据节点的属性转换成为相应的解释器对象</span></span><br><span class="line">		List&lt;ReadXmlExpression&gt; list = mapPath2Interpreter(mapPath);</span><br><span class="line"></span><br><span class="line">		<span class="comment">//第三步：组合抽象语法树，一定要按照先后顺序来组合，</span></span><br><span class="line">		<span class="comment">//否则对象的包含关系就乱了</span></span><br><span class="line">		ReadXmlExpression returnRe = buildTree(list);</span><br><span class="line">	</span><br><span class="line">		<span class="keyword">return</span> returnRe;			</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment">/*----------------------开始实现第一步-----------------------*/</span>			</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按照从左到右顺序来分解表达式，得到需要解析的元素名称，</span></span><br><span class="line"><span class="comment">	 * 还有该元素对应的解析模型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> expr 需要分解的表达式</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 得到需要解析的元素名称，还有该元素对应的解析模型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String,ParserModel&gt; <span class="title">parseMapPath</span><span class="params">(String expr)</span></span>&#123;</span><br><span class="line">		<span class="comment">//先按照/分割字符串</span></span><br><span class="line">		StringTokenizer tokenizer = <span class="keyword">new</span> StringTokenizer(expr, BACKLASH);</span><br><span class="line">		<span class="comment">//初始化一个map用来存放分解出来的值</span></span><br><span class="line">		Map&lt;String,ParserModel&gt; mapPath = <span class="keyword">new</span> HashMap&lt;String,ParserModel&gt;();</span><br><span class="line">		<span class="keyword">while</span> (tokenizer.hasMoreTokens()) &#123;</span><br><span class="line">			String onePath = tokenizer.nextToken();</span><br><span class="line">			<span class="keyword">if</span> (tokenizer.hasMoreTokens()) &#123;</span><br><span class="line">				<span class="comment">//还有下一个值，说明这不是最后一个元素</span></span><br><span class="line">				<span class="comment">//按照现在的语法，属性必然在最后，因此也不是属性</span></span><br><span class="line">				setParsePath(<span class="keyword">false</span>,onePath,<span class="keyword">false</span>,mapPath);</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="comment">//说明到最后了</span></span><br><span class="line">				<span class="keyword">int</span> dotIndex = onePath.indexOf(DOT);</span><br><span class="line">				<span class="keyword">if</span> (dotIndex &gt; <span class="number">0</span>) &#123;</span><br><span class="line">					<span class="comment">//说明是要获取属性的值，那就按照"."来分割，前面的就是元素名字，后面的是属性的名字</span></span><br><span class="line">					String eleName = onePath.substring(<span class="number">0</span>, dotIndex);</span><br><span class="line">					String propName = onePath.substring(dotIndex + <span class="number">1</span>);</span><br><span class="line">					<span class="comment">//设置属性前面的那个元素，自然不是最后一个，也不是属性</span></span><br><span class="line">					setParsePath(<span class="keyword">false</span>,eleName,<span class="keyword">false</span>,mapPath);</span><br><span class="line">					<span class="comment">//设置属性，按照现在的语法定义，属性只能是最后一个</span></span><br><span class="line">					setParsePath(<span class="keyword">true</span>,propName,<span class="keyword">true</span>,mapPath);</span><br><span class="line">				&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">					<span class="comment">//说明是取元素的值，而且是最后一个元素的值</span></span><br><span class="line">					setParsePath(<span class="keyword">true</span>,onePath,<span class="keyword">false</span>,mapPath);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">break</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> mapPath;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 按照分解出来的位置和名称来设置需要解析的元素名称，</span></span><br><span class="line"><span class="comment">	 * 还有该元素对应的解析模型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> end 是否是最后一个</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> ele 元素名称</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> propertyValue 是否是取属性</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mapPath 设置需要解析的元素名称，还有该元素对应的解析模型的Map对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setParsePath</span><span class="params">(<span class="keyword">boolean</span> end,String ele,<span class="keyword">boolean</span> propertyValue,Map&lt;String,ParserModel&gt; mapPath)</span></span>&#123;</span><br><span class="line">		ParserModel pm = <span class="keyword">new</span> ParserModel();</span><br><span class="line">		pm.setEnd(end);</span><br><span class="line">		<span class="comment">//如果带有$符号就说明不是一个值</span></span><br><span class="line">		pm.setSingleVlaue(!(ele.indexOf(DOLLAR)&gt;<span class="number">0</span>));</span><br><span class="line">		pm.setPropertyValue(propertyValue);				</span><br><span class="line">		<span class="comment">//去掉$</span></span><br><span class="line">		ele = ele.replace(DOLLAR, <span class="string">""</span>);</span><br><span class="line">		mapPath.put(ele,pm);</span><br><span class="line">		listEle.add(ele);</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*----------------------第一步实现结束-----------------------*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*----------------------开始实现第二步-----------------------*/</span>	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 把分解出来的元素名称，根据对应的解析模型转换成为相应的解释器对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> mapPath 分解出来的需要解析的元素名称，还有该元素对应的解析模型</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 把每个元素转换成为相应的解释器对象后的集合</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;ReadXmlExpression&gt; <span class="title">mapPath2Interpreter</span><span class="params">(Map&lt;String,ParserModel&gt; mapPath)</span></span>&#123;</span><br><span class="line">		List&lt;ReadXmlExpression&gt; list = <span class="keyword">new</span> ArrayList&lt;ReadXmlExpression&gt;();</span><br><span class="line">		<span class="comment">//一定要按照分解的先后顺序来转换成解释器对象</span></span><br><span class="line">		<span class="keyword">for</span>(String key : listEle)&#123;</span><br><span class="line">			ParserModel pm = mapPath.get(key);</span><br><span class="line">			ReadXmlExpression obj = <span class="keyword">null</span>;</span><br><span class="line">			<span class="keyword">if</span>(!pm.isEnd())&#123;</span><br><span class="line">				<span class="keyword">if</span>(pm.isSingleVlaue())&#123;</span><br><span class="line">					<span class="comment">//不是最后一个，是一个值，转化为</span></span><br><span class="line">					obj = <span class="keyword">new</span> ElementExpression(key);					</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="comment">//不是最后一个，是多个值，转化为</span></span><br><span class="line">					obj = <span class="keyword">new</span> ElementsExpression(key);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="keyword">if</span>(pm.isPropertyValue())&#123;</span><br><span class="line">					<span class="keyword">if</span>(pm.isSingleVlaue())&#123;</span><br><span class="line">						<span class="comment">//是最后一个，是一个值，取属性的值，转化为</span></span><br><span class="line">						obj = <span class="keyword">new</span> PropertyTerminalExpression(key);</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">//是最后一个，是多个值，取属性的值，转化为</span></span><br><span class="line">						obj = <span class="keyword">new</span> PropertysTerminalExpression(key);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">					<span class="keyword">if</span>(pm.isSingleVlaue())&#123;</span><br><span class="line">						<span class="comment">//是最后一个，是一个值，取元素的值，转化为</span></span><br><span class="line">						obj = <span class="keyword">new</span> ElementTerminalExpression(key);</span><br><span class="line">					&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">						<span class="comment">//是最后一个，是多个值，取元素的值，转化为</span></span><br><span class="line">						obj = <span class="keyword">new</span> ElementsTerminalExpression(key);</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//把转换后的对象添加到集合中</span></span><br><span class="line">			list.add(obj);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> list;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*----------------------第二步实现结束-----------------------*/</span>	</span><br><span class="line">	</span><br><span class="line"><span class="comment">/*----------------------开始实现第三步-----------------------*/</span>		</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> ReadXmlExpression <span class="title">buildTree</span><span class="params">(List&lt;ReadXmlExpression&gt; list)</span></span>&#123;</span><br><span class="line">		<span class="comment">//第一个对象，也是返回去的对象，就是抽象语法树的根</span></span><br><span class="line">		ReadXmlExpression returnRe = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//定义上一个对象</span></span><br><span class="line">		ReadXmlExpression preRe = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">for</span>(ReadXmlExpression re : list)&#123;			</span><br><span class="line">			<span class="keyword">if</span>(preRe==<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="comment">//说明是第一个元素</span></span><br><span class="line">				preRe = re;</span><br><span class="line">				returnRe = re;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//把元素添加到上一个对象下面，同时把本对象设置成为oldRe，作为下一个对象的父结点</span></span><br><span class="line">				<span class="keyword">if</span>(preRe <span class="keyword">instanceof</span> ElementExpression)&#123;</span><br><span class="line">					ElementExpression ele = (ElementExpression)preRe;</span><br><span class="line">					ele.addEle(re);</span><br><span class="line">					preRe = re;</span><br><span class="line">				&#125;<span class="keyword">else</span> <span class="keyword">if</span>(preRe <span class="keyword">instanceof</span> ElementsExpression)&#123;</span><br><span class="line">					ElementsExpression eles = (ElementsExpression)preRe;</span><br><span class="line">					eles.addEle(re);</span><br><span class="line">					preRe = re;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> returnRe;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="comment">/*----------------------第三步实现结束-----------------------*/</span>		</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解释器接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于处理自定义Xml取值表达式的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadXmlExpression</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解释表达式</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> c 上下文</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 解析过后的值，为了通用，可能是单个值，也可能是多个值，</span></span><br><span class="line"><span class="comment">	 *         因此就返回一个数组</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">abstract</span> String[] interpret(Context c);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//单元素解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 单个元素作为非终结符的解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementExpression</span> <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录组合的ReadXmlExpression元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Collection&lt;ReadXmlExpression&gt; eles = <span class="keyword">new</span> ArrayList&lt;ReadXmlExpression&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 元素的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String eleName = <span class="string">""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ElementExpression</span><span class="params">(String eleName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eleName = eleName;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addEle</span><span class="params">(ReadXmlExpression ele)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eles.add(ele);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeEle</span><span class="params">(ReadXmlExpression ele)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eles.remove(ele);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//先取出上下文里的父级元素</span></span><br><span class="line">		List&lt;Element&gt; pEles = c.getPreEles();</span><br><span class="line">		Element ele = <span class="keyword">null</span>;</span><br><span class="line">		<span class="comment">//把当前获取的元素放到上下文里面</span></span><br><span class="line">		List&lt;Element&gt; nowEles = <span class="keyword">new</span> ArrayList&lt;Element&gt;();		</span><br><span class="line">		<span class="keyword">if</span>(pEles.size()==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//说明现在获取的是根元素</span></span><br><span class="line">			ele = c.getDocument().getDocumentElement();</span><br><span class="line">			pEles.add(ele);</span><br><span class="line">			c.setPreEles(pEles);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">for</span>(Element tempEle : pEles)&#123;</span><br><span class="line">				nowEles.addAll(c.getNowEles(tempEle, eleName));</span><br><span class="line">				<span class="keyword">if</span>(nowEles.size()&gt;<span class="number">0</span>)&#123;</span><br><span class="line">					<span class="comment">//找到一个就停止</span></span><br><span class="line">					<span class="keyword">break</span>;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			List&lt;Element&gt; tempList = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">			tempList.add(nowEles.get(<span class="number">0</span>));</span><br><span class="line">			c.setPreEles(tempList);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//循环调用子元素的interpret方法</span></span><br><span class="line">		String [] ss = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">for</span>(ReadXmlExpression tempEle : eles)&#123;</span><br><span class="line">			ss = tempEle.interpret(c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多元素解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多个元素做为非终结符的解释处理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementsExpression</span> <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来记录组合的ReadXmlExpression元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Collection&lt;ReadXmlExpression&gt; eles = <span class="keyword">new</span> ArrayList&lt;ReadXmlExpression&gt;();</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 元素名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String eleName = <span class="string">""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ElementsExpression</span><span class="params">(String eleName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eleName = eleName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//先取出上下文里的父级元素</span></span><br><span class="line">		List&lt;Element&gt; pEles = c.getPreEles();</span><br><span class="line">		<span class="comment">//把当前获取的元素放到上下文里面，这次是获取多个元素</span></span><br><span class="line">		List&lt;Element&gt; nowEles = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(Element ele : pEles)&#123;</span><br><span class="line">			nowEles.addAll(c.getNowEles(ele, eleName));</span><br><span class="line">		&#125;</span><br><span class="line">		c.setPreEles(nowEles);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//循环调用子元素的interpret方法</span></span><br><span class="line">		String [] ss = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">for</span>(ReadXmlExpression ele : eles)&#123;</span><br><span class="line">			ss = ele.interpret(c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addEle</span><span class="params">(ReadXmlExpression ele)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eles.add(ele);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeEle</span><span class="params">(ReadXmlExpression ele)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eles.remove(ele);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//单元素终结符解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 元素作为终结符对应的解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementTerminalExpression</span>  <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 元素的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String eleName = <span class="string">""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ElementTerminalExpression</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eleName = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//先取出上下文里的当前元素作为父级元素</span></span><br><span class="line">		List&lt;Element&gt; pEles = c.getPreEles();</span><br><span class="line">		<span class="comment">//查找到当前元素名称所对应的xml元素</span></span><br><span class="line">		Element ele = <span class="keyword">null</span>;</span><br><span class="line">		<span class="keyword">if</span>(pEles.size() == <span class="number">0</span>)&#123;</span><br><span class="line">			<span class="comment">//说明现在获取的是根元素</span></span><br><span class="line">			ele = c.getDocument().getDocumentElement();</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//获取当前的元素</span></span><br><span class="line">			ele = c.getNowEles(pEles.get(<span class="number">0</span>), eleName).get(<span class="number">0</span>);</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//然后需要去获取这个元素的值</span></span><br><span class="line">		String[] ss = <span class="keyword">new</span> String[<span class="number">1</span>];</span><br><span class="line">		ss[<span class="number">0</span>] = ele.getFirstChild().getNodeValue();</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多元素终结符解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以多个元素作为终结符的解释处理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ElementsTerminalExpression</span>  <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 元素的名称</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String eleName = <span class="string">""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">ElementsTerminalExpression</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.eleName = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//先取出上下文里的父级元素</span></span><br><span class="line">		List&lt;Element&gt; pEles = c.getPreEles();</span><br><span class="line">		<span class="comment">//获取当前的多个元素</span></span><br><span class="line">		List&lt;Element&gt; nowEles = <span class="keyword">new</span> ArrayList&lt;Element&gt;();</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">for</span>(Element ele : pEles)&#123;</span><br><span class="line">			nowEles.addAll(c.getNowEles(ele, eleName));</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">//然后需要去获取这些元素的值</span></span><br><span class="line">		String[] ss = <span class="keyword">new</span> String[nowEles.size()];</span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ss.length;i++)&#123;</span><br><span class="line">			ss[i] = nowEles.get(i).getFirstChild().getNodeValue();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//单属性终结符解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 属性作为终结符对应的解释器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertyTerminalExpression</span> <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 属性的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String propName;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PropertyTerminalExpression</span><span class="params">(String propName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propName = propName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//直接获取最后的元素的属性的值</span></span><br><span class="line">		String[] ss = <span class="keyword">new</span> String[<span class="number">1</span>];</span><br><span class="line">		ss[<span class="number">0</span>] = c.getPreEles().get(<span class="number">0</span>).getAttribute(<span class="keyword">this</span>.propName);</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//多属性终结符解释器</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以多个元素的属性做为终结符的解释处理对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PropertysTerminalExpression</span> <span class="keyword">extends</span> <span class="title">ReadXmlExpression</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 属性名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String propName;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PropertysTerminalExpression</span><span class="params">(String propName)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propName = propName;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">public</span> String[] interpret(Context c) &#123;</span><br><span class="line">		<span class="comment">//获取最后的多个元素</span></span><br><span class="line">		List&lt;Element&gt; eles = c.getPreEles();</span><br><span class="line">		</span><br><span class="line">		String[] ss = <span class="keyword">new</span> String[eles.size()];</span><br><span class="line">		<span class="comment">//循环多个元素，获取每个的属性的值</span></span><br><span class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;ss.length;i++)&#123;</span><br><span class="line">			ss[i] = eles.get(i).getAttribute(<span class="keyword">this</span>.propName);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> ss;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//解析模型类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用来封装每一个解析出来的元素对应的属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ParserModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否单个值</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> singleVlaue;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否属性，不是属性就是元素</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> propertyValue;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 是否终结符</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> end;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> end;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">(<span class="keyword">boolean</span> end)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.end = end;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleVlaue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> singleVlaue;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSingleVlaue</span><span class="params">(<span class="keyword">boolean</span> oneVlaue)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.singleVlaue = oneVlaue;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isPropertyValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> propertyValue;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPropertyValue</span><span class="params">(<span class="keyword">boolean</span> propertyValue)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.propertyValue = propertyValue;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//操作XML工具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlUtil</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Document <span class="title">getRoot</span><span class="params">(String filePathName)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">		Document doc = <span class="keyword">null</span>;</span><br><span class="line">	      <span class="comment">//建立一个解析器工厂</span></span><br><span class="line">	      DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span><br><span class="line">	      <span class="comment">//获得一个DocumentBuilder对象，这个对象代表了具体的DOM解析器</span></span><br><span class="line">	      DocumentBuilder builder=factory.newDocumentBuilder();</span><br><span class="line">	      <span class="comment">//得到一个表示XML文档的Document对象</span></span><br><span class="line">	      doc=builder.parse(filePathName);</span><br><span class="line">	      <span class="comment">//去掉XML文档中作为格式化内容的空白而映射在DOM树中的不必要的Text Node对象</span></span><br><span class="line">	      doc.normalize();</span><br><span class="line">	      <span class="keyword">return</span> doc;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">InterpreterTest.xml</span><br><span class="line">&lt;?xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span>?&gt;</span><br><span class="line">&lt;root id=<span class="string">"rootId"</span>&gt;</span><br><span class="line">	&lt;a&gt;</span><br><span class="line">		&lt;b&gt;</span><br><span class="line">			&lt;c name="testC"&gt;12345&lt;/c&gt;</span><br><span class="line">			&lt;d id="1"&gt;d1&lt;/d&gt;</span><br><span class="line">			&lt;d id="2"&gt;d2&lt;/d&gt;</span><br><span class="line">			&lt;d id="3"&gt;d3&lt;/d&gt;</span><br><span class="line">			&lt;d id="41"&gt;d4&lt;/d&gt;</span><br><span class="line">		&lt;/b&gt;</span><br><span class="line">		&lt;e&gt;</span><br><span class="line">			&lt;d id="42"&gt;d5&lt;/d&gt;</span><br><span class="line">			&lt;d id="43"&gt;d6&lt;/d&gt;</span><br><span class="line">		&lt;/e&gt;</span><br><span class="line">	&lt;/a&gt;</span><br><span class="line">&lt;/root&gt;</span><br></pre></td></tr></table></figure>
<h2 id="责任链模式">责任链模式</h2>
<h3 id="描述">描述</h3>
<p>定义：使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着其传递该请求，直到有一个对象处理它为止。本质是分离职责，动态组合。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Handler</td>
<td>职责接口，定义处理请求的方法</td>
</tr>
<tr>
<td>ConcreteHandler</td>
<td>职责实现</td>
</tr>
<tr>
<td>Client</td>
<td>客户端</td>
</tr>
</tbody>
</table>
<p>链的构建</p>
<ol>
<li>客户端实现，在提交请求前组合链，即是在使用时动态组合链，称为外部链</li>
<li>Handler实现链的组合，称为内部链</li>
<li>由各个职责对象自行决定后续的处理对象，其方式要求每个职责对象除了进行业务处理外，还必须了解整个业务流程</li>
</ol>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>请求者和接收者松散耦合</li>
<li>动态组合职责</li>
</ol>
<p>缺点</p>
<ol>
<li>产生很多细粒度对象</li>
<li>不一定能被处理</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>若有多个对象可以处理同一个请求，但具体由哪个对象处理该请求，是运行时决定的</li>
<li>动态指定处理一个请求的对象集合</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：申请聚餐费用</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 使用责任链设计模式实现聚餐和差旅费用申请流程（改进版）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> liaocan</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先要组装职责链		</span></span><br><span class="line">		Handler h1 = <span class="keyword">new</span> GeneralManager2();</span><br><span class="line">		Handler h2 = <span class="keyword">new</span> DepManager2();</span><br><span class="line">		Handler h3 = <span class="keyword">new</span> ProjectManager2();</span><br><span class="line">		h3.setSuccessor(h2);</span><br><span class="line">		h2.setSuccessor(h1);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//开始测试申请聚餐费用</span></span><br><span class="line">		FeeRequestModel frm = <span class="keyword">new</span> FeeRequestModel();</span><br><span class="line">		frm.setFee(<span class="number">300</span>);</span><br><span class="line">		frm.setUser(<span class="string">"小李"</span>);</span><br><span class="line">		<span class="comment">//调用处理</span></span><br><span class="line">		String ret1 = (String)h3.handleRequest(frm);</span><br><span class="line">		System.out.println(<span class="string">"ret1="</span>+ret1);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//重新设置申请金额，再调用处理</span></span><br><span class="line">		frm.setFee(<span class="number">800</span>);		</span><br><span class="line">		h3.handleRequest(frm);</span><br><span class="line">		String ret2 = (String)h3.handleRequest(frm);</span><br><span class="line">		System.out.println(<span class="string">"ret2="</span>+ret2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//重新设置申请金额，再调用处理</span></span><br><span class="line">		frm.setFee(<span class="number">1600</span>);		</span><br><span class="line">		h3.handleRequest(frm);</span><br><span class="line">		String ret3 = (String)h3.handleRequest(frm);</span><br><span class="line">		System.out.println(<span class="string">"ret3="</span>+ret3);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//开始测试申请预支差旅费用</span></span><br><span class="line">		PreFeeRequestModel pfrm = <span class="keyword">new</span> PreFeeRequestModel();</span><br><span class="line">		pfrm.setFee(<span class="number">3000</span>);</span><br><span class="line">		pfrm.setUser(<span class="string">"小张"</span>);</span><br><span class="line">		<span class="comment">//调用处理</span></span><br><span class="line">		h3.handleRequest(pfrm);</span><br><span class="line">		<span class="comment">//重新设置申请金额，再调用处理</span></span><br><span class="line">		pfrm.setFee(<span class="number">6000</span>);</span><br><span class="line">		h3.handleRequest(pfrm);</span><br><span class="line">		<span class="comment">//重新设置申请金额，再调用处理</span></span><br><span class="line">		pfrm.setFee(<span class="number">36000</span>);</span><br><span class="line">		h3.handleRequest(pfrm);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//职责接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义职责对象的接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 持有下一个处理请求的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">protected</span> Handler successor = <span class="keyword">null</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 设置下一个处理请求的对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> successor 下一个处理请求的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuccessor</span><span class="params">(Handler successor)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.successor = successor;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通用的请求处理方法</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> rm 通用的请求对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 处理后需要返回的对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(successor != <span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//这个是默认的实现，如果子类不愿意处理这个请求，那就传递到下一个职责对象去处理</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">this</span>.successor.handleRequest(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			System.out.println(<span class="string">"没有后续处理或者暂时不支持这样的功能处理"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//项目经理处理聚餐费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现项目经理处理聚餐费用申请的对象 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProjectManager</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(FeeRequestModel.FEE_TYPE.equals(rm.getType()))&#123;</span><br><span class="line">			<span class="comment">//表示聚餐费用申请</span></span><br><span class="line">			<span class="keyword">return</span> handleFeeRequest(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//其他的项目经理暂时不想处理</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(rm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">handleFeeRequest</span><span class="params">(RequestModel rm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		FeeRequestModel frm = (FeeRequestModel)rm;</span><br><span class="line">		String str = <span class="string">""</span>;</span><br><span class="line">		<span class="comment">//项目经理的权限比较小，只能在500以内</span></span><br><span class="line">		<span class="keyword">if</span>(frm.getFee() &lt; <span class="number">500</span>)&#123;</span><br><span class="line">			<span class="comment">//为了测试，简单点，只同意小李的</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"小李"</span>.equals(frm.getUser()))&#123;</span><br><span class="line">				str = <span class="string">"项目经理同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//其他人一律不同意</span></span><br><span class="line">				str = <span class="string">"项目经理不同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> str;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//超过500，继续传递给级别更高的人处理</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> successor.handleRequest(rm);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> str;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//项目经理处理预支差旅费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现为项目经理增加预支差旅费用申请处理的功能的子对象，</span></span><br><span class="line"><span class="comment"> * 现在的项目经理既可以处理聚餐费用申请，又可以处理预支差旅费用申请</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProjectManager2</span> <span class="keyword">extends</span> <span class="title">ProjectManager</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(PreFeeRequestModel.FEE_TYPE.equals(rm.getType()))&#123;</span><br><span class="line">			<span class="comment">//表示预支差旅费用申请</span></span><br><span class="line">			<span class="keyword">return</span> myHandler(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//其他的让父类去处理</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(rm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">myHandler</span><span class="params">(RequestModel rm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		PreFeeRequestModel frm = (PreFeeRequestModel)rm;</span><br><span class="line">		<span class="comment">//项目经理的权限比较小，只能在5000以内</span></span><br><span class="line">		<span class="keyword">if</span>(frm.getFee() &lt; <span class="number">5000</span>)&#123;</span><br><span class="line">			<span class="comment">//工作需要嘛，统统同意</span></span><br><span class="line">			System.out.println(<span class="string">"项目经理同意"</span>+frm.getUser()+<span class="string">"预支差旅费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//超过5000，继续传递给级别更高的人处理</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>.successor.handleRequest(rm);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//部门经理处理聚餐费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现部门经理处理聚餐费用申请的对象 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepManager</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;		</span><br><span class="line">		<span class="keyword">if</span>(FeeRequestModel.FEE_TYPE.equals(rm.getType()))&#123;</span><br><span class="line">			<span class="keyword">return</span> handleFeeRequest(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(rm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">handleFeeRequest</span><span class="params">(RequestModel rm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		FeeRequestModel frm = (FeeRequestModel)rm;</span><br><span class="line">		String str = <span class="string">""</span>;</span><br><span class="line">		<span class="comment">//部门经理的权限只能在1000以内</span></span><br><span class="line">		<span class="keyword">if</span>(frm.getFee() &lt; <span class="number">1000</span>)&#123;</span><br><span class="line">			<span class="comment">//为了测试，简单点，只同意小李申请的</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"小李"</span>.equals(frm.getUser()))&#123;</span><br><span class="line">				str = <span class="string">"部门经理同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//其他人一律不同意</span></span><br><span class="line">				str = <span class="string">"部门经理不同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> str;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//超过1000，继续传递给级别更高的人处理</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>.successor.handleRequest(rm);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> str;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//部门经理处理预支差旅费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现部门经理处理预支差旅费用申请的对象 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DepManager2</span> <span class="keyword">extends</span> <span class="title">DepManager</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel request)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(PreFeeRequestModel.FEE_TYPE.equals(request.getType()))&#123;</span><br><span class="line">			<span class="comment">//表示预支差旅费用申请</span></span><br><span class="line">			<span class="keyword">return</span> myHandler(request);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//其他的让父类去处理</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(request);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">myHandler</span><span class="params">(RequestModel request)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		PreFeeRequestModel fr = (PreFeeRequestModel)request;</span><br><span class="line">		<span class="comment">//部门经理的权限比较小，只能在20000以内</span></span><br><span class="line">		<span class="keyword">if</span>(fr.getFee() &lt; <span class="number">20000</span>)&#123;</span><br><span class="line">			<span class="comment">//工作需要嘛，统统同意</span></span><br><span class="line">			System.out.println(<span class="string">"部门经理同意"</span>+fr.getUser()+<span class="string">"预支差旅费用"</span>+fr.getFee()+<span class="string">"元的请求"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//超过20000，继续传递给级别更高的人处理</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor != <span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>.successor.handleRequest(request);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//总经理处理预支费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现总经理处理聚餐费用申请的对象 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralManager</span> <span class="keyword">extends</span> <span class="title">Handler</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(FeeRequestModel.FEE_TYPE.equals(rm.getType()))&#123;</span><br><span class="line">			<span class="keyword">return</span> handleFeeRequest(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(rm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">handleFeeRequest</span><span class="params">(RequestModel rm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		FeeRequestModel frm = (FeeRequestModel)rm;</span><br><span class="line">		String str = <span class="string">""</span>;</span><br><span class="line">		<span class="comment">//总经理的权限很大，只要请求到了这里，他都可以处理</span></span><br><span class="line">		<span class="keyword">if</span>(frm.getFee() &gt;= <span class="number">1000</span>)&#123;</span><br><span class="line">			<span class="comment">//为了测试，简单点，只同意小李的</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="string">"小李"</span>.equals(frm.getUser()))&#123;</span><br><span class="line">				str = <span class="string">"总经理同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">//其他人一律不同意</span></span><br><span class="line">				str = <span class="string">"总经理不同意"</span>+frm.getUser()+<span class="string">"聚餐费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> str;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//如果还有后继的处理对象，继续传递</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> successor.handleRequest(rm);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> str;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//总经理处理预支差旅费用</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 实现总经理处理预支差旅费用申请的对象 </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneralManager2</span> <span class="keyword">extends</span> <span class="title">GeneralManager</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">handleRequest</span><span class="params">(RequestModel rm)</span></span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(PreFeeRequestModel.FEE_TYPE.equals(rm.getType()))&#123;</span><br><span class="line">			<span class="comment">//表示预支差旅费用申请</span></span><br><span class="line">			<span class="keyword">return</span> myHandler(rm);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//其他的让父类去处理</span></span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">super</span>.handleRequest(rm);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">private</span> Object <span class="title">myHandler</span><span class="params">(RequestModel rm)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把通用的对象造型回来</span></span><br><span class="line">		PreFeeRequestModel frm = (PreFeeRequestModel)rm;</span><br><span class="line">		<span class="keyword">if</span>(frm.getFee() &gt;= <span class="number">5000</span>)&#123;</span><br><span class="line">			<span class="comment">//工作需要嘛，统统同意</span></span><br><span class="line">			System.out.println(<span class="string">"总经理同意"</span>+frm.getUser()+<span class="string">"预支差旅费用"</span>+frm.getFee()+<span class="string">"元的请求"</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			<span class="comment">//如果还有后继的处理对象，继续传递</span></span><br><span class="line">			<span class="keyword">if</span>(<span class="keyword">this</span>.successor!=<span class="keyword">null</span>)&#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">this</span>.successor.handleRequest(rm);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//通用请求对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通用的请求对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RequestModel</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 表示具体的业务类型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String type;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 通过构造方法把具体的业务类型传递进来</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> type 具体的业务类型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">RequestModel</span><span class="params">(String type)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.type = type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> type;</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//聚餐费用请求对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装跟聚餐费用申请业务相关的请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FeeRequestModel</span> <span class="keyword">extends</span> <span class="title">RequestModel</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 约定具体的业务类型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FEE_TYPE = <span class="string">"fee"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">FeeRequestModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(FEE_TYPE);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 申请人</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 申请金额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> fee;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getFee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fee;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFee</span><span class="params">(<span class="keyword">double</span> fee)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fee = fee;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//预支差旅费用请求对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 封装跟预支差旅费申请业务相关的请求数据</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PreFeeRequestModel</span> <span class="keyword">extends</span> <span class="title">RequestModel</span></span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 约定具体的业务类型</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String FEE_TYPE = <span class="string">"preFee"</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">PreFeeRequestModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>(FEE_TYPE);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 申请人</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String user;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 申请金额</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">double</span> fee;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.user = user;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getFee</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> fee;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFee</span><span class="params">(<span class="keyword">double</span> fee)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.fee = fee;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="访问者模式">访问者模式</h2>
<h3 id="描述">描述</h3>
<p>定义：表示一个作用于某对象结构中的各元素的操作。使得可以在不改变各元素的类的前提下定义作用于这些元素的新操作。本质是预留通路，回调实现。</p>
<h3 id="结构">结构</h3>
<table>
<thead>
<tr>
<th>角色</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>Visitor</td>
<td>访问者接口，为访问者对象声明visit方法，用于代表为对象结构添加的功能</td>
</tr>
<tr>
<td>ConcreteVisitor</td>
<td>访问者实现对象</td>
</tr>
<tr>
<td>Element</td>
<td>抽象的元素对象，对象结构的顶层接口，定义接受访问的操作</td>
</tr>
<tr>
<td>ConcreteElement</td>
<td>元素实现对象</td>
</tr>
<tr>
<td>ObjectStructure</td>
<td>对象结构，包含多个被访问的对象</td>
</tr>
</tbody>
</table>
<h3 id="优缺点">优缺点</h3>
<p>优点</p>
<ol>
<li>更好的扩展性</li>
<li>更好的复用性</li>
<li>分离无关行为</li>
</ol>
<p>缺点</p>
<ol>
<li>对象结构变化困难</li>
<li>破坏封装</li>
</ol>
<h3 id="使用场景">使用场景</h3>
<ol>
<li>对一个对象结构实施依赖于对象结构中的具体类的操作</li>
<li>将一个对象结构中复杂的行为转移到访问者中</li>
</ol>
<h3 id="示例">示例</h3>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//示例：商品类别树的管理</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//Client类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//定义所有的组合对象</span></span><br><span class="line">		Component root = <span class="keyword">new</span> Composite(<span class="string">"服装"</span>);</span><br><span class="line">		Component c1 = <span class="keyword">new</span> Composite(<span class="string">"男装"</span>);</span><br><span class="line">		Component c2 = <span class="keyword">new</span> Composite(<span class="string">"女装"</span>);</span><br><span class="line">		<span class="comment">//定义所有的叶子对象</span></span><br><span class="line">		Component leaf1 = <span class="keyword">new</span> Leaf(<span class="string">"衬衣"</span>);</span><br><span class="line">		Component leaf2 = <span class="keyword">new</span> Leaf(<span class="string">"夹克"</span>);</span><br><span class="line">		Component leaf3 = <span class="keyword">new</span> Leaf(<span class="string">"裙子"</span>);</span><br><span class="line">		Component leaf4 = <span class="keyword">new</span> Leaf(<span class="string">"套装"</span>);</span><br><span class="line">		<span class="comment">//按照树的结构来组合组合对象和叶子对象</span></span><br><span class="line">		root.addChild(c1);</span><br><span class="line">		root.addChild(c2);</span><br><span class="line">		</span><br><span class="line">		c1.addChild(leaf1);</span><br><span class="line">		c1.addChild(leaf2);</span><br><span class="line">		</span><br><span class="line">		c2.addChild(leaf3);</span><br><span class="line">		c2.addChild(leaf4);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//调用根元素的方法来接受请求功能</span></span><br><span class="line">		Visitor psVisitor = <span class="keyword">new</span> PrintStructVisitor(); </span><br><span class="line">		root.accept(psVisitor);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//抽象组件对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 抽象的组件对象，相当于访问者模式中的元素对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 接受访问者的访问</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> visitor 访问者对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 向组合对象中加入组件对象 </span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> child 被加入组合对象中的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 缺省的实现，抛出例外，因为叶子对象没有这个功能，或者子组件没有实现这个功能</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 从组合对象中移出某个组件对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> child 被移出的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// 缺省的实现，抛出例外，因为叶子对象没有这个功能，或者子组件没有实现这个功能</span></span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 返回某个索引对应的组件对象，如果没有对应的子对象，就返回null</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> index 需要获取的组件对象的索引，索引从0开始</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span> 索引对应的组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Component <span class="title">getChildren</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"对象不支持这个功能"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//组合对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 组合对象，可以包含其它组合对象或者叶子对象，</span></span><br><span class="line"><span class="comment"> * 相当于访问者模式的具体Element实现对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Composite</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//回调访问者对象的相应方法</span></span><br><span class="line">		visitor.visitComposite(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来存储组合对象中包含的子组件对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> List&lt;Component&gt; childComponents = <span class="keyword">new</span> ArrayList&lt;Component&gt;();</span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Component&gt; <span class="title">getChildComponents</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> childComponents;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 组合对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入组合对象的名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 组合对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Composite</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addChild</span><span class="params">(Component child)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//延迟初始化</span></span><br><span class="line">		<span class="keyword">if</span> (childComponents == <span class="keyword">null</span>) &#123;</span><br><span class="line">			childComponents = <span class="keyword">new</span> ArrayList&lt;Component&gt;();</span><br><span class="line">		&#125;</span><br><span class="line">		childComponents.add(child);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//叶子对象</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 叶子对象，相当于访问者模式的具体Element实现对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Leaf</span> <span class="keyword">extends</span> <span class="title">Component</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accept</span><span class="params">(Visitor visitor)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//回调访问者对象的相应方法</span></span><br><span class="line">		visitor.visitLeaf(<span class="keyword">this</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 叶子对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String name = <span class="string">""</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 构造方法，传入叶子对象的名字</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> name 叶子对象的名字</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Leaf</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.name = name;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> name;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//访问者接口</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 访问组合对象结构的访问者接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 访问组合对象，相当于给组合对象添加访问者的功能</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> composite 组合对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitComposite</span><span class="params">(Composite composite)</span></span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 访问叶子对象，相当于给叶子对象添加访问者的功能</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> leaf 叶子对象</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitLeaf</span><span class="params">(Leaf leaf)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//具体访问者</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 具体的访问者，实现：输出组合对象自身的结构</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintStructVisitor</span> <span class="keyword">implements</span> <span class="title">Visitor</span> </span>&#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 用来累计记录对象需要向后退的格</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> String preStr = <span class="string">""</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitComposite</span><span class="params">(Composite composite)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//先把自己输出去</span></span><br><span class="line">		System.out.println(preStr+<span class="string">"+"</span>+composite.getName());</span><br><span class="line">		<span class="comment">//如果还包含有子组件，那么就输出这些子组件对象</span></span><br><span class="line">		<span class="keyword">if</span>(composite.getChildComponents()!=<span class="keyword">null</span>)&#123;</span><br><span class="line">			<span class="comment">//然后添加一个空格，表示向后缩进一个空格</span></span><br><span class="line">			preStr+=<span class="string">" "</span>;		</span><br><span class="line">			<span class="comment">//输出当前对象的子对象了</span></span><br><span class="line">			<span class="keyword">for</span>(Component c : composite.getChildComponents())&#123;</span><br><span class="line">				<span class="comment">//递归输出每个子对象</span></span><br><span class="line">				c.accept(<span class="keyword">this</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//把循环子对象所多加入的一个退格给去掉</span></span><br><span class="line">			preStr = preStr.substring(<span class="number">0</span>,preStr.length()-<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">visitLeaf</span><span class="params">(Leaf leaf)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//访问到叶子对象的数据		</span></span><br><span class="line">		System.out.println(preStr+<span class="string">"-"</span>+leaf.getName());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
                

                <hr>
                <span style="color: #bfbfbf!important;">版权声明：本文为博主原创文章，欢迎转载，转载请注明作者、原文超链接</span>
                <!-- Pager -->
                <ul class="pager">
                    
                        <li class="previous">
                            <a href="/article/javastack/javastack/" data-toggle="tooltip" data-placement="top" title="IT技术网站直通车">&larr; Previous Post</a>
                        </li>
                    
                    
                        <li class="next">
                            <a href="/article/js/react1/" data-toggle="tooltip" data-placement="top" title="React.js绑定this的5种方法">Next Post &rarr;</a>
                        </li>
                    
                </ul>

                <br>

                <!--打赏-->
                
                    <div class="reward">
                        <div class="reward-button">赏 <span class="reward-code"> 
                            <span class="alipay-code"> <img class="alipay-img" src="/img/alipay_url.png"><b>支付宝打赏</b></span> 
                            <span class="wechat-code"> <img class="wechat-img" src="/img/wechatpay_url.png"><b>微信打赏</b> </span>
                            </span></div>
                        <p class="reward-notice">赞赏一下</p>
                    </div>
                
                <!--打赏-->
                <br>

                <!--分享-->
                
                    <div class="social-share"  data-wechat-qrcode-helper="" align="center"></div>
                    <!--  css & js -->
                    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/css/share.min.css">
                    <script src="https://cdnjs.cloudflare.com/ajax/libs/social-share.js/1.0.16/js/social-share.min.js"></script>
                
                <!--分享-->
                <br>   
                
                <!-- require APlayer -->
                
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
                <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>

                <div class="aplayer"
                    data-id="2576984498"
                    data-server="tecent"
                    data-type="playlist"
                    data-fixed="true" 
                    >
                </div>
                

                <!-- duoshuo Share start -->
                
                <!-- 多说 Share end-->

                <!-- 多说评论框 start -->
                
                <!-- 多说评论框 end -->

                <!-- disqus comment start -->
                
                <!-- disqus comment end -->

                
                    <!-- disqus 评论框 start -->
                    <div class="comment">
                        <div id="lv-container" data-id="city" data-uid="MTAyMC80MTg2NC8xODQxMA=="></div>
                    </div>
                    <!-- disqus 评论框 end -->
                

            </div>
            
            <!-- Tabe of Content -->
            <!-- Table of Contents -->

  
    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#创建型"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">&#x521B;&#x5EFA;&#x578B;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#工厂模式"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">&#x5DE5;&#x5382;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#简单工厂"><span class="toc-nav-number">1.1.1.</span> <span class="toc-nav-text">&#x7B80;&#x5355;&#x5DE5;&#x5382;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.1.1.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.1.1.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#命名"><span class="toc-nav-number">1.1.1.3.</span> <span class="toc-nav-text">&#x547D;&#x540D;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.1.1.4.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.1.1.5.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.1.1.6.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#工厂方法"><span class="toc-nav-number">1.1.2.</span> <span class="toc-nav-text">&#x5DE5;&#x5382;&#x65B9;&#x6CD5;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.1.2.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.1.2.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.1.2.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.1.2.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.1.2.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#抽象工厂"><span class="toc-nav-number">1.1.3.</span> <span class="toc-nav-text">&#x62BD;&#x8C61;&#x5DE5;&#x5382;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.1.3.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.1.3.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.1.3.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.1.3.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.1.3.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#单例模式"><span class="toc-nav-number">1.2.</span> <span class="toc-nav-text">&#x5355;&#x4F8B;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.2.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.2.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.2.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.2.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.2.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#生成器模式"><span class="toc-nav-number">1.3.</span> <span class="toc-nav-text">&#x751F;&#x6210;&#x5668;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.3.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.3.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.3.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.3.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.3.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#原型模式"><span class="toc-nav-number">1.4.</span> <span class="toc-nav-text">&#x539F;&#x578B;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">1.4.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">1.4.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">1.4.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">1.4.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">1.4.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#结构型"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;&#x578B;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#外观模式"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">&#x5916;&#x89C2;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.1.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.1.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#外观模式的实现"><span class="toc-nav-number">2.1.3.</span> <span class="toc-nav-text">&#x5916;&#x89C2;&#x6A21;&#x5F0F;&#x7684;&#x5B9E;&#x73B0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.1.4.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.1.5.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.1.6.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#适配器模式"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">&#x9002;&#x914D;&#x5668;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.2.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.2.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.2.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.2.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.2.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#代理模式"><span class="toc-nav-number">2.3.</span> <span class="toc-nav-text">&#x4EE3;&#x7406;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.3.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.3.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.3.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.3.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.3.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#组合模式"><span class="toc-nav-number">2.4.</span> <span class="toc-nav-text">&#x7EC4;&#x5408;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.4.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.4.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.4.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.4.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.4.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#装饰模式"><span class="toc-nav-number">2.5.</span> <span class="toc-nav-text">&#x88C5;&#x9970;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.5.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.5.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.5.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.5.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.5.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#桥接模式"><span class="toc-nav-number">2.6.</span> <span class="toc-nav-text">&#x6865;&#x63A5;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">2.6.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">2.6.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">2.6.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">2.6.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">2.6.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li></ol></li><li class="toc-nav-item toc-nav-level-1"><a class="toc-nav-link" href="#行为型"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">&#x884C;&#x4E3A;&#x578B;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#中介者模式"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">&#x4E2D;&#x4ECB;&#x8005;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.1.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.1.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.1.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.1.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.1.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#观察者模式"><span class="toc-nav-number">3.2.</span> <span class="toc-nav-text">&#x89C2;&#x5BDF;&#x8005;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.2.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.2.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.2.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.2.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.2.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#命令模式"><span class="toc-nav-number">3.3.</span> <span class="toc-nav-text">&#x547D;&#x4EE4;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.3.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.3.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.3.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.3.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.3.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#迭代器模式"><span class="toc-nav-number">3.4.</span> <span class="toc-nav-text">&#x8FED;&#x4EE3;&#x5668;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.4.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.4.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.4.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.4.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.4.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#模板方法模式"><span class="toc-nav-number">3.5.</span> <span class="toc-nav-text">&#x6A21;&#x677F;&#x65B9;&#x6CD5;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.5.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.5.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.5.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.5.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.5.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#策略模式"><span class="toc-nav-number">3.6.</span> <span class="toc-nav-text">&#x7B56;&#x7565;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.6.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.6.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.6.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.6.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.6.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#状态模式"><span class="toc-nav-number">3.7.</span> <span class="toc-nav-text">&#x72B6;&#x6001;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.7.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.7.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.7.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.7.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.7.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#备忘录模式"><span class="toc-nav-number">3.8.</span> <span class="toc-nav-text">&#x5907;&#x5FD8;&#x5F55;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.8.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.8.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.8.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.8.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.8.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#解释器模式"><span class="toc-nav-number">3.9.</span> <span class="toc-nav-text">&#x89E3;&#x91CA;&#x5668;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.9.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.9.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.9.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.9.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.9.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#责任链模式"><span class="toc-nav-number">3.10.</span> <span class="toc-nav-text">&#x8D23;&#x4EFB;&#x94FE;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.10.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.10.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.10.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.10.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.10.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#访问者模式"><span class="toc-nav-number">3.11.</span> <span class="toc-nav-text">&#x8BBF;&#x95EE;&#x8005;&#x6A21;&#x5F0F;</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#描述"><span class="toc-nav-number">3.11.1.</span> <span class="toc-nav-text">&#x63CF;&#x8FF0;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#结构"><span class="toc-nav-number">3.11.2.</span> <span class="toc-nav-text">&#x7ED3;&#x6784;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#优缺点"><span class="toc-nav-number">3.11.3.</span> <span class="toc-nav-text">&#x4F18;&#x7F3A;&#x70B9;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用场景"><span class="toc-nav-number">3.11.4.</span> <span class="toc-nav-text">&#x4F7F;&#x7528;&#x573A;&#x666F;</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#示例"><span class="toc-nav-number">3.11.5.</span> <span class="toc-nav-text">&#x793A;&#x4F8B;</span></a></li></ol></li></ol></li></ol>
        
        </div>
      </aside>
    

                
            <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <!-- no hr -->
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                       
                          <a class="tag" href="/tags/#设计模式" title="设计模式">设计模式</a>
                        
                    </div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">

                    
                        <li><a href="https://blog.csdn.net/nqmysbd" target="_blank">LiaoCan</a></li>
                    
                        <li><a href="https://www.aips.me" target="_blank">周良博客</a></li>
                    
                        <li><a href="http://blog.didispace.com/" target="_blank">程序猿DD</a></li>
                    
                        <li><a href="https://www.fangzhipeng.com" target="_blank">方志朋</a></li>
                    
                        <li><a href="http://www.ityouknow.com" target="_blank">纯洁的微笑</a></li>
                    
                        <li><a href="http://www.jiangxinlingdu.com" target="_blank">匠心零度</a></li>
                    
                        <li><a href="http://cmsblogs.com" target="_blank">Java 技术驿站</a></li>
                    
                        <li><a href="https://www.bysocket.com/" target="_blank">泥瓦匠BYSocket</a></li>
                    
                        <li><a href="https://www.qdtalk.com" target="_blank">陌上寒</a></li>
                    
                        <li><a href="http://jilinwula.com/" target="_blank">吉林乌拉</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>






    <!-- 来必力City版公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
       (function(d, s) {
           var j, e = d.getElementsByTagName(s)[0];
    
           if (typeof LivereTower === 'function') { return; }
    
           j = d.createElement(s);
           j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
           j.async = true;
    
           e.parentNode.insertBefore(j, e);
       })(document, 'script');
    </script>
    <noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
    <!-- 来必力City版 公共JS代码 end -->



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℬ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



<!-- 添加自动推送链接 -->
<script>
    (function(){
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        }
        else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>


<!-- 复制添加版权申明-->
<script>
    /**/
    function setClipboardText(event){
        event.preventDefault();//阻止元素发生默认的行为（例如，当点击提交按钮时阻止对表单的提交）。
        var node = document.createElement('div');
        //对documentfragment不熟，不知道怎么获取里面的内容，用了一个比较笨的方式
        node.appendChild(window.getSelection().getRangeAt(0).cloneContents());
        //getRangeAt(0)返回对基于零的数字索引与传递参数匹配的选择对象中的范围的引用。对于连续选择，参数应为零。
        var htmlData = '<div>'
            + node.innerHTML
            + '<br /><br />著作权归作者所有。<br />'
            + '商业转载请联系作者获得授权，非商业转载请注明出处。<br />'
            + '作者：liaocan <br />链接：'
            + location.href
            + '<br />来源：liaocan.top<br /><br />'
            + '</div>';
        var textData = window.getSelection().getRangeAt(0)
            + '\n\n著作权归作者所有。\n'
            + '商业转载请联系作者获得授权，非商业转载请注明出处。\n'
            + '作者：liaocan\n'
            + '链接：'
            + location.href
            + '来源：liaocan.top\n\n';
        if(event.clipboardData){
            event.clipboardData.setData("text/html", htmlData);
            //setData(剪贴板格式, 数据) 给剪贴板赋予指定格式的数据。返回 true 表示操作成功。
            event.clipboardData.setData("text/plain",textData);
        }
        else if(window.clipboardData){ //window.clipboardData的作用是在页面上将需要的东西复制到剪贴板上，提供了对于预定义的剪贴板格式的访问，以便在编辑操作中使用。
            return window.clipboardData.setData("text", textData);
        }
    };
 
    document.addEventListener('copy',function(e){
        setClipboardText(e);
    });
</script>



<!-- chrome Firefox 中文锚点定位失效-->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.js"></script>
<!-- smooth scroll behavior polyfill  -->
<script type="text/javascript" src="/js/smoothscroll.js"></script>
<script>
        $('#toc').on('click','a',function(a){
            // var isChrome = window.navigator.userAgent.indexOf("Chrome") !== -1;
            // console.log(window.navigator.userAgent,isChrome)
                // if(isChrome) {
                    // console.log(a.currentTarget.outerHTML);
                    // console.log($(a.currentTarget).attr("href"));
                    //跳转到指定锚点
                    // document.getElementById(a.target.innerText.toLowerCase()).scrollIntoView(true);
                    document.getElementById($(a.currentTarget).attr("href").replace("#","")).scrollIntoView({behavior: 'smooth' });
                // }
        })  
</script>

    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                
                

                

                

                
                    <li>
                        <a target="_blank"  href="https://github.com/nqmysb" title="github">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                


                
                    <li>
                        <a target="_blank"  href="https://blog.csdn.net/nqmysbd" title="CSDN">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-csdn fa-stack-1x fa-inverse">C</i>
                            </span>
                        </a>
                    </li>
                


                
                    <li>
                        <a target="_blank"  href="https://yq.aliyun.com/u/nqmysb" title="云栖社区">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-alyun fa-stack-1x fa-inverse">云</i>
                            </span>
                        </a>
                    </li>
                


                
                    <li>
                        <a target="_blank"  href="https://gitee.com/liaocwang" title="gitee">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-git fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="mailto:593013537@qq.com" title="email">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Liao Can 2019 
                    <br>
                    Theme by <a target="_blank" href="http://www.huweihuang.com">胡伟煌</a> 
                    <span style="display: inline-block; margin: 0 5px;">
                        <i class="fa fa-heart"></i>
                    </span> 
                    re-Ported by <a href="https://liaocan.top">Liaocan</a> 
                     | 
                     <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=nqmysb&repo=hexo-theme-huweihuang&type=star&count=true" >
                    </iframe>
                    <br />
                    <!--总访问量统计-->
                    
                        <span id="busuanzi_container_site_pv" style="margin-left: 3px;">
                            总访问量<span id="busuanzi_value_site_pv"></span>次
                        </span>
                        <div style="display:none" >本站访客数<span  id="busuanzi_value_site_uv"></span>人次</div>
                    
                    <!--总访问量统计-->
                      
                    
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("https://liaocan.top/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-132197826-1';
    var _gaDomain = 'liaocan.top';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->

<script>
    // dynamic User by Hux
    var _baId = '6f0414ec28cbdc196e93beaa4472a18d';

    // Originial
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?" + _baId;
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
</script>






	<a id="rocket" href="#top" class=""></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
    <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>
    <!--单击显示文字-->
    <script type="text/javascript" src="/js/click_show_text.js"></script>
<!-- Image to hack wechat -->
<!-- <img src="https://liaocan.top/img/icon_wechat.png" width="0" height="0" /> -->
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
